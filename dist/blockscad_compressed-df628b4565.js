!function e(t,o,a){function n(l,r){if(!o[l]){if(!t[l]){var c="function"==typeof require&&require;if(!r&&c)return c(l,!0);if(s)return s(l,!0);var i=new Error("Cannot find module '"+l+"'");throw i.code="MODULE_NOT_FOUND",i}var d=o[l]={exports:{}};t[l][0].call(d.exports,function(e){var o=t[l][1][e];return n(o||e)},d,d.exports,e,t,o,a)}return o[l].exports}for(var s="function"==typeof require&&require,l=0;l<a.length;l++)n(a[l]);return n}({1:[function(e,t,o){var a=window.EEval||{};a.Parser=e("expr-eval").Parser,window.EEval=a},{"expr-eval":2}],2:[function(e,t,o){var a,n;a=this,n=function(){"use strict";function e(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1}var t="INUMBER",o="IOP1",a="IOP2",n="IOP3",s="IVAR",l="IFUNCALL",r="IEXPR",c="IMEMBER";function i(e,t){this.type=e,this.value=null!=t?t:0}function d(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}function u(e,i,d){for(var h,p,f,m,g,b=[],k=0,v=e.length;k<v;k++){var B=e[k],M=B.type;if(M===t)"number"==typeof B.value&&B.value<0?b.push("("+B.value+")"):b.push("string"==typeof(g=B.value)?JSON.stringify(g).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):g);else if(M===a)p=b.pop(),h=b.pop(),m=B.value,i?"^"===m?b.push("Math.pow("+h+", "+p+")"):"and"===m?b.push("(!!"+h+" && !!"+p+")"):"or"===m?b.push("(!!"+h+" || !!"+p+")"):"||"===m?b.push("(String("+h+") + String("+p+"))"):"=="===m?b.push("("+h+" === "+p+")"):"!="===m?b.push("("+h+" !== "+p+")"):b.push("("+h+" "+m+" "+p+")"):d&&"^"===m?b.push("pow("+h+", "+p+")"):b.push("("+h+" "+m+" "+p+")");else if(M===n){if(f=b.pop(),p=b.pop(),h=b.pop(),"?"!==(m=B.value))throw new Error("invalid Expression");b.push("("+h+" ? "+p+" : "+f+")")}else if(M===s)b.push(B.value);else if(M===o)h=b.pop(),"-"===(m=B.value)||"+"===m?b.push("("+m+h+")"):i?"not"===m?b.push("(!"+h+")"):"!"===m?b.push("fac("+h+")"):b.push(m+"("+h+")"):"!"===m?b.push("("+h+"!)"):b.push("("+m+" "+h+")");else if(M===l){for(var w=B.value,x=[];w-- >0;)x.unshift(b.pop());m=b.pop(),b.push(m+"("+x.join(", ")+")")}else if(M===c)h=b.pop(),b.push(h+"."+B.value);else{if(M!==r)throw new Error("invalid Expression");b.push(u(B.value,i,d))}}if(b.length>1)throw new Error("invalid Expression (parity)");return b[0]}function h(t,o){for(var a=0,n=t.length;a<n;a++){var l=t[a];l.type===s&&-1===e(o,l.value)?o.push(l.value):l.type===r&&h(l.value,o)}}function p(e,t){return Number(e)+Number(t)}function f(e,t){return e-t}function m(e,t){return e*t}function g(e,t){return e/t}function b(e,t){return e%t}function k(e){return Math.sin(e*Math.PI/180)}function v(e){return Math.cos(e*Math.PI/180)}function B(e){return Math.tan(e*Math.PI/180)}function M(e){return-e}i.prototype.toString=function(){switch(this.type){case t:case o:case a:case n:case s:return this.value;case l:return"CALL "+this.value;case c:return"."+this.value;default:return"Invalid Instruction"}},d.prototype.evaluate=function(e){return e=e||{},function e(i,d,u){for(var h,p,f,m,g=[],b=0,k=i.length;b<k;b++){var v=i[b],B=v.type;if(B===t)g.push(v.value);else if(B===a)p=g.pop(),h=g.pop(),m=d.binaryOps[v.value],g.push(m(h,p));else if(B===n)f=g.pop(),p=g.pop(),h=g.pop(),"?"===v.value?g.push(e(h?p:f,d,u)):(m=d.ternaryOps[v.value],g.push(m(h,p,f)));else if(B===s)if(v.value in d.functions)g.push(d.functions[v.value]);else{var M=u[v.value];if(void 0===M)throw new Error("undefined variable: "+v.value);g.push(M)}else if(B===o)h=g.pop(),m=d.unaryOps[v.value],g.push(m(h));else if(B===l){for(var w=v.value,x=[];w-- >0;)x.unshift(g.pop());if(!(m=g.pop()).apply||!m.call)throw new Error(m+" is not a function");g.push(m.apply(void 0,x))}else if(B===r)g.push(v.value);else{if(B!==c)throw new Error("invalid Expression");h=g.pop(),g.push(h[v.value])}}if(g.length>1)throw new Error("invalid Expression (parity)");return g[0]}(this.tokens,this,e)},d.prototype.toString=function(e){return u(this.tokens,!1,!!e)},d.prototype.symbols=function(){var e=[];return h(this.tokens,e),e},d.prototype.variables=function(){var e=[];h(this.tokens,e);var t=this.functions;return e.filter(function(e){return!(e in t)})};var w="TOP";function x(e,t,o,a){this.type=e,this.value=t,this.line=o,this.column=a}function y(e,t,o,a,n){this.pos=0,this.line=0,this.column=0,this.current=null,this.unaryOps=t,this.binaryOps=o,this.ternaryOps=a,this.consts=n,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.savedLine=0,this.savedColumn=0}x.prototype.toString=function(){return this.type+": "+this.value},y.prototype.newToken=function(e,t,o,a){return new x(e,t,null!=o?o:this.line,null!=a?a:this.column)},y.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current,this.savedLine=this.line,this.savedColumn=this.column},y.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent,this.line=this.savedLine,this.column=this.savedColumn},y.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},y.prototype.isString=function(){var e=!1,t=this.line,o=this.column,a=this.pos,n=this.expression.charAt(a);if("'"===n||'"'===n){this.pos++,this.column++;for(var s=this.expression.indexOf(n,a+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,"\\"!==this.expression.charAt(s-1)){var l=this.expression.substring(a+1,s);this.current=this.newToken("TSTRING",this.unescape(l),t,o);for(var r=l.indexOf("\n"),c=-1;r>=0;)this.line++,this.column=0,c=r,r=l.indexOf("\n",r+1);this.column+=l.length-c,e=!0;break}s=this.expression.indexOf(n,s+1)}}return e},y.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return("("===e||")"===e)&&(this.current=this.newToken("TPAREN",e),this.pos++,this.column++,!0)},y.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken("TCOMMA",","),this.pos++,this.column++,!0)},y.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var o=this.expression.charAt(t);if(o.toUpperCase()===o.toLowerCase()&&(t===this.pos||"_"!==o&&"."!==o&&(o<"0"||o>"9")))break}if(t>e){var a=this.expression.substring(e,t);if(a in this.consts)return this.current=this.newToken("TNUMBER",this.consts[a]),this.pos+=a.length,this.column+=a.length,!0}return!1},y.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var o=this.expression.charAt(t);if(o.toUpperCase()===o.toLowerCase()&&(t===this.pos||"_"!==o&&(o<"0"||o>"9")))break}if(t>e){var a=this.expression.substring(e,t);if(a in this.binaryOps||a in this.unaryOps||a in this.ternaryOps)return this.current=this.newToken(w,a),this.pos+=a.length,this.column+=a.length,!0}return!1},y.prototype.isName=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var o=this.expression.charAt(t);if(o.toUpperCase()===o.toLowerCase()&&(t===this.pos||"_"!==o&&(o<"0"||o>"9")))break}if(t>e){var a=this.expression.substring(e,t);return this.current=this.newToken("TNAME",a),this.pos+=a.length,this.column+=a.length,!0}return!1},y.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);!(" "!==t&&"\t"!==t&&"\n"!==t&&"\r"!==t||(e=!0,this.pos++,this.column++,"\n"===t&&(this.line++,this.column=0),this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var S=/^[0-9a-f]{4}$/i;y.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var o=e.substring(0,t);t>=0;){var a=e.charAt(++t);switch(a){case"'":o+="'";break;case'"':o+='"';break;case"\\":o+="\\";break;case"/":o+="/";break;case"b":o+="\b";break;case"f":o+="\f";break;case"n":o+="\n";break;case"r":o+="\r";break;case"t":o+="\t";break;case"u":var n=e.substring(t+1,t+5);S.test(n)||this.parseError("Illegal escape sequence: \\u"+n),o+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+a+'"')}++t;var s=e.indexOf("\\",t);o+=e.substring(t,s<0?e.length:s),t=s}return o},y.prototype.isComment=function(){if("/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)){var e=this.pos;this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length);for(var t=this.expression.substring(e,this.pos),o=t.indexOf("\n");o>=0;)this.line++,this.column=t.length-o,o=t.indexOf("\n",o+1);return!0}return!1},y.prototype.isNumber=function(){for(var e,t=!1,o=this.pos,a=o,n=o,s=this.column,l=s,r=!1,c=!1;o<this.expression.length&&((e=this.expression.charAt(o))>="0"&&e<="9"||!r&&"."===e);)"."===e?r=!0:c=!0,o++,s++,t=c;if(t&&(n=o,l=s),"e"===e||"E"===e){o++,s++;for(var i=!0,d=!1;o<this.expression.length;){if(e=this.expression.charAt(o),!i||"+"!==e&&"-"!==e){if(!(e>="0"&&e<="9"))break;d=!0,i=!1}else i=!1;o++,s++}d||(o=n,s=l)}return t?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(a,o))),this.pos=o,this.column=s):(this.pos=n,this.column=l),t},y.prototype.isOperator=function(){var e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(w,e);else if("∙"===e||"•"===e)this.current=this.newToken(w,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(w,">="),this.pos++,this.column++):this.current=this.newToken(w,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(w,"<="),this.pos++,this.column++):this.current=this.newToken(w,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(w,"||"),this.pos++,this.column++}else if("="===e){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(w,"=="),this.pos++,this.column++}else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(w,"!="),this.pos++,this.column++):this.current=this.newToken(w,e)}return this.pos++,this.column++,!0},y.prototype.parseError=function(e){throw new Error("parse error ["+(this.line+1)+":"+(this.column+1)+"]: "+e)};var _={};function E(e){var t=_[e];return t||(t=_[e]=new i(o,e)),t}var I={};function T(e){var t=I[e];return t||(t=I[e]=new i(a,e)),t}var A={};function D(e,t){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null}function O(){this.unaryOps={"-":M,"+":Number},this.binaryOps={"+":p,"-":f,"*":m,"/":g,"%":b,"^":Math.pow},this.ternaryOps={},this.functions={min:Math.min,max:Math.max,exp:Math.exp,pow:Math.pow,sqrt:Math.sqrt,log:Math.log10,ln:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,sin:k,cos:v,tan:B},this.consts={E:Math.E,e:Math.E,PI:Math.PI,pi:Math.PI}}return D.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},D.prototype.tokenMatches=function(t,o){return void 0===o||(Array.isArray(o)?e(o,t.value)>=0:"function"==typeof o?o(t):t.value===o)},D.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},D.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},D.prototype.accept=function(e,t){return!(this.nextToken.type!==e||!this.tokenMatches(this.nextToken,t))&&(this.next(),!0)},D.prototype.expect=function(e,t){if(!this.accept(e,t))throw new Error("parse error ["+this.tokens.line+":"+this.tokens.column+"]: Expected "+(t||e))},D.prototype.parseAtom=function(e){if(this.accept("TNAME"))e.push(new i(s,this.current.value));else if(this.accept("TNUMBER"))e.push(new i(t,this.current.value));else if(this.accept("TSTRING"))e.push(new i(t,this.current.value));else{if(!this.accept("TPAREN","("))throw new Error("unexpected "+this.nextToken);this.parseExpression(e),this.expect("TPAREN",")")}},D.prototype.parseExpression=function(e){this.parseConditionalExpression(e)},D.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(w,"?");){var t=[],o=[];this.parseConditionalExpression(t),this.expect(w,":"),this.parseConditionalExpression(o),e.push(new i(r,t)),e.push(new i(r,o)),e.push((s=void 0,(s=A[a="?"])||(s=A[a]=new i(n,a)),s))}var a,s},D.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(w,"or");)this.parseAndExpression(e),e.push(T("or"))},D.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(w,"and");)this.parseComparison(e),e.push(T("and"))},D.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(w,["==","!=","<","<=",">=",">"]);){var t=this.current;this.parseAddSub(e),e.push(T(t.value))}},D.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(w,["+","-","||"]);){var t=this.current;this.parseTerm(e),e.push(T(t.value))}},D.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(w,["*","/","%"]);){var t=this.current;this.parseFactor(e),e.push(T(t.value))}},D.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;if(this.save(),this.accept(w,function(e){return e.value in t}))if("-"!==this.current.value&&"+"!==this.current.value&&"TPAREN"===this.nextToken.type&&"("===this.nextToken.value)this.restore(),this.parseExponential(e);else{var o=this.current;this.parseFactor(e),e.push(E(o.value))}else this.parseExponential(e)},D.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(w,"^");)this.parseFactor(e),e.push(T("^"))},D.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(w,"!");)e.push(E("!"))},D.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;if(this.accept(w,function(e){return e.value in t})){var o=this.current;this.parseAtom(e),e.push(E(o.value))}else for(this.parseMemberExpression(e);this.accept("TPAREN","(");)if(this.accept("TPAREN",")"))e.push(new i(l,0));else{var a=this.parseArgumentList(e);e.push(new i(l,a))}},D.prototype.parseArgumentList=function(e){for(var t=0;!this.accept("TPAREN",")");)for(this.parseExpression(e),++t;this.accept("TCOMMA");)this.parseExpression(e),++t;return t},D.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(w,".");)this.expect("TNAME"),e.push(new i(c,this.current.value))},O.parse=function(e){return(new O).parse(e)},O.evaluate=function(e,t){return O.parse(e).evaluate(t)},O.prototype={parse:function(e){var t=[],o=new D(this,new y(e,this.unaryOps,this.binaryOps,this.ternaryOps,this.consts));return o.parseExpression(t),o.expect("TEOF","EOF"),new d(t,this)},evaluate:function(e,t){return this.parse(e).evaluate(t)}},{Parser:O,Expression:d}},"object"==typeof o&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):a.exprEval=n()},{}]},{},[1]);var blockscadpage={start:function(){var e="";return e+='  <div id="main">\n',e+='    <nav class="navbar navbar-default" id="top-navigation-bar">\n',e+='      <div class="container-fluid">\n',e+='        <a href="" id="brand_link" class="pull-left"></a>\n',e+='        <ul class="nav navbar-nav">\n',e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><img src="imgs/globe.png" style="width:20px"><span class="caret"></span></a>\n',e+='            <ul id="languageMenu" class="dropdown-menu" role="menu">\n',e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown"> \n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+Blockscad.Msg.PROJECT_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="file-menu" class="dropdown-menu" role="menu">\n',e+='              <li><a href="#" class="new-project">'+Blockscad.Msg.NEW+"</a></li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="#" id="saveLocal" class="saveLocal">'+Blockscad.Msg.SAVE_BLOCKS_LOCAL+"</a></li>\n",e+="              <li>\n",e+='                <input type="file" accept=".xml" id="loadLocal" style="visibility: hidden; width: 1px; height: 1px" />\n',e+='                <a href="#" onclick="document.getElementById(\'loadLocal\').click(); return false">'+Blockscad.Msg.LOAD_BLOCKS_LOCAL+"</a>\n",e+="              </li>\n",e+='              <li class="divider"></li>\n',e+="              <li>\n",e+='                <input type="file" accept=".xml" id="importLocal" style="visibility: hidden; width: 1px; height: 1px" />\n',e+='                <a href="#" onclick="document.getElementById(\'importLocal\').click(); return false">'+Blockscad.Msg.IMPORT_BLOCKS_LOCAL+"</a>\n",e+="              </li>\n",e+='                <input type="file" accept=".stl" id="importStl" style="visibility: hidden; width: 1px; height: 1px" />\n',e+='              <li class="divider"></li>\n',e+='              <li><a href="#" id="saveOpenscad">'+Blockscad.Msg.SAVE_SCAD_LOCAL+"</a></li>\n",e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+='            <a href="#" id="learn-menu-top" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+Blockscad.Msg.LEARN_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="learn-menu" class="dropdown-menu" role="menu">\n',e+="              <li>\n",e+='                <a class="trigger right-caret">'+Blockscad.Msg.EXAMPLES_MENU+"</a>\n",e+='                <ul class="dropdown-menu sub-menu">\n',e+='                     <li><a href="#" id="examples_cube_with_cutouts">'+Blockscad.Msg.EXAMPLE_CUBE_WITH_CUTOUTS+"</a></li>\n",e+='                     <li><a href="#" id="examples_anthias_fish">'+Blockscad.Msg.EXAMPLE_ANTHIAS_FISH+"</a></li>\n",e+='                     <li><a href="#" id="examples_torus">'+Blockscad.Msg.TORUS+"</a></li>\n",e+='                     <li><a href="#" id="examples_box">'+Blockscad.Msg.EXAMPLE_PARAMETRIC_BOX+"</a></li>\n",e+='                     <li><a href="#" id="examples_linear_extrude">'+Blockscad.Msg.LINEAR_EXTRUDE+"</a></li>\n",e+='                     <li><a href="#" id="examples_rotate_extrude">'+Blockscad.Msg.ROTATE_EXTRUDE+"</a></li>\n",e+='                     <li><a href="#" id="examples_hulled_loop_sun">'+Blockscad.Msg.EXAMPLE_LOOP_SUN+"</a></li>\n",e+='                     <li><a href="#" id="examples_sine_function_with_loop">'+Blockscad.Msg.EXAMPLE_LOOP_SINE+"</a></li>\n",e+='                     <li><a href="#" id="examples_trefoil_knot_param_eq">'+Blockscad.Msg.EXAMPLE_PARAMETRIC_EQ_KNOT+"</a></li>\n",e+="                </ul>\n",e+="              </li>\n",e+='              <li class="divider"></li>\n',e+="              <li>\n","tr"!=BSUtils.LANG?(e+='                <a class="trigger right-caret">'+Blockscad.Msg.VIDEOS+"</a>\n",e+='                <ul class="dropdown-menu sub-menu">\n',e+='                     <li><a href="https://www.youtube.com/watch?v=xs0a4hzd1Tk&t=11s" id="skills_video_shapes" target="_blank">'+Blockscad.Msg.CREATING_SHAPES_VIDEO+"</a></li>\n",e+='                     <li><a href="https://www.youtube.com/watch?v=6ulQa_sO8ms" id="skills_video_translation" target="_blank">'+Blockscad.Msg.TRANSLATION_VIDEO+"</a></li>\n",e+='                     <li><a href="https://www.youtube.com/watch?v=bwzv1bTPmUU" id="skills_video_rotation_1" target="_blank">'+Blockscad.Msg.ROTATION_1+"</a></li>\n",e+="                </ul>\n"):(e+='                <a class="trigger right-caret">'+Blockscad.Msg.VIDEOS+"</a>\n",e+='                <ul class="dropdown-menu sub-menu">\n',e+='                     <li><a href="https://www.youtube.com/watch?v=zvDIaKzdW7E" id="skills_video_shapes" target="_blank">'+Blockscad.Msg.CREATING_SHAPES_VIDEO+"</a></li>\n",e+='                     <li><a href="https://www.youtube.com/watch?v=q2HxbW5fw3Q" id="skills_video_translation" target="_blank">'+Blockscad.Msg.TRANSLATION_VIDEO+"</a></li>\n",e+='                     <li><a href="https://www.youtube.com/watch?v=L5abY3H2Z4E" id="skills_video_rotation_1" target="_blank">'+Blockscad.Msg.ROTATION_1+"</a></li>\n",e+="                </ul>\n"),e+="              </li>\n","tr"!=BSUtils.LANG&&(e+='              <li class="divider"></li>\n',e+='              <li><a href="https://blockscad.teachable.com/p/blockscad-student-courses" target="_blank">'+Blockscad.Msg.ELEARNING_COURSES+"</a></li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="#" id="start-intro-tutorial">'+Blockscad.Msg.INTRO_TUTORIAL+"</a></li>\n"),e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+Blockscad.Msg.TEACH_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="teach-menu" class="dropdown-menu" role="menu">\n',e+='              <li><a href="/edu/lessons/" >'+Blockscad.Msg.LESSONS+"</a></li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="/edu/resources/" id="t-resources">'+Blockscad.Msg.TEACHER_RESOURCES+"</a></li>\n",e+='              <li class="divider"></li>\n',"tr"!=BSUtils.LANG?e+='              <li><a href="https://blockscad.teachable.com/" id="tr_teachable" target="_blank">'+Blockscad.Msg.ELEARNING_COURSES+"</a></li>\n":e+='              <li><a href="https://blockscad-turkey.teachable.com/" id="tr_teachable" target="_blank">'+Blockscad.Msg.ELEARNING_COURSES+"</a></li>\n",e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+='            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'+Blockscad.Msg.HELP_MENU+'<span class="caret"></span></a>\n',e+='            <ul id="options-menu" class="dropdown-menu" role="menu">\n',"tr"!=BSUtils.LANG?e+='              <li><a href="/contact_us" >'+Blockscad.Msg.CONTACT_US+"</a></li>\n":e+='              <li><a href="/tr/contact_us" >'+Blockscad.Msg.CONTACT_US+"</a></li>\n",e+='              <li class="divider"></li>\n',e+="              <li>\n",e+='                <a class="trigger right-caret">'+Blockscad.Msg.OPTIONS_MENU+"</a>\n",e+='                <ul class="dropdown-menu sub-menu">\n',e+='                   <li><a href="#" id="simpleToolbox">'+Blockscad.Msg.SIMPLE_TOOLBOX+"</a></li>\n",e+='                   <li><a href="#" id="advancedToolbox">'+Blockscad.Msg.ADVANCED_TOOLBOX+"</a></li>\n",e+="                   <li>\n",e+='                    <a class="trigger right-caret">'+Blockscad.Msg.BLOCK_COLORS+"</a>\n",e+='                     <ul class="dropdown-menu sub-menu">\n',e+='                      <li><a href="#" id="colors_one">'+Blockscad.Msg.CLASSIC_COLORS+"</a></li>\n",e+='                      <li><a href="#" id="colors_two">'+Blockscad.Msg.PALE_COLORS+"</a></li>\n",e+="                    </ul>\n",e+="                   </li>\n",e+="                </ul>\n",e+="              </li>\n",e+='              <li class="divider"></li>\n',e+='              <li><a href="#" id="about_modal_link">'+Blockscad.Msg.ABOUT_LINK+"</a></li>\n",e+="            </ul>\n",e+="          </li>\n",e+='          <li class="dropdown">\n',e+="        </ul>\n",e+='        <div id="login-area" class="navbar-right"><div id="save-indicator" class="save-indicator"></div>\n',e+='        <div id="save-message" class="save-message"></div><button type="button" id="bigsavebutton" class="btn-default btn btn-lg saveLocal" style="margin-top:2px;">'+Blockscad.Msg.SAVE_BUTTON+"</button>\n",e+="        </div>\n",e+="      </div>  \x3c!-- /.container-fluid --\x3e\n",e+="    </nav>\n",e+='    <div id="editView">\n',e+='      <nav class="navbar-default navbar-narrow"> \x3c!-- second nav row --\x3e\n',e+='        <ul class="nav nav-pills navbar-right">\n',e+='          <li class="active"><a href="#blocklyContainer" data-toggle="pill" id="displayBlocks">'+Blockscad.Msg.BLOCKS_TAB+"</a></li>\n",e+='          <li><a href="#openScadPre" data-toggle="pill" id="displayCode" style="display:block">'+Blockscad.Msg.CODE_TAB+"</a></li>\n",e+="        </ul> \n",e+='         <div class="navbar-right" style="width:19px">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</div>',e+='        <a href="#" id="projectPageLink" style="display:none" class="btn btn-default navbar-right" >'+Blockscad.Msg.PROJECT_PAGE+"</a>\n",e+='        <div class="input-group">\n',e+='          <span class="input-group-addon" id="proj_name_label">'+Blockscad.Msg.PROJECT_NAME+"</span>\n",e+='          <input type="text" id="project-name" class="form-control proj-input" value="'+Blockscad.Msg.PROJECT_NAME_DEFAULT+'" maxlength="28" style="width: 280px;">\n',e+='           <span id="edproject-due-date" style="line-height:36px"></span>\n',e+='           <span id="edproject-instructions"></span>\n',e+="        </div>\n",e+='        <div class="btn-over-blockly" style="margin-left: 20px">\n',e+='          <div class="btn-group navbar-btn" role="group" aria-label="...">\n',e+='            <div style="display: inline-block" title="'+Blockscad.Msg.MOUSEOVER_UNDO+'" style="margin-right:-5px">\n',e+='              <button type="button" class="btn btn-default" id="undoButton" style="margin-right: -5px">\n',e+='                <img src="imgs/undo.svg" width="25px" height="19px">\n',e+="              </button>\n",e+="            </div>\n",e+='            <div style="display: inline-block" title="'+Blockscad.Msg.MOUSEOVER_REDO+'">\n',e+='              <button type="button" class="btn btn-default" id="redoButton" style="margin-right: 20px">\n',e+='                <img src="imgs/redo.svg" width="25px" height="19px">\n',e+="              </button>\n",e+="            </div>\n",e+="          </div>\n",e+='          <button id="trashButton" class="btn btn-default notext" title="'+Blockscad.Msg.MOUSEOVER_TRASHCAN+'">\n',e+='            <img src="blockly/media/1x1.gif" class="trash icon21">\n',e+="          </button>\n",e+="        </div> \x3c!-- undo/redo/trash div --\x3e \n",e+="      </nav> \x3c!-- end second nav row --\x3e\n",e+="      \x3c!-- End of the header content --\x3e\n",e+="\n",e+="      \x3c!-- beginning of page content (blockly + viewer) --\x3e\n",e+='      <div class="tab-content">\n',e+='        <div class="tab-pane active" id="blocklyContainer">\n',e+='<div class="flexrow">',e+='    <div id="left-resizable-panel">',e+='          <div id="blocklyDiv">\n',e+="          </div>",e+="    </div>",e+='    <div id="right-resizable-panel">',e+='              <div id="paneContainer">\n',e+='                 <div id="renderDiv">\n',e+="                 </div> \x3c!-- render div --\x3e\n",e+='                <div id="viewerControls">\n',e+='                <div id="viewerButtons" class="reg-viewerButtons">\n',e+='                  <div class="btn-group">\n',e+='                    <input type="text" id="defColor"/>\n',e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="axesButton" type="button" title="'+Blockscad.Msg.AXES_BUTTON+'" class="btn vbut btn-default">\n',e+='                      <svg viewbox="0 0 26 26">\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m9 0.5v15h15"/>\n',e+='                           <path style="stroke:#777;stroke-width:1.6;fill:none" d="m9 15-9 9"/>\n',e+="                      </svg>\n",e+="                    </button>\n",e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="zInButton" type="button" title="'+Blockscad.Msg.ZOOM_IN_BUTTON+'" class="btn vbut btn-default">\n',e+='                     <svg viewbox="0 0 30 30">\n',e+='                      <circle r="14" style="stroke:#777;stroke-width:1.6;fill:none" cx="15" cy="15"/>\n',e+='                      <path style="stroke:#555;stroke-width:1.6;fill:none" d="m15 8v14"/>\n',e+='                      <path style="stroke:#555;stroke-width:1.6;fill:none" d="m8 15h14"/>\n',e+="                     </svg>\n",e+="                    </button>\n",e+='                    <button id="zOutButton" type="button" title="'+Blockscad.Msg.ZOOM_OUT_BUTTON+'" class="btn vbut btn-default">\n',e+='                     <svg viewbox="0 0 30 30">\n',e+='                      <circle r="14" style="stroke:#777;stroke-width:1.6;fill:none" cx="15" cy="15"/>\n',e+='                      <path style="stroke:#555;stroke-width:1.6;fill:none" d="m8 15h14"/>\n',e+="                     </svg>\n",e+="                    </button>\n",e+="                  </div>\n",e+='                  <div class="btn-group">\n',e+='                    <button id="zResetButton" type="button" title="'+Blockscad.Msg.ZOOM_RESET_BUTTON+'" class="btn vbut btn-default">\n',e+='                     <svg viewbox="0 0 30 30">\n',e+='                       <circle r="11" style="fill:none;stroke:#777;stroke-width:1.6" cx="15" cy="15"/>\n',e+='                       <path d="M 15,4 15,0" style="stroke:#666;stroke-width:1.6;" />\n',e+='                       <path d="m 26,15 4,0" style="stroke:#666;stroke-width:1.6;" />\n',e+='                       <path d="m 15,26 0,4" style="stroke:#666;stroke-width:1.6;" />\n',e+='                       <path d="M 4,15 0,15" style="stroke:#666;stroke-width:1.6;" />\n',e+='                       <circle r="3" cy="15" cx="15" style="fill:#777;stroke:#777;stroke-width:1.6;" />\n',e+="                     </svg>\n",e+="                    </button>\n",e+='                     <select id="viewMenu" class="btn btn-default">\n',e+='                          <option value="diagonal">'+Blockscad.Msg.DIRECTION_DIAGONAL+"</option>\n",e+='                         <option value="front">'+Blockscad.Msg.DIRECTION_FRONT+"</option>\n",e+='                         <option value="top">'+Blockscad.Msg.DIRECTION_TOP+"</option>\n",e+='                         <option value="right">'+Blockscad.Msg.DIRECTION_RIGHT+"</option>\n",e+='                         <option value="left">'+Blockscad.Msg.DIRECTION_LEFT+"</option>\n",e+='                         <option value="back">'+Blockscad.Msg.DIRECTION_BACK+"</option>\n",e+='                         <option value="bottom">'+Blockscad.Msg.DIRECTION_BOTTOM+"</option>\n",e+="                     </select>\n",e+="                  </div>\n",e+='                  <button type="button" id="cameraButton" class="btn vbut btn-default">\n',e+='                     <img src="imgs/cameraSmall.png">\n',e+="                  </button>\n",e+="                </div>\n",e+='                <div id="viewerDefaults">\n',e+='                 <span id="resolution_radio" class="btn btn-default" style="width:325px;"> \n',e+="                  <span>"+Blockscad.Msg.SMOOTH+":&nbsp&nbsp</span>\n",e+='                 <label class="radio-inline"><input type="radio" name="resolution" value="0.4">'+Blockscad.Msg.SMOOTH_LOW+"</label>\n",e+='                 <label class="radio-inline"><input type="radio" name="resolution" value="1"checked>'+Blockscad.Msg.SMOOTH_MEDIUM+"</label>\n",e+='                 <label class="radio-inline"><input type="radio" name="resolution" value="2.25">'+Blockscad.Msg.SMOOTH_HIGH+"</label>\n",e+="                 </span>\n",e+="                </div>\n",e+='                <div id="renderPane" class="renderPane">\n',e+='                  <button type="button" class="btn btn-default btn-lg changeable renderbut" id="renderButton">'+Blockscad.Msg.RENDER_BUTTON+"</button>\n",e+='                  <button type="button" class="btn btn-default btn-lg btn-danger abortbut" id="abortButton">'+Blockscad.Msg.ABORT_BUTTON+"</button>\n",e+='                  <div id="stl_buttons" class="pull-right" style="padding:5px 5px;">\n',e+='                    <select id="render-type" style="padding:2px 4px;"></select>\n',e+='                    <button type="button" class="btn btn-default btn-lg changeable" id="stlButton">'+Blockscad.Msg.GENERATE_STL+"</button>\n",e+="                  </div>\n",e+='                  <div id="render-ongoing" class="render-ongoing">'+Blockscad.Msg.PARSE_IN_PROGRESS+'  <img id=busy src="imgs/busy2.gif"></div>\n',e+='                  <div id="error-message"></div>\n',e+="                </div>\n",e+="               </div>\n",e+="              </div> \x3c!-- paneContainer --\x3e\n",e+="    </div>",e+="</div>",e+="        </div>\n",e+='        <pre class="tab-pane content scad-content" id="openScadPre"></pre>',e+="      </div>\n",e+="      \x3c!-- end tab content --\x3e\n",e+="    </div> \x3c!-- end of the #editView content  --\x3e\n",e+='    <div id="projectView" class="hidden">\n',e+='      <div style="width:100%; background-color:#bbbbff;">\n',e+='        <span class="proj-header">'+Blockscad.Msg.MY_PROJECTS+"</span>\n",e+='        <button type="button" class="btn btn-default new-project spacey">'+Blockscad.Msg.NEW_PROJECT_BUTTON+"</button>\n",e+='        <input type="text" class="search noselect" title="Filter" placeholder="'+Blockscad.Msg.PROJECT_LIST_FILTER+'"  id="ptsearch"/>\n',e+='        <button type="button" class="btn btn-default plist-cancel spacey">'+Blockscad.Msg.PROJECT_LIST_EXIT+"</button>\n",e+="      </div>\n",e+='        <table id="projTable" class="table table-striped sortable" style="padding:0px">\n',e+="          <colgroup>\n",e+='            <col style="width:80px">\n',e+='            <col class="col-md-4">\n',e+='            <col class="col-md-2">\n',e+='            <col class="col-md-2">\n',e+='            <col class="col-md-2">\n',e+='            <col class="col-md-2">\n',e+="          </colgroup>\n",e+="          <thead>\n",e+='              <th class="sorttable_nosort" style="width:80px">&nbsp;</th>\n',e+='              <th class="noselect">'+Blockscad.Msg.PROJECT_NAME+"</th>\n",e+='              <th class="noselect">'+Blockscad.Msg.PROJECT_LIST_LAST_MODIFIED+"</th>\n",e+='              <th class="noselect sorttable_nosort"></th>\n',e+='              <th class="noselect sorttable_nosort"></th>\n',e+='              <th class="sorttable_nosort"></th>\n',e+="          </thead> \n",e+='          <tbody id="projList">\n',e+="          </tbody>\n",e+="        </table>\n",e+='        <button type="button" id="list-more" class="btn btn-default" style="width:180px">'+Blockscad.Msg.PROJECT_LIST_MORE_BUTTON+"</button>\n",e+="    </div> \x3c!-- end of projectView --\x3e\n",e+="  </div> \x3c!-- end of main --\x3e\n",e+='<div id="eob-top" class="eobhidden transparent"></div>',e+='<div id="eob-right" class="eobhidden transparent"></div>',e+='<div id="eob-left" class="eobhidden transparent"></div>',e+='<div id="eob-bottom" class="eobhidden transparent"></div>',e+="  \x3c!-- html for Popups --\x3e\n",e+='  <div class="modal" id="tr-modal" data-backdrop="static">\n',e+='     <div class="modal-dialog ">\n',e+='         <div class="modal-content">\n',e+='             <div class="modal-header" style="padding:5px">\n',e+='                <h4 class="modal-title"><a href="../tr/home/"><img src="themes/custom/blockscad/logo_tr.svg" style="height:50px"></a></h4>\n',e+='                 \x3c!-- <button type="button" class="close" id="tr-modal-close">&times;</button> --\x3e\n',e+="             </div>\n",e+='            <div class="modal-body" id="tr-body">\n',e+="              <h4>BlocksCAD Türkiye erişim kodunu girin. <br>Kodu almak için info@blockscad3d.com.tr ile iletişime geçin.</h4>\n",e+='              <form class="form-inline" id="tr-form">\n',e+='                 <div class="input-group mb-2 mr-sm-2">\n',e+='                     <input type="text" class="form-control"  id="trcode">\n',e+="                 </div>\n",e+='                <button class="btn btn-default btn-lg" id="tr-submit">'+Blockscad.Msg.SUBMIT_BUTTON+"</button>\n",e+='                 <div id="tr-code-error"></div>\n',e+="              </form>\n",e+="            </div>\n",e+='             <div class="modal-footer" id="tr-footer">\n',e+='                 <button type="button" class="btn-default btn btn-lg" onclick="location.href=\'../account/register/?lang=tr\';">'+Blockscad.Msg.REGISTER_BUTTON+"</button>\n",e+='                <button type="button" class="btn btn-default btn-lg" onclick="location.href=\'../account/login/?lang=tr\';">'+Blockscad.Msg.LOGIN_BUTTON+"</button>\n",e+="            </div>\n",e+="         </div>\n",e+="    </div>\n",e+="  </div> \n",e+='  <div id="online-delete-confirm" class="modal" data-backdrop="false">\n',e+='    <div class="modal-dialog modal-sm" style="width:400px">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close">x\n',e+="          </a>\n",e+='          <h4 class="modal-title"></h4>\n',e+="        </div>\n",e+='        <div class="modal-footer">\n',e+='            <button id="toss-it" class="button btn-lg btn-default primary pull-left" style="margin-left:90px" type="button" data-dismiss="modal" data-target="#online-delete-confirm">'+Blockscad.Msg.CONFIRM_DIALOG_YES+"</button> \n",e+='            <button id="whatthe" class="button btn-default btn-lg primary" style="margin-right:90px" type="button" data-dismiss="modal" data-target="#online-delete-confirm">'+Blockscad.Msg.CONFIRM_DIALOG_NO+"</button> \n",e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of online delete-confirm popup --\x3e\n",e+='  <div id="online-submit-confirm" class="modal" data-backdrop="false">\n',e+='    <div class="modal-dialog modal-sm" style="width:400px">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close">x\n',e+="          </a>\n",e+='          <h4 class="modal-title"></h4>\n',e+="        </div>\n",e+='         <div class="modal-body">',e+='             <div class="form-group">',e+='               <label for="class-select">Class:</label>',e+='               <select class="form-control" id="sel-class">',e+="               </select>",e+="             </div>",e+='             <div class="form-group">',e+='                     <label for="print-instructions">Print instructions:</label>',e+='                     <textarea class="form-control" id="print-notes" rows="2" placeholder="Preferred colors?  Size restrictions?" maxlength="60"></textarea>',e+="             </div>",e+="         </div>",e+='        <div class="modal-footer">\n',e+='            <button id="submit-it" class="button btn-lg btn-default primary pull-left" style="margin-left:90px" type="button" data-dismiss="modal" data-target="#online-submit-confirm">Submit</button> \n',e+='            <button id="whatthe" class="button btn-default btn-lg primary" style="margin-right:90px" type="button" data-dismiss="modal" data-target="#online-submit-confirm">Cancel</button> \n',e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of online-submit-confirm popup --\x3e\n",e+='  <div id="add-print-notes" class="modal" data-backdrop="false">\n',e+='    <div class="modal-dialog modal-sm" style="width:400px">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close">x\n',e+="          </a>\n",e+='          <h4 class="modal-title">Add notes for printing</h4>\n',e+="        </div>\n",e+='         <div class="modal-body">',e+='             <div class="form-group">',e+='                     <label for="print-instructions">Print instructions:</label>',e+='                     <textarea class="form-control" id="aprint-notes" rows="2" placeholder="Preferred colors?  Size restrictions?" maxlength="60"></textarea>',e+="             </div>",e+="         </div>",e+='        <div class="modal-footer">\n',e+='            <button id="submit-it" class="button btn-lg btn-default primary pull-left" style="margin-left:90px" type="button" data-dismiss="modal" data-target="#add-print-notes">Add</button> \n',e+='            <button id="whatthe" class="button btn-default btn-lg primary" style="margin-right:90px" type="button" data-dismiss="modal" data-target="#add-print-notes">Cancel</button> \n',e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of add-print-notes popup --\x3e\n",e+='  <div id="about-modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="about-modal" aria-hidden="true">\n',e+='    <div class="modal-dialog">\n',e+='      <div class="modal-content">\n',e+='    <div class="modal-header">\n',e+='      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n',e+='      <h3 class="modal-title">BlocksCAD\n',e+="      <small>Easy, Open-Source Solid CAD for Everyone!</small></h3>\n",e+="    </div>\n",e+='    <div class="modal-body">\n',e+="      <div>\n",e+="        <p>Version "+Blockscad.version+" ("+Blockscad.releaseDate+")</p>\n",e+="        <br>\n",e+="          <p><small><small>Developed with the sponsorship of the Defense Advanced Research Projects Agency (DARPA) and delivered to the U.S. Government with Unlimited Rights as defined in DFARS 252.227-7013.<br>Approved for Public Release, Distribution Unlimited.<br>Copyright and Trademark 2014-2019 BlocksCAD, Inc.</small></small>\n",e+="          </p>\n",e+="      </div>\n",e+="    </div>\n",e+='    <div class="modal-footer">\n',e+='      <div class="row">\n',e+='        <div class="col-md-4">\n',e+='          <a href="http://www.gnu.org/licenses/gpl-3.0-standalone.html" target="_blank">Licensed GPLv3 or later</a></div>\n',e+='        <div class="col-md-4">\n',e+='          <a href="../terms" target="_blank">Terms of Use</a></div>\n',e+='        <div class="col-md-4">\n',e+='          <a href="../policies" target="_blank">Privacy Policy</a></div>\n',e+="      </div>\n",e+="    </div>\n",e+="  </div>\n",e+="    </div>\n",e+="  </div>\n",e+='  <div id="message-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="message-modal" aria-hidden="true">\n',e+='    <div class="modal-dialog modal-sm">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n',e+="        </div>\n",e+='        <div id="message-text" class="modal-body">Display a message here.\n',e+="        </div>\n",e+="      </div>\n",e+="    </div>\n",e+="  </div>\n",e+="\x3c!-- accessModal --\x3e",e+='<div class="modal" id="accessModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="color:black; text-align:center;">',e+='  <div class="modal-dialog" role="document">',e+='    <div class="modal-content" style="border-radius:12px;font-size:16px">',e+='      <div class="modal-header">',e+='        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color:black">&times;</span></button>',e+='        <h4 class="modal-title" id="myModalLabel">'+Blockscad.Msg.SITE_ACCESS_CODE_MESSAGE+"</h4>",e+="      </div>",e+='      <div class="modal-body">',e+='        <div class="row">',e+='          <form id="access-code-form">',e+='            <div class="form-group col-xs-6">',e+='              <input class="form-control" id="access-code-input" type="text" autocomplete="off" name="code" maxlength="12" />',e+="            </div>",e+='            <div class="col-xs-6">',e+='              <button id="access-submit-button" class="btn try-now" type="submit" style="margin:5px; font-size:16px; top:0px">'+Blockscad.Msg.SITE_ACCESS_CODE_BUTTON+"</button>",e+="            </div>        ",e+="          </form>",e+="        </div>",e+='        <div class="access-error" style="text-align:left; color:#D0021B"></div>',e+='        <div class="access-school-site-title"></div>',e+='        <div class="access-school-title" style="text-align:left">'+Blockscad.Msg.SITE_ACCESS_SCHOOLS+"</div>",e+='        <div class="access-post" style="text-align:left"></div>',e+='        <div class="grade-checkboxes" style="display:none"><hr> '+Blockscad.Msg.SITE_ACCESS_GRADES+"<br>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade3" value="3"> 3',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade4" value="4"> 4',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade5" value="5"> 5',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade6" value="6"> 6',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade7" value="7"> 7',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade8" value="8"> 8',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade9" value="9"> 9',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade10" value="10"> 10',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade11" value="11"> 11',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="grade12" value="12"> 12',e+="          </label>",e+='          <label class="checkbox-inline">',e+='            <input type="checkbox" id="gradeother" value="other"> '+Blockscad.Msg.SITE_ACCESS_GRADES_OTHER,e+="          </label>",e+='          <button id="grades-submit" class="btn try-now" style="margin:5px; font-size:16px; top:0px">'+Blockscad.Msg.SUBMIT_BUTTON+"</button>",e+="        </div>",e+='        <div class="prompt-account"></div>',e+="    </div>  \x3c!-- modal-header --\x3e",e+="    </div>  \x3c!-- modal-content --\x3e",e+="  </div>  \x3c!-- modal-dialog --\x3e",e+="</div> \x3c!-- modal --\x3e",e+='  <div id="eob-1" class="modal" tabindex="-1" data-backdrop="false">\n',e+='    <div class="modal-dialog">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close eob-cancel">X\n',e+="          </a>\n",e+='          <h4 class="modal-title">Welcome to BlocksCAD!</h4>\n',e+="        </div>\n",e+='         <div class="modal-body" style="padding-top:10px;padding-bottom:5px;">',e+='         <span style="font-size:1.5em;padding-right:10px;" class="glyphicon glyphicon-arrow-left"></span>',e+="         This is the <strong>TOOLBOX</strong>.<br>Click on <strong>3D Shapes</strong>, then drag a <strong>sphere</strong> block into the workspace.",e+='          <img src="imgs/toolbox_intro.gif" height="160">',e+="         </div>",e+='        <div class="modal-footer" style="padding:5px">\n',e+='            <button id="eob-1-next" class="btn btn-default" style="margin-right:100px" width="88px" type="button" data-dismiss="modal">Next >></button> \n',e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of eob-1 --\x3e\n",e+='  <div id="eob-2" class="modal" tabindex="-1" data-backdrop="false">\n',e+='    <div class="modal-dialog" style="width:500px">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close eob-cancel">X\n',e+="          </a>\n",e+='          <h4 class="modal-title">Render your code to see your model</h4>\n',e+="        </div>\n",e+='         <div class="modal-body" style="padding-top:10px;padding-bottom:5px;text-align:right">',e+="         This is the <strong>Render Window.</strong>",e+='         <span style="font-size:1.5em;padding-left:10px;" class="glyphicon glyphicon-arrow-right"></span>',e+="         <br>Click on <strong>RENDER</strong>, and drag the image to change your point of view.",e+='          <img src="imgs/render_intro.gif" height="210">',e+="         </div>",e+='        <div class="modal-footer" style="padding:5px">\n',e+='            <button id="eob-2-next" class="btn btn-default" style="margin-right:100px" width="88px" type="button" data-dismiss="modal">Next >></button> \n',e+='            <button id="eob-2-prev" class="btn btn-default pull-left" style="margin-left:100px" type="button" data-dismiss="modal"><< Previous</button> \n',e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of eob-2 --\x3e\n",e+='  <div id="eob-3" class="modal" tabindex="-1" data-backdrop="false">\n',e+='    <div class="modal-dialog" style="width:600px">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close eob-cancel">X\n',e+="          </a>\n",e+='          <h4 class="modal-title">Moving Shapes</h4>\n',e+="        </div>\n",e+='         <div class="modal-body" style="padding-top:10px;padding-bottom:5px;">',e+='          <img src="imgs/translate_intro.gif" height="240">',e+="         </div>",e+='        <div class="modal-footer" style="padding:5px">\n',e+='            <button id="eob-3-next" class="btn btn-default" style="margin-right:100px" type="button" width="88px" data-dismiss="modal">Next >></button> \n',e+='            <button id="eob-3-prev" class="btn btn-default pull-left" style="margin-left:100px" type="button" data-dismiss="modal"><< Previous</button> \n',e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of eob-3 --\x3e\n",e+='  <div id="eob-4" class="modal" tabindex="-1" data-backdrop="false">\n',e+='    <div class="modal-dialog" style="width:400px">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <a href="#" data-dismiss="modal" class="close eob-cancel">X\n',e+="          </a>\n",e+='          <h4 class="modal-title">Learn More <span style="font-size:1.3em;padding-left:55px;" class="glyphicon glyphicon-arrow-up"></span></h4>\n',e+="        </div>\n",e+='         <div class="modal-body" style="padding-top:10px;padding-bottom:5px;">',e+="           Learn from our examples and videos. <br>To rerun this tutorial, select  <strong>"+Blockscad.Msg.LEARN_MENU+" -> Intro Tutorial</strong><br>",e+='           <div class="eob-notloggedin"><br><span style="font-size:1.2em">Create an account to get free cloud storage!</span></div>',e+="         </div>",e+='        <div class="modal-footer eob-notloggedin" style="padding:5px">\n',e+='            <a href="#" id="eob-4-register" class="btn btn-default pull-left eob-cancel hello-button" style="margin-left:90px">'+Blockscad.Msg.REGISTER_BUTTON+"</a> \n",e+='            <a href="../account/login" id="eob-4-login" class="btn btn-default eob-cancel" style="margin-right:90px">'+Blockscad.Msg.LOGIN_BUTTON+"</a> \n",e+="        </div>\n",e+="      </div>\x3c!-- /.modal-content --\x3e\n",e+="    </div>\x3c!-- /.modal-dialog --\x3e\n",e+="  </div> \x3c!-- end of eob-4 --\x3e\n",e+='  <div id="notify-experimental" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="message-modal" aria-hidden="true" style="top:480px;width:570px;">\n',e+='    <div class="modal-dialog modal-sm">\n',e+='      <div class="modal-content">\n',e+='        <div class="modal-header">\n',e+='          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n',e+='          <h5 class="modal-title"><span style="font-size:1.3em;" class="glyphicon glyphicon-arrow-left"></span>For a limited time:<br>Try some triangle blocks</h5>\n',e+="        </div>\n",e+="      </div>\n",e+="    </div>\n",e+="  </div>  \x3c!-- end of notify-experimental --\x3e\n",e+='<div id="outage-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="outage-modal" aria-hidden="true">\n',e+='  <div class="modal-dialog">\n',e+='    <div class="modal-content">\n',e+='          <div class="modal-header">\n',e+='            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n',e+='            <h3 class="modal-title">Scheduled Database Maintenance Dec. 27</h3>\n',e+="          </div>\n",e+='          <div class="modal-body">\n',e+="            <div>\n",e+="              On Dec. 27, 2016, we will be upgrading the BlocksCAD project database. During this time, login will be disabled and you won't have access to your account or your saved projects. ",e+=" <br><br>If you plan to work on specific projects that day, be sure to download them to your computer before Dec. 27. Any edits to these projects or any new creations will need to be saved to your computer that day as well. \n",e+="            </div>\n",e+="          </div>\n",e+="  </div>\n",e+="</div>\n"}},BlocklyStorage=BlocklyStorage||{};(Blockscad=(Blockscad=Blockscad||{})||{}).Auth=Blockscad.Auth||{},(Blockly=Blockly||{}).Xml=Blockly.Xml||{},BlocklyStorage.autosaveBlocks=function(e){"localStorage"in window&&(localStorage.xml=e,localStorage.proj_name=$("#project-name").val())},BlocklyStorage.standaloneRestoreBlocks=function(){if(localStorage.xml){var e=Blockly.Xml.textToDom(localStorage.xml);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,e);var t=localStorage.proj_name;"undefined"!=t?$("#project-name").val(t):$("#project-name").val("Untitled")}},BlocklyStorage.storeZspace=function(e){if("localStorage"in window){window.localStorage.setItem("zspace_display",e)}},BlocklyStorage.retrieveZspace=function(){return"true"==window.localStorage.zspace_display},BlocklyStorage.autoBackupBlocks=function(){if("localStorage"in window){console.log("autobackup localstorage now");var e=Blockly.Xml.workspaceToDom(Blockscad.workspace),t=window.location.href.split("#")[0],o=(t=t.split("?")[0])+"proj_name",a=t+"pid",n=t+"pp",s=t+"needToSave",l="Blockscad.pLang",r=t+"assignmentId",c=t+"due_date",i=t+"instructionsUrl",d="authorDisplayName";window.localStorage.setItem(t,Blockly.Xml.domToText(e)),window.localStorage.setItem(o,$("#project-name").val()),window.localStorage.setItem(a,Blockscad.Auth.projectId),window.localStorage.setItem(n,Blockscad.Auth.projectParent),window.localStorage.setItem(s,Blockscad.needToSave),window.localStorage.setItem("sessionHistory",Blockscad.Auth.processSessionHistory(Blockscad.Auth.sessionHistory)),Blockscad.Auth.assignmentId?(window.localStorage.setItem(r,Blockscad.Auth.assignmentId),window.localStorage.setItem(c,Blockscad.Auth.assignmentDueDateString),window.localStorage.setItem(i,Blockscad.Auth.instructionsString)):(localStorage.removeItem(r),localStorage.setItem(c,""),localStorage.setItem(i,"")),Blockscad.Auth.teacher_edit?(window.localStorage.setItem("teacher_edit",Blockscad.Auth.teacher_edit),window.localStorage.setItem("class_id",Blockscad.Auth.class_id),window.localStorage.setItem("class_name",Blockscad.Auth.class_name),window.localStorage.setItem(d,Blockscad.Auth.authorDisplayName),window.localStorage.setItem("inspiredBy",Blockscad.Auth.inspiredBy),window.localStorage.setItem("secondsSpent",Blockscad.Auth.secondsSpent)):(window.localStorage.setItem("teacher_edit",""),window.localStorage.setItem("class_id",""),window.localStorage.setItem(d,""),window.localStorage.setItem("inspiredBy",""),window.localStorage.setItem("secondsSpent","")),Blockscad.pLang?window.localStorage.setItem(l,Blockscad.pLang):localStorage.removeItem(l)}},BlocklyStorage.backupBlocks_=function(){if("localStorage"in window){var e=[];for($.each(localStorage,function(t,o){e.push(t)}),m=0;m<e.length;m++){var t=e[m].match(/_stl_/);t&&t.length>0&&(console.log("clearing stl from local storage"),console.log("clearing stl from local storage"),localStorage.removeItem(e[m]))}for(var o=Blockly.Xml.workspaceToDom(Blockscad.workspace),a=window.location.href.split("#")[0],n=(a=a.split("?")[0])+"proj_name",s=a+"pid",l=a+"pp",r=a+"needToSave",c="Blockscad.pLang",i=a+"assignmentId",d=a+"due_date",u=a+"time_spent",h=a+"instructionsUrl",p="authorDisplayName",f=Blockscad.workspace.getAllBlocks(),m=0;m<f.length;m++)if("stl_import"==f[m].type){var g=f[m].getField("STL_CONTENTS").getText();if(g.length>0){var b=a+"_stl_"+g,k=a+"_stl_"+g+"center";if(Blockscad.csg_commands[g].length<3e6){var v=Base64.toBase64(RawDeflate.deflate(Base64.utob(Blockscad.csg_commands[g])));window.localStorage.setItem(b,v),window.localStorage.setItem(k,Blockscad.csg_center[g])}}}window.localStorage.setItem(a,Blockly.Xml.domToText(o)),window.localStorage.setItem(n,$("#project-name").val()),window.localStorage.setItem(s,Blockscad.Auth.projectId),window.localStorage.setItem(l,Blockscad.Auth.projectParent),window.localStorage.setItem(r,Blockscad.needToSave),window.localStorage.setItem("sessionHistory",Blockscad.Auth.processSessionHistory(Blockscad.Auth.sessionHistory)),Blockscad.Auth.assignmentId?(window.localStorage.setItem(i,Blockscad.Auth.assignmentId),window.localStorage.setItem(d,Blockscad.Auth.assignmentDueDateString),window.localStorage.setItem(h,Blockscad.Auth.instructionsString)):(localStorage.removeItem(i),localStorage.setItem(d,""),localStorage.setItem(h,"")),Blockscad.Auth.teacher_edit?(console.log("in storage.  Storing teacher_edit as:",Blockscad.Auth.teacher_edit),window.localStorage.setItem("teacher_edit",Blockscad.Auth.teacher_edit),window.localStorage.setItem("class_id",Blockscad.Auth.class_id),window.localStorage.setItem("class_name",Blockscad.Auth.class_name),window.localStorage.setItem(p,Blockscad.Auth.authorDisplayName),window.localStorage.setItem("inspiredBy",Blockscad.Auth.inspiredBy),window.localStorage.setItem("secondsSpent",Blockscad.Auth.secondsSpent)):(window.localStorage.setItem("teacher_edit",""),window.localStorage.setItem("class_id",""),window.localStorage.setItem(p,""),window.localStorage.setItem("inspiredBy",""),window.localStorage.setItem("secondsSpent","")),Blockscad.pLang?window.localStorage.setItem(c,Blockscad.pLang):localStorage.removeItem(c);var B=Math.round(TimeMe.getTimeOnCurrentPageInSeconds());B<3&&(B=0),isNaN(B)&&(B=0),window.localStorage.setItem(u,B),TimeMe.resetRecordedPageTime("blockscad_editor"),TimeMe.initialize({currentPageName:"blockscad_editor",idleTimeoutInSeconds:120})}},BlocklyStorage.backupOnUnload=function(){window.addEventListener("unload",BlocklyStorage.backupBlocks_,!1)},BlocklyStorage.restoreBlocks=function(){var e=window.location.href.split("#")[0],t=(e=e.split("?")[0])+"proj_name",o=e+"pid",a=e+"pp",n=e+"needToSave",s=e+"assignmentId",l=e+"due_date",r=e+"time_spent",c=e+"instructionsUrl";if("localStorage"in window&&window.localStorage[e]){console.log("setting record history to false"),Blockscad.recordHistory=!1;var i=Blockly.Xml.textToDom(window.localStorage[e]);Blockly.Xml.domToWorkspace(i,Blockscad.workspace),setTimeout(function(){Blockscad.recordHistory=!0},10);for(var d=Blockscad.workspace.getAllBlocks(),u=0;u<d.length;u++)if("stl_import"==d[u].type){var h=d[u].getField("STL_CONTENTS").getText(),p=d[u].getField("STL_FILENAME").getText(),f=d[u].getField("STL_BUTTON");if(h.length>0){var m=e+"_stl_"+h,g=e+"_stl_"+h+"center",b=window.localStorage[m],k=window.localStorage[g];if(b&&b.length>0){f.setVisible(!1);var v=Base64.btou(RawDeflate.inflate(Base64.fromBase64(b)));Blockscad.csg_commands[h]=v,Blockscad.csg_filename[h]=p+":::",Blockscad.csg_center[h]=k,d[u].render()}else{console.log("couldn't find the stl in localStorage"),$("#error-message").html("Warning: Re-load your .STL files"),d[u].getField("STL_CONTENTS").setText(""),d[u].getField("STL_FILENAME").setText("");var B=d[u].getCommentText();B.match(/^RELOAD/)||(B="RELOAD: "+B),d[u].setCommentText(B),f.setText("Reload"),d[u].backlight();var M=d[u].collapsedParents();if(M)for(var w=0;w<M.length;w++)M[w].backlight();d[u].isCollapsed()||f.setVisible(!0);for(var x=d[u],y=null;x;)x.isCollapsed()&&(y=x),x=x.getSurroundParent();y&&y.setCollapsed(!0,!0),d[u].render()}}}var S=window.localStorage[t];"undefined"!=S?$("#project-name").val(S):$("#project-name").val("Untitled");var _=window.localStorage[o];Blockscad.Auth.projectId=_>0?_:0;var E=window.localStorage[a];Blockscad.Auth.projectParent=E>0?E:0,Blockscad.Auth.unprocessSessionHistory(window.localStorage.sessionHistory);var I=window.localStorage[n];"undefined"==I||1!=Number(I)&&0!=Number(I)||setTimeout(function(){Blockscad.needToSave=Number(I)},300);var T=window.localStorage[s];if(T&&"undefined"!=T&&Number(T)>0?(Blockscad.Auth.assignmentId=Number(T),Blockscad.Auth.assignmentDueDateString=window.localStorage[l],Blockscad.Auth.instructionsString=window.localStorage[c],Blockscad.Auth.setAssignmentProps()):(Blockscad.Auth.assignmentId=0,Blockscad.Auth.assignmentDueDateString="",Blockscad.Auth.unsetAssignmentProps()),!Blockscad.Auth.teacher_edit){var A=window.localStorage.teacher_edit;A&&"undefined"!=A&&""!=A&&"false"!=A&&"0"!=A&&(console.log("found teacher_edit in localStorage:",A),Blockscad.Auth.teacher_edit=window.localStorage.teacher_edit,Blockscad.Auth.class_id=window.localStorage.class_id,Blockscad.Auth.class_name=window.localStorage.class_name,Blockscad.Auth.authorDisplayName=window.localStorage.authorDisplayName,Blockscad.Auth.inspiredBy=window.localStorage.inspiredBy,"null"!=Blockscad.Auth.inspiredBy&&"undefined"!=Blockscad.Auth.inspiredBy||(Blockscad.Auth.inspiredBy=null),Blockscad.Auth.secondsSpent=window.localStorage.secondsSpent,Blockscad.Auth.setTeacherEdit())}var D=Number(window.localStorage[r]);D&&!isNaN(D)&&D>2&&setTimeout(function(){Blockscad.Auth.saveTimes(D)},500)}};var BSUtils=BSUtils||{};function promptForX(e,t,o,a){var n="<h4>"+e+"</h4>";return new Promise(function(e,s){bootbox.dialog({message:n,backdrop:!0,size:"small",buttons:{yes:{label:t,className:"btn-default btn-lg primary pull-right giant-yes",callback:function(t){e(a||!0)}},no:{label:o,className:"btn-default btn-lg primary pull-left giant-yes",callback:function(t){e(!1)}}},onEscape:function(){e("cancel")}})})}(Blockscad=Blockscad||{}).Auth=Blockscad.Auth||{},BSUtils.LANGUAGE_NAME={cs:"Český",en:"English",de:"Deutsch",es:"Español",fr:"Français",it:"Italiano",ja:"日本語",nb:"Norsk Bokmål",pl:"Polski",ru:"русский",sl:"Slovenščina",sv:"Svenska",tr:"Türkçe","zh-hans":"简体中文"},BSUtils.LANGUAGE_FILE_NAME={cs:"ccs-92e01c4538.js",en:"en-a7e1aab73d.js",de:"de-0327d8038c.js",fr:"fr-e1b3cdb386.js",it:"it-ffd219b05b.js",es:"es-4355ba35f5.js",ja:"ja-d7d6613b78.js",nb:"nb-8518413722.js",pl:"pl-588ee8a47f.js",ru:"ru-6445e8b3a4.js",sl:"sl-e79eeb2b71.js",sv:"sv-c9e8fe0fe8.js",tr:"tr-d9cb5d7aed.js","zh-hans":"zh-hans-6491f80d55.js"},BSUtils.LANGUAGE_RTL=["ar","fa","he"],BSUtils.LANGUAGES=void 0,BSUtils.getStringParamFromUrl=function(e,t){var o=window.location.search.match(new RegExp("[?&]"+e+"=([^&]+)"));return o?decodeURIComponent(o[1].replace(/\+/g,"%20")):t},Blockscad.getLangFromLS=function(){return window.localStorage["Blockscad.pLang"]},BSUtils.getLang=function(){var e=BSUtils.getStringParamFromUrl("lang","");if(void 0===BSUtils.LANGUAGE_NAME[e]){var t=Blockscad.getLangFromLS();e=t&&"null"!=t?t:"en"}Blockscad.pLang=e;return 1==Blockscad.standalone?document.write('<script src="dist/'+BSUtils.LANGUAGE_FILE_NAME[e]+'"><\/script>\n'):document.write('<script src="dist/'+BSUtils.LANGUAGE_FILE_NAME[e]+'"><\/script>\n'),e},BSUtils.LANG=BSUtils.getLang(),BSUtils.isRtl=function(){return-1!=BSUtils.LANGUAGE_RTL.indexOf(BSUtils.LANG)},BSUtils.loadBlocks=function(e){if(e){var t=Blockly.Xml.textToDom(e);Blockly.Xml.domToWorkspace(t,Blockly.mainWorkspace)}else"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)},BSUtils.changeLanguage=function(){BlocklyStorage.backupBlocks_();var e=encodeURIComponent($(this).data("lang")),t=window.location.search;t=t.length<=1?"?lang="+e:t.match(/[?&]lang=[^&]*/)?t.replace(/([?&]lang=)[^&]*/,"$1"+e):t.replace(/\?/,"?lang="+e+"&"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+t},BSUtils.getBBox_=function(e){var t=e.offsetHeight,o=e.offsetWidth,a=0,n=0;do{a+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent}while(e);return{height:t,width:o,x:a,y:n}},BSUtils.addTouchEvents=function(){if("ontouchstart"in document.documentElement)for(var e,t=document.getElementsByTagName("button"),o=0;e=t[o];o++)e.ontouchend||(e.ontouchend=e.onclick)},window.addEventListener("load",BSUtils.addTouchEvents,!1),BSUtils.bindClick=function(e,t){"string"==typeof e&&(e=document.getElementById(e)),e.addEventListener("click",t,!0),e.addEventListener("touchend",t,!0)},BSUtils.debounce=function(e,t,o){var a;return function(){var n=this,s=arguments,l=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||e.apply(n,s)},t),l&&e.apply(n,s)}},Blockscad.Auth.unsetAssignmentProps=function(){$("#project-name").prop("readOnly",!1),$("#project-name").css("width","270px"),$("#edproject-due-date").text(""),$("#edproject-due-date").removeClass("adue"),$("#edproject-instructions").html("")},Blockscad.Auth.setAssignmentProps=function(){$("#project-name").prop("readOnly",!0),$("#project-name").css("width","200px"),$("#edproject-due-date").text(Blockscad.Auth.assignmentDueDateString),$("#edproject-due-date").addClass("adue"),$("#edproject-instructions").html(Blockscad.Auth.instructionsString)},Blockscad.Auth.getTimeSpentString=function(e){if(e&&"null"!=e){var t=Math.floor(e/3600);e%=3600;var o=Math.floor(e/60),a=t+":";a+=o<10?"0"+o:o}else a="0:00";return a},(Blockscad=Blockscad||{}).Toolbox={};var Blockly=Blockly||{};Blockscad.Toolbox.catIDs=[],Blockscad.Toolbox.allcats=["HEX_3D_PRIMITIVE","HEX_2D_PRIMITIVE","HEX_TRANSFORM","HEX_SETOP","HEX_MATH","HEX_LOGIC","HEX_LOOP","HEX_TEXT","HEX_VARIABLE","HEX_PROCEDURE","HEX_EXPERIMENTAL","HEX_TEACHER"],Blockscad.Toolbox.whichCatsInSimple=[0,2,3,4,8,9,11],Blockscad.Toolbox.whichCatsInAdv=[0,1,2,3,4,5,6,7,8,9,10,11],Blockscad.Toolbox.whichCatsInExp=[0,1,2,3,4,5,6,7,8,9,10,11],Blockscad.Toolbox.colorScheme={},Blockscad.Toolbox.colorScheme.one=["#006205","#209303","#26549E","#7450E2","#0185E1","#BF6920","#612485","#727272","#8C7149","#900355","#000000","#FF5C5C"],Blockscad.Toolbox.colorScheme.two=["#885ee3","#82af5a","#23901c","#377eb8","#ba9969","#afaf13","#a66658","#d761bf","#999999","#b02375","#333333","#FF5C5C"],Blockscad.Toolbox.catHex=[],Blockscad.Toolbox.setColorScheme=function(e){for(var t=0;t<Blockscad.Toolbox.allcats.length;t++)Blockscad.Toolbox[Blockscad.Toolbox.allcats[t]]=e[t],Blockscad.Toolbox.catHex[t]=e[t]},Blockscad.Toolbox.setCatColors=function(){if(Blockscad.Toolbox.catIDs.length+2<Blockscad.Toolbox.allcats.length)for(var e=0;e<Blockscad.Toolbox.catIDs.length;e++){document.getElementById(Blockscad.Toolbox.catIDs[e]).style.background=Blockscad.Toolbox.catHex[Blockscad.Toolbox.whichCatsInSimple[e]]}else for(e=0;e<Blockscad.Toolbox.catIDs.length;e++){document.getElementById(Blockscad.Toolbox.catIDs[e]).style.background=Blockscad.Toolbox.catHex[Blockscad.Toolbox.whichCatsInAdv[e]]}},Blockscad.Toolbox.createToolbox=function(e){Blockscad.Toolbox.cat_3D='<category name="'+Blockscad.Msg.CATEGORY_3D_SHAPES+'"><block type="sphere"><value name="RAD"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="cube"><value name="XVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="cylinder"><value name="RAD1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="RAD2"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="HEIGHT"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="torus"><value name="RAD1"><shadow type="math_number"><field name="NUM">4</field></shadow></value><value name="RAD2"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="SIDES"><shadow type="math_number"><field name="NUM">8</field></shadow></value><value name="FACES"><shadow type="math_number"><field name="NUM">16</field></shadow></value></block></category>',Blockscad.Toolbox.cat_3D_sim='<category name="'+Blockscad.Msg.CATEGORY_3D_SHAPES+'"><block type="sphere"><value name="RAD"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="cube"><value name="XVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="cylinder"><value name="RAD1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="RAD2"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="HEIGHT"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block></category>',Blockscad.Toolbox.cat2D='<category name="'+Blockscad.Msg.CATEGORY_2D_SHAPES+'"><block type="circle"><value name="RAD"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="square"><value name="XVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block></category>',Blockscad.Toolbox.cat2DTriangles='<category name="'+Blockscad.Msg.CATEGORY_2D_SHAPES+'"><block type="circle"><value name="RAD"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="square"><value name="XVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="triangle_sss"><value name="SIDE1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="SIDE2"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="SIDE3"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="triangle_ssa"><value name="SIDE1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="SIDE2"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="ANGLE1"><shadow type="math_angle"><field name="NUM">30</field></shadow></value></block><block type="triangle_asa"><value name="ANGLE1"><shadow type="math_angle"><field name="NUM">30</field></shadow></value><value name="ANGLE2"><shadow type="math_angle"><field name="NUM">60</field></shadow></value><value name="SIDE1"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="polygon"><value name="A"><block type="point_2d"><value name="X"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="Y"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block></value><value name="B"><block type="point_2d"><value name="X"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="Y"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block></value><value name="PLUS0"><block type="point_2d"><value name="X"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="Y"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block></value></block></category>',Blockscad.Toolbox.catTransform='<category name="'+Blockscad.Msg.CATEGORY_TRANSFORMATIONS+'"><block type="translate"><value name="XVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="simplerotate"><value name="XVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value><value name="YVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value><value name="ZVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value></block><block type="simplemirror_new"></block><block type="scale"><value name="XVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="color"><value name="COLOR"><shadow type="colour_picker"><field name="COLOUR">#ffcc00</field></shadow></value></block><block type="color_rgb_looped"><value name="RED"><shadow type="math_number"><field name="NUM">100</field></shadow></value><value name="GREEN"><shadow type="math_number"><field name="NUM">100</field></shadow></value><value name="BLUE"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="$fn"><value name="SIDES"><shadow type="math_number"><field name="NUM">8</field></shadow></value></block><block type="taper"><value name="FACTOR"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="linearextrude"><value name="HEIGHT"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="TWIST"><shadow type="math_angle"><field name="NUM">0</field></shadow></value><value name="XSCALE"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="YSCALE"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="rotateextrude"><value name="FACES"><shadow type="math_number"><field name="NUM">5</field></shadow></value></block><block type="fancyrotate"><value name="AVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value><value name="XVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="fancymirror"><value name="XVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block></category>',Blockscad.Toolbox.catTransform_sim='<category name="'+Blockscad.Msg.CATEGORY_TRANSFORMATIONS+'"><block type="translate"><value name="XVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="simplerotate"><value name="XVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value><value name="YVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value><value name="ZVAL"><shadow type="math_angle"><field name="NUM">0</field></shadow></value></block><block type="scale"><value name="XVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="YVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="ZVAL"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="color"><value name="COLOR"><shadow type="colour_picker"><field name="COLOUR">#ffcc00</field></shadow></value></block><block type="$fn"><value name="SIDES"><shadow type="math_number"><field name="NUM">8</field></shadow></value></block></category>',Blockscad.Toolbox.catSetOps='<category name="'+Blockscad.Msg.CATEGORY_SET_OPERATIONS+'"><block type="union"></block><block type="difference"></block><block type="intersection"></block><block type="hull"></block></category>',Blockscad.Toolbox.catSetOps_sim='<category name="'+Blockscad.Msg.CATEGORY_SET_OPERATIONS+'"><block type="union"></block><block type="difference"></block><block type="intersection"></block></category>',Blockscad.Toolbox.catMathLogic='<category name="'+Blockscad.Msg.CATEGORY_MATH+'"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="math_single"><value name="NUM"><shadow type="math_number"><field name="NUM">9</field></shadow></value></block><block type="math_trig"><value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block><block type="math_constant_bs"></block><block type="math_number_property"><value name="NUMBER_TO_CHECK"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="math_round"><value name="NUM"><shadow type="math_number"><field name="NUM">3.1</field></shadow></value></block><block type="math_modulo"><value name="DIVIDEND"><shadow type="math_number"><field name="NUM">64</field></shadow></value><value name="DIVISOR"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="math_constrain"><value name="VALUE"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="LOW"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="HIGH"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_int"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_float"></block></category><category name="'+Blockscad.Msg.CATEGORY_LOGIC+'"><block type="controls_if"></block><block type="logic_compare"></block><block type="logic_operation"></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_ternary"></block></category>',Blockscad.Toolbox.catMathLogic_sim='<category name="'+Blockscad.Msg.CATEGORY_MATH+'"><block type="math_number"></block><block type="math_angle"></block><block type="math_arithmetic"></block><block type="math_single"></block><block type="math_random_int"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block></category>',Blockscad.Toolbox.catLoops='<category name="'+Blockscad.Msg.CATEGORY_LOOPS+'"><block type="controls_for"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow> </value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block></category>',Blockscad.Toolbox.catOther='<category name="'+Blockscad.Msg.CATEGORY_TEXT+'"><block type="bs_text"><value name="TEXT"><shadow type="text"></shadow></value><value name="SIZE"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="bs_3dtext"><value name="TEXT"><shadow type="text"></shadow></value><value name="SIZE"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="THICKNESS"><shadow type="math_number"><field name="NUM">2</field></shadow></value></block><block type="text"></block><block type="bs_text_length"><value name="VALUE"><shadow type="text"><field name="TEXT">'+Blockscad.Msg.TEXT_DEFAULT_VALUE+"</field></shadow></value></block>",Blockscad.Toolbox.catOther+='</category><category name="'+Blockscad.Msg.CATEGORY_VARIBLES+'" custom="VARIABLE"></category><category name="'+Blockscad.Msg.CATEGORY_PROCEDURES+'" custom="PROCEDURE"></category>',Blockscad.Toolbox.catOther_sim='<category name="'+Blockscad.Msg.CATEGORY_VARIBLES+'" custom="VARIABLE"></category><category name="'+Blockscad.Msg.CATEGORY_PROCEDURES+'" custom="PROCEDURE"></category>',Blockscad.Toolbox.catExperimental='<category name="'+Blockscad.Msg.CATEGORY_EXPERIMENTAL+'"><block type="triangle_sss_3d"><value name="SIDE1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="SIDE2"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="SIDE3"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="HEIGHT"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="triangle_ssa_3d"><value name="SIDE1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="SIDE2"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="ANGLE1"><shadow type="math_angle"><field name="NUM">30</field></shadow></value><value name="HEIGHT"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="triangle_asa_3d"><value name="ANGLE1"><shadow type="math_angle"><field name="NUM">30</field></shadow></value><value name="ANGLE2"><shadow type="math_angle"><field name="NUM">60</field></shadow></value><value name="SIDE1"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="HEIGHT"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block></category>',Blockscad.Toolbox.teacherBlocks="",e&&(Blockscad.Toolbox.teacherBlocks+='<category name="Teacher">',Blockscad.Toolbox.teacherBlocks+='<block type="bs_message"></block>',Blockscad.Toolbox.teacherBlocks+="</category>"),Blockscad.Toolbox.end="</xml>",Blockscad.Toolbox.adv='<xml id="toolbox" style="display: none">',Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat_3D,Blockscad.Toolbox.adv+=Blockscad.Toolbox.cat2D,Blockscad.Toolbox.adv+=Blockscad.Toolbox.catTransform,Blockscad.Toolbox.adv+=Blockscad.Toolbox.catSetOps,Blockscad.Toolbox.adv+=Blockscad.Toolbox.catMathLogic,Blockscad.Toolbox.adv+=Blockscad.Toolbox.catLoops,Blockscad.Toolbox.adv+=Blockscad.Toolbox.catOther,Blockscad.Toolbox.adv+=Blockscad.Toolbox.catExperimental,Blockscad.Toolbox.adv+=Blockscad.Toolbox.teacherBlocks,Blockscad.Toolbox.adv+=Blockscad.Toolbox.end,Blockscad.Toolbox.adv_w_triangles='<xml id="toolbox" style="display: none">',Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.cat_3D,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.cat2DTriangles,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.catTransform,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.catSetOps,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.catMathLogic,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.catLoops,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.catOther,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.teacherBlocks,Blockscad.Toolbox.adv_w_triangles+=Blockscad.Toolbox.end,Blockscad.Toolbox.advExp='<xml id="toolbox" style="display: none">',Blockscad.Toolbox.advExp+=Blockscad.Toolbox.cat_3D,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.cat2D,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.catTransform,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.catSetOps,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.catMathLogic,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.catLoops,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.catOther,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.catExperimental,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.teacherBlocks,Blockscad.Toolbox.advExp+=Blockscad.Toolbox.end,Blockscad.Toolbox.sim='<xml id="toolbox" style="display: none">',Blockscad.Toolbox.sim+=Blockscad.Toolbox.cat_3D_sim,Blockscad.Toolbox.sim+=Blockscad.Toolbox.catTransform_sim,Blockscad.Toolbox.sim+=Blockscad.Toolbox.catSetOps_sim,Blockscad.Toolbox.sim+=Blockscad.Toolbox.catMathLogic_sim,Blockscad.Toolbox.sim+=Blockscad.Toolbox.catOther_sim,Blockscad.Toolbox.sim+=Blockscad.Toolbox.teacherBlocks,Blockscad.Toolbox.sim+=Blockscad.Toolbox.end},(Blockscad=Blockscad||{}).Toolbox=Blockscad.Toolbox||{},Blockscad.Auth=Blockscad.Auth||{};var Blockscad;BlocklyStorage=BlocklyStorage||{},Blockly=Blockly||{},BSUtils=BSUtils||{};function readSingleFile(e,t){var o=e.target.files[0];if(o){var a;t&&(a=(a=(a=o.name.substr(0,o.name.lastIndexOf("("))||o.name).substr(0,o.name.lastIndexOf("."))||a).replace(/^\s+|\s+$/g,"")),t&&(Blockscad.Auth.currentProject=""),t&&Blockly.getMainWorkspace().clear();var n={},s=new FileReader;s.onload=function(e){n=e.target.result;var t=Blockly.Xml.textToDom(n);Blockly.Xml.domToWorkspace(t,Blockscad.workspace),Blockly.svgResize(Blockscad.workspace),Blockscad.clearStlBlocks()},s.readAsText(o),$("#importLocal")[0].value="",$("#loadLocal")[0].value="",t&&$("#project-name").val(a),$("#projectView").addClass("hidden"),$("#editView").removeClass("hidden"),Blockscad.offline||$("#bigsavebutton").removeClass("hidden"),$("#displayBlocks").click(),window.dispatchEvent(new Event("resize")),Blockscad.gProcessor.clearViewer()}}function promptForSave(){var e="<h4>"+Blockscad.Msg.SAVE_PROMPT+"</h4>";return new Promise(function(t,o){bootbox.dialog({message:e,backdrop:!0,size:"small",buttons:{save:{label:Blockscad.Msg.SAVE_PROMPT_YES,className:"btn-default btn-lg primary pull-right giant-yes",callback:function(e){t("save")}},dont_save:{label:Blockscad.Msg.SAVE_PROMPT_NO,className:"btn-default btn-lg primary pull-left giant-yes",callback:function(e){t("nosave")}}},onEscape:function(){t("cancel")}})})}function importSTL(e,t){for(var o=!0,a=0;a<e.length;a++)if(0==e[a].charCodeAt(0)){o=!1;break}return console.log("STL file is ascii: ",o),o?importAsciiSTL(e,t):importBinarySTL(e,t)}function importBinarySTL(e,t){var o=[],a=new BinaryReader(e);a.seek(80);for(var n=a.readUInt32(),s=[1e4,1e4,1e4],l=[-1e4,-1e4,-1e4],r=0;r<n;r++){a.readFloat(),a.readFloat(),a.readFloat();var c=[];c.push(a.readFloat()),c.push(a.readFloat()),c.push(a.readFloat());var i=[];i.push(a.readFloat()),i.push(a.readFloat()),i.push(a.readFloat());var d=[];d.push(a.readFloat()),d.push(a.readFloat()),d.push(a.readFloat());for(var u=0,h=0;h<3;h++)isNaN(c[h])&&u++,isNaN(i[h])&&u++,isNaN(d[h])&&u++;if(u>0&&console.log("this many bad vertices: ",u),a.readUInt16(),!u){o.push(c),o.push(i),o.push(d);for(h=0;h<3;h++)s[h]=Math.min(s[h],c[h]),s[h]=Math.min(s[h],i[h]),s[h]=Math.min(s[h],d[h]),l[h]=Math.max(l[h],c[h]),l[h]=Math.max(l[h],i[h]),l[h]=Math.max(l[h],d[h])}}u&&console.log("WARNING: import errors: expect some missing or bad triangles\n");var p=[Math.round(l[0]-(l[0]-s[0])/2),Math.round(l[1]-(l[1]-s[1])/2),Math.round(l[2]-(l[2]-s[2])/2)];return[vt2csg(o),p]}function importAsciiSTL(e,t){for(var o="",a=[],n=0,s=0,l=[1e4,1e4,1e4],r=[-1e4,-1e4,-1e4],c=e.split("\n"),i=0;i<c.length;i++)if(!c[i].match(/facet/)&&!c[i].match(/endloop/))if(c[i].match(/outer/)){s=0,n=0;var d=[];d[0]=[],d[1]=[],d[2]=[]}else if(c[i].match(/vertex/)){c[i]=c[i].replace(/^\s+|\s+$/g,"");var u=c[i].split(" ");if(d[s].push(parseFloat(u[1])),d[s].push(parseFloat(u[2])),d[s].push(parseFloat(u[3])),isNaN(d[s][0])&&n++,isNaN(d[s][1])&&n++,isNaN(d[s][2])&&n++,n>0&&(console.log("this many bad vertices: ",n),console.log("things are:",u)),!n&&3==++s){a.push(d[0]),a.push(d[1]),a.push(d[2]);for(var h=0;h<3;h++)l[h]=Math.min(l[h],d[0][h]),l[h]=Math.min(l[h],d[1][h]),l[h]=Math.min(l[h],d[2][h]),r[h]=Math.max(r[h],d[0][h]),r[h]=Math.max(r[h],d[1][h]),r[h]=Math.max(r[h],d[2][h])}}else;var p=[Math.round(r[0]-(r[0]-l[0])/2),Math.round(r[1]-(r[1]-l[1])/2),Math.round(r[2]-(r[2]-l[2])/2)];return[o+=vt2csg(a),p]}function vt2csg(e){var t="";t+="CSG.fromPolygons([";for(var o=0;o<e.length/3;o++){t+="new CSG.Polygon([";for(var a=0;a<3;a++)t+="new CSG.Vertex(new CSG.Vector3D([",t+=e[3*o+a]+"]))",a<2&&(t+=",");t+="])",o<e.length/3-1&&(t+=",")}return t+="])"}Blockscad.version="1.13.0",Blockscad.releaseDate="2021/03/31",Blockscad.offline=!1,Blockscad.standalone=!1,Blockscad.gProcessor=null,Blockscad.drawAxes=1,Blockscad.resolution=1,Blockscad.showMessageModal=!1,Blockscad.init=function(){Blockscad.zSpaceURLArgs=BSUtils.getStringParamFromUrl("zspace",""),console.log("ARGS IS:",Blockscad.zSpaceURLArgs),Blockscad.tryzSpace=!1;var e=BlocklyStorage.retrieveZspace();console.log("saved_as_zspace=",e),"true"==Blockscad.zSpaceURLArgs?(Blockscad.tryzSpace=!0,BlocklyStorage.storeZspace("true"),e=!0):"false"==Blockscad.zSpaceURLArgs?(console.log("falsifying zspaceness"),Blockscad.tryzSpace=!1,BlocklyStorage.storeZspace("false"),e=!1):e&&(Blockscad.tryzSpace=!0);Blockscad.splitPanes=Split(["#left-resizable-panel","#right-resizable-panel"],{sizes:[65,35],minSize:5,gutterSize:22,gutterAlign:"end",onDrag:function(){Blockscad.onresize()}}),Blockscad.initLanguage(),"tr"==Blockscad.pLang?($("#brand_link").html('<img src="../themes/custom/blockscad/logo_tr.svg" style="height:44px">'),$("#brand_link").prop("href","/tr/home")):($("#brand_link").html('<img src="themes/custom/blockscad/logo.svg" style="height:44px">'),$("#brand_link").prop("href","/")),Blockscad.browser=Blockscad.getBrowser(),Blockscad.offline||(Blockscad.Auth.init(),Blockscad.tryzSpace&&setTimeout(function(){history.replaceState({},"BlocksCAD","/editor/")},1e3)),Blockscad.inputVersion=Blockscad.version,Blockscad.missingFields=[],Blockscad.csg_commands={},Blockscad.csg_filename={},Blockscad.csg_center=[0,0,0],Blockscad.renderActions=[],Blockscad.Toolbox.createToolbox();document.getElementById("left-resizable-panel"),document.getElementById("blocklyDiv");Blockscad.workspace=Blockly.inject(document.getElementById("blocklyDiv"),{media:"blockly/media/",zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.04},trashcan:!1,toolbox:Blockscad.Toolbox.adv}),Blockscad.onresize=function(e){var t=document.getElementById("left-resizable-panel"),o=document.getElementById("blocklyDiv"),a=t,n=0,s=0;do{n+=a.offsetLeft,s+=a.offsetTop,a=a.offsetParent}while(a);o.style.left=n+"px",o.style.top=s+"px",o.style.width=t.offsetWidth+"px";var l=BSUtils.getBBox_(document.getElementById("main"));if(o.style.height=l.height-88+"px",Blockly.svgResize(Blockscad.workspace),$(".gutter-horizontal").height(l.height-88+"px"),null!=Blockscad.gProcessor&&null!=Blockscad.gProcessor.viewer){var r=$("#right-resizable-panel").height()-127,c=$("#right-resizable-panel").width();$("#renderDiv").width(c),$("#renderDiv").height(r),$("#paneContainer").width(c),Blockscad.gProcessor.viewer.onWindowResize(c,r)}},window.addEventListener("resize",Blockscad.onresize,!1),Blockscad.Auth.sessionHistory=[],Blockscad.recordHistory=!0,Blockscad.workspace.addChangeListener(Blockscad.handleWorkspaceEvents),Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one),Blockscad.Toolbox.setCatColors(),$("#advancedToolbox").addClass("hidden"),"BlocklyStorage"in window&&BlocklyStorage.backupOnUnload(),Blockly.svgResize(Blockscad.workspace),window.dispatchEvent(new Event("resize")),BSUtils.bindClick("trashButton",function(){Blockscad.discard()}),BSUtils.bindClick("renderButton",Blockscad.doRender),BSUtils.bindClick("undoButton",function(){var e=new Blockly.Events.Ui(null,"undo",null,null);Blockscad.recordHistory&&Blockscad.Auth.sessionHistory.push(e),Blockscad.workspace.undo(!1)}),BSUtils.bindClick("redoButton",function(){var e=new Blockly.Events.Ui(null,"redo",null,null);Blockscad.recordHistory&&Blockscad.Auth.sessionHistory.push(e),Blockscad.workspace.undo(!0)}),$("#axesButton").click(function(){Blockscad.drawAxes=(Blockscad.drawAxes+1)%2,$("#axesButton").toggleClass("btn-pushed"),Blockscad.drawAxes?Blockscad.gProcessor.viewer.planeMesh.visible=!0:Blockscad.gProcessor.viewer.planeMesh.visible=!1,Blockscad.gProcessor.viewer.onDraw()}),$("#zInButton").click(function(){Blockscad.gProcessor.viewer.zoomIn()}),$("#zOutButton").click(function(){Blockscad.gProcessor.viewer.zoomOut()}),$("#zResetButton").click(function(){Blockscad.gProcessor.viewer.viewReset()}),$("#cameraButton").click(function(){Blockscad.cameraPic()}),$("#displayCode").click(function(){var e=document.getElementById("openScadPre"),t=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),o=Blockscad.processCodeForOutput(t);e.textContent=o,Blockly.svgResize(Blockscad.workspace)}),$("#main").on("click",".new-project",Blockscad.newProject),setTimeout(function(){$("#file-menu").on("change","#loadLocal",function(e){Blockscad.loadLocalBlocks(e)}),$("#file-menu").on("change","#importLocal",function(e){readSingleFile(e,!1)}),$("#file-menu").on("change","#importStl",function(e){Blockscad.readStlFile(e)})},100),Blockscad.picSize=[450,450],Blockscad.rpicSize=[250,250],Blockscad.picQuality=.85,Blockscad.numRotPics=13,$("#picButton").click(Blockscad.takePic),$("#rPicButton").click(Blockscad.takeRPic),Blockscad.gProcessor=new Blockscad.Processor(document.getElementById("renderDiv")),Blockscad.needToSave=0,Blockscad.offline||Blockscad.Auth.checkForUser(),$("#help-menu").on("click","#about",function(){$("#about-modal").modal("show")}),$("#file-menu").on("click","#saveLocal",Blockscad.saveBlocksLocal),$("#login-area").on("click",".saveLocal",Blockscad.saveBlocksLocal),$("#file-menu").on("click","#saveOpenscad",Blockscad.saveOpenscadLocal),$("#simpleToolbox").on("click",function(){$("#simpleToolbox").addClass("hidden"),$("#advancedToolbox").removeClass("hidden"),$("#experimentalToolbox").addClass("hidden"),Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.sim),Blockscad.Toolbox.setCatColors())}),$("#advancedToolbox").on("click",function(){$("#advancedToolbox").addClass("hidden"),$("#simpleToolbox").removeClass("hidden"),$("#experimentalToolbox").removeClass("hidden"),Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.adv),Blockscad.Toolbox.setCatColors())}),$("#experimentalToolbox").on("click",function(){$("#advancedToolbox").removeClass("hidden"),$("#simpleToolbox").removeClass("hidden"),$("#experimentalToolbox").addClass("hidden"),Blockscad.workspace&&(Blockscad.Toolbox.catIDs=[],Blockscad.workspace.updateToolbox(Blockscad.Toolbox.advExp),Blockscad.Toolbox.setCatColors())}),$("#colors_one").on("click",function(){if(Blockscad.workspace){Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.one),Blockscad.Toolbox.setCatColors();var e=Blockly.Xml.workspaceToDom(Blockscad.workspace);Blockscad.workspace.clear(),Blockscad.recordHistory=!1,Blockly.Xml.domToWorkspace(e,Blockscad.workspace),setTimeout(function(){Blockscad.recordHistory=!0},10)}}),$("#colors_two").on("click",function(){if(Blockscad.workspace){Blockscad.Toolbox.setColorScheme(Blockscad.Toolbox.colorScheme.two),Blockscad.Toolbox.setCatColors();var e=Blockly.Xml.workspaceToDom(Blockscad.workspace);Blockscad.workspace.clear(),Blockscad.recordHistory=!1,Blockly.Xml.domToWorkspace(e,Blockscad.workspace),setTimeout(function(){Blockscad.recordHistory=!0},10)}}),Blockscad.setColor=function(e,t,o){if(null!=Blockscad.gProcessor&&Blockscad.gProcessor.viewer){if(Blockscad.gProcessor.viewer.defaultColor=[e/255,t/255,o/255,1],Blockscad.gProcessor.picviewer.defaultColor=[e/255,t/255,o/255,1],Blockscad.gProcessor.rpicviewer.defaultColor=[e/255,t/255,o/255,1],Blockscad.gProcessor.hasSolid()){Blockscad.gProcessor.clearMesh(),Blockscad.gProcessor.viewer.setCsg(Blockscad.gProcessor.currentObject),Blockscad.gProcessor.picviewer.setCsg(Blockscad.gProcessor.currentObject),Blockscad.gProcessor.rpicviewer.setCsg(Blockscad.gProcessor.currentObject);var a=Blockscad.gProcessor.picviewer.takePic(Blockscad.picQuality,0);Blockscad.gProcessor.img=a[0],Blockscad.gProcessor.imgStrip=Blockscad.gProcessor.rpicviewer.takeRotatingPic(.9,Blockscad.numRotPics),Blockscad.gProcessor.thumbnail=a[1]}Blockscad.defaultColor=Math.round(e)+","+Math.round(t)+","+Math.round(o),$("#defColor").spectrum("set","rgb("+Blockscad.defaultColor+")")}},$("#defColor").spectrum({color:"rgb(255,128,255)",showPalette:!0,className:"defaultColor btn btn-default",appendTo:"#viewerButtons",hideAfterPaletteSelect:!0,showPaletteOnly:!0,change:function(e){Blockscad.setColor(e._r,e._g,e._b)},palette:[["rgb(255,128,255);","rgb(153,153,153);","rgb(238,60,60);","rgb(250,150,0);"],["rgb(250,214,0);","rgb(50,220,50);","rgb(20,150,255);","rgb(180,85,254);"]]}),$(".sp-dd").remove(),$("#examples_torus").click({msg:"torus.xml"},Blockscad.showExample),$("#examples_box").click({msg:"box.xml"},Blockscad.showExample),$("#examples_linear_extrude").click({msg:"linear_extrude.xml"},Blockscad.showExample),$("#examples_rotate_extrude").click({msg:"rotate_extrude.xml"},Blockscad.showExample),$("#examples_cube_with_cutouts").click({msg:"cube_with_cutouts.xml"},Blockscad.showExample),$("#examples_anthias_fish").click({msg:"anthias_fish.xml"},Blockscad.showExample),$("#examples_hulled_loop_sun").click({msg:"hulled_loop_sun.xml"},Blockscad.showExample),$("#examples_sine_function_with_loop").click({msg:"sine_function_with_loop.xml"},Blockscad.showExample),$("#examples_trefoil_knot_param_eq").click({msg:"trefoil_knot_param_eq.xml"},Blockscad.showExample),$(function(){$(".dropdown-menu > li > a.trigger").on("click",function(e){var t=$(this).next(),o=$(this).parent().parent();($(this).hasClass("left-caret")||$(this).hasClass("right-caret"))&&$(this).toggleClass("right-caret left-caret"),o.find(".left-caret").not(this).toggleClass("right-caret left-caret"),o.find(".sub-menu:visible").not(t).hide(),t.toggle(),e.stopPropagation()}),$(".dropdown-menu > li > a:not(.trigger)").on("click",function(){var e=$(this).closest(".dropdown");e.find(".left-caret").toggleClass("right-caret left-caret"),e.find(".sub-menu:visible").hide()})}),$("#stl_buttons").addClass("hidden"),Blockscad.Auth.thingiverseToken&&Blockscad.Auth.thingiverseToken.length>10||Blockscad.Auth.example_solution||Blockscad.Auth.teacher_edit||Blockscad.Auth.starting_blocks||(Blockscad.standalone?BlocklyStorage.standaloneRestoreBlocks():BSUtils.loadBlocks("")),setTimeout(function(){Blockscad.Auth.projectId?($("#projectPageLink").show(),$("#projectPageLink").attr("href",Blockscad.Auth.baseUrl+"/community/projects/"+Blockscad.Auth.projectId)):$("#projectPageLink").hide()},200),setTimeout(Blockscad.typeWorkspace,20),$("#about_modal_link").on("click",function(){$("#about-modal").modal("show")}),$("#start-intro-tutorial").on("click",function(){Blockscad.newProject().then(function(){Blockscad.editorOnboarding()})}),Blockscad.editorOnboardingInit(),readCookie("editor-onboarding")||"tr"==Blockscad.pLang||Blockscad.editorOnboarding(),Blockscad.Auth.cookie_country=readCookie("ipgeo"),console.log("cookie_country is:",Blockscad.Auth.cookie_country),Blockscad.Auth.cookie_country?"Turkey"==Blockscad.Auth.cookie_country&&(console.log("in Turkey, as shown by cookie"),$("#eob-1").modal("hide"),$("#eob-top").hide(),$("#eob-right").hide(),Blockscad.Auth.inTurkeyPopup(),console.log("running in Turkey popupdd")):$.getJSON("https://ipgeolocation.abstractapi.com/v1/?api_key=8c3896ad676345d1947502a7a9adbcfb&fields=country,country_code",function(e){console.log("country data: ",e),createCookie("ipgeo",e.country,5),Blockscad.Auth.cookie_country=e.country,"Turkey"==e.country&&($("#eob-1").modal("hide"),$("#eob-top").hide(),$("#eob-right").hide(),Blockscad.Auth.inTurkeyPopup(),console.log("running in Turkey popup"))}),Blockscad.onresize(),Blockly.svgResize(Blockscad.workspace),setTimeout(Blockscad.onresize,600)},Blockscad.notifyExperimental=function(){var e=Blockscad.Msg.NEW+" △";(BSUtils.LANG="en")&&(e="Try our new <strong>BlocksCAD&trade; for Education</strong> blocks! (Limited time only)"),$.notify({icon:"glyphicon glyphicon-arrow-left",message:'<span style="font-size:100%">'+e+"</span>"},{element:"#blocklyContainer",type:"alert-pastel-warning",delay:1e4,placement:{from:"top",align:"left"},offset:{x:136,y:425},template:'<div data-notify="container" class="col-xs-6 col-sm-2 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">X</button><span data-notify="icon" class="{1}" style="font-size:1.3em;padding-right:5px"></span><span data-notify="message">{2}</span></div>'})},Blockscad.editorAnalyticsEventsInit=function(){$("#learn-menu-top").on("click",function(e){ga("send","event","Editor_Learn_Menu","Click","Learn Menu Opened")}),$("#skills_video_shapes").on("click",function(e){})},Blockscad.editorOnboardingInit=function(){$("#eob-1").draggable({handle:".modal-header"}),$("#eob-4").draggable({handle:".modal-header"}),$("#eob-2").draggable({handle:".modal-header"}),$("#eob-3").draggable({handle:".modal-header"}),$("#eob-4").on("show.bs.modal",function(){Blockscad.Auth.user.userId?$(".eob-notloggedin").hide():$(".eob-notloggedin").show()}),$("#eob-1-next").on("click",function(e){ga("send","event","Onboarding","Click","Continue to EOB2"),$("#eob-right").hide(),$("#eob-left").show(),$("#eob-2").modal("show")}),$("#eob-2-next").on("click",function(e){ga("send","event","Onboarding","Click","Continue to EOB3"),$("#eob-left").hide(),$("#eob-3").modal("show")}),$("#eob-2-prev").on("click",function(e){ga("send","event","Onboarding","Click","Go back to EOB1"),$("#eob-left").hide(),$("#eob-1").modal("show"),$("#eob-right").show()}),$("#eob-3-next").on("click",function(e){ga("send","event","Onboarding","Click","Continue to EOB4"),$("#eob-top").hide(),$("#eob-bottom").show(),$("#eob-4").modal("show")}),$("#eob-3-prev").on("click",function(e){ga("send","event","Onboarding","Click","Go back to EOB2"),$("#eob-left").show(),$("#eob-2").modal("show")}),$("#eob-4-register").on("click",function(){$("#eob-bottom").hide(),ga("send","event","Onboarding","Click","register from EOB4"),createCookie("editor-onboarding","seen",3650)}),$("#eob-4-login").on("click",function(){$("#eob-bottom").hide(),ga("send","event","Onboarding","Click","login from EOB4"),createCookie("editor-onboarding","seen",3650)}),$("#eob-1").on("hidden.bs.modal",function(e){setTimeout(function(){$("#eob-2").hasClass("in")||(ga("send","event","Onboarding","Click","close EOB1"),$("#eob-top").hide(),$("#eob-left").hide(),$("#eob-right").hide(),$("#eob-bottom").hide(),createCookie("editor-onboarding","seen",3650))},10)}),$("#eob-2").on("hidden.bs.modal",function(e){setTimeout(function(){$("#eob-1").hasClass("in")||$("#eob-3").hasClass("in")||(ga("send","event","Onboarding","Click","close EOB2"),$("#eob-top").hide(),$("#eob-left").hide(),$("#eob-right").hide(),$("#eob-bottom").hide(),createCookie("editor-onboarding","seen",3650))},10)}),$("#eob-3").on("hidden.bs.modal",function(e){setTimeout(function(){$("#eob-2").hasClass("in")||$("#eob-4").hasClass("in")||(ga("send","event","Onboarding","Click","close EOB3"),$("#eob-top").hide(),$("#eob-left").hide(),$("#eob-right").hide(),$("#eob-bottom").hide(),createCookie("editor-onboarding","seen",3650))},10)}),$("#eob-4").on("hidden.bs.modal",function(e){setTimeout(function(){$("#eob-3").hasClass("in")||(ga("send","event","Onboarding","Click","close EOB4"),$("#eob-top").hide(),$("#eob-left").hide(),$("#eob-right").hide(),$("#eob-bottom").hide(),createCookie("editor-onboarding","seen",3650))},10)})},Blockscad.editorOnboarding=function(){"tr"!=Blockscad.pLang&&($("#eob-1").modal("show"),$("#eob-top").show(),$("#eob-right").show())},Blockscad.getBrowser=function(){return/MSIE 10/i.test(navigator.userAgent)?"MS":/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)?"MS":/Edge\/\d./i.test(navigator.userAgent)?"MS":"??"},Blockscad.typeWorkspace=function(){for(var e=Blockscad.workspace.getAllBlocks(),t=0;t<e.length;t++)"variables_set"==e[t].type&&Blockscad.assignVarTypes(e[t]);var o=Blockscad.workspace.getTopBlocks();for(t=0;t<o.length;t++)o[t].category&&"PROCEDURE"==o[t].category&&Blockscad.assignBlockTypes([o[t]]);for(var a=0;a<e.length;a++)"variables_set"!=e[a].type&&"PROCEDURE"!=e[a].category&&Blockscad.assignBlockTypes(e[a]);Blockscad.assignBlockTypes(Blockscad.workspace.getTopBlocks())},Blockscad.typeNewStack=function(e){for(var t=e.getRootBlock().getDescendants(),o=0;t&&o<t.length;o++)"variables_set"!=t[o].type&&"variables_get"!=t[o].type||Blockscad.assignVarTypes(t[o]);for(o=0;t&&o<t.length;o++)"PROCEDURE"==t[o].category&&Blockscad.assignBlockTypes([t[o]]);for(o=0;t&&o<t.length;o++)"SET_OP"!=t[o].category&&"TRANSFORM"!=t[o].category&&"LOOP"!=t[o].category||Blockscad.assignBlockTypes([t[o]])},Blockscad.takeAnimatedGif=function(){if(null!=Blockscad.gProcessor.picviewer){for(var e=Blockscad.gProcessor.rpicviewer.takeAnimatedGif(1,30),t=[],o=0;o<e.length;o++)t[o]=e[o][0];gifshot.createGIF({images:t,interval:.1,gifWidth:Blockscad.rpicSize[0],gifHeight:Blockscad.rpicSize[1],sampleInterval:1},function(e){if(!e.error){var t=e.image;Blockscad.savePic(t,$("#project-name").val()+".gif")}})}},Blockscad.savePic=function(e,t){if(e){for(var o=atob(e.split(",")[1]),a=(e.split(",")[0].split(":")[1].split(";")[0],new ArrayBuffer(o.length)),n=new Uint8Array(a),s=0;s<o.length;s++)n[s]=o.charCodeAt(s);var l=new Blob([a],{type:"img/jpeg"});saveAs(l,t)}},Blockscad.takePic=function(){Blockscad.gProcessor&&Blockscad.gProcessor.img&&"null"!=Blockscad.gProcessor.img&&Blockscad.savePic(Blockscad.gProcessor.img,$("#project-name").val()+".jpg")},Blockscad.takeRPic=function(){Blockscad.gProcessor&&Blockscad.gProcessor.imgStrip&&"null"!=Blockscad.gProcessor.imgStrip&&Blockscad.savePic(Blockscad.gProcessor.imgStrip,$("#project-name").val()+".jpg")},Blockscad.cameraPic=function(){if(Blockscad.gProcessor.viewer){var e=Blockscad.gProcessor.viewer.takeCameraPic(.95);e&&Blockscad.savePic(e,$("#project-name").val()+".jpg")}},Blockscad.loadLocalBlocks=function(e){var t=e;t.target.files.length&&(Blockscad.needToSave?promptForSave().then(function(e){"cancel"!=e&&("nosave"==e?(Blockscad.setSaveNeeded(!1),Blockscad.offline||Blockscad.Auth.saveTimes(),Blockscad.createNewProject(),readSingleFile(t,!0)):"save"==e&&Blockscad.saveBlocks().then(function(){Blockscad.createNewProject(),readSingleFile(t,!0)}))}).catch(function(e){console.log("caught an error in new project.  result is:"+e)}):(Blockscad.offline||Blockscad.Auth.saveTimes(),Blockscad.createNewProject(),readSingleFile(t,!0)))},Blockscad.readStlFile=function(e){var t=e.target.files[0];if(t){var o=new FileReader;o.onload=function(e){var o=importSTL(e.target.result),a=o[0],n=o[1];n||(n="blah");for(var s,l=t.name.substr(0,t.name.lastIndexOf("("))||t.name,r=l=(l=l.substr(0,t.name.lastIndexOf("."))||l).replace(/^\s+|\s+$/g,""),c=1,i=0;Blockscad.csg_commands[r]&&!i;)a!=Blockscad.csg_commands[r]?(r=l+"_"+c,c++):i=1;if(Blockscad.csg_commands[r]=a,i?Blockscad.csg_filename[r]+=t.name+":::":Blockscad.csg_filename[r]=t.name+":::",Blockscad.csg_center[r]=n,Blockscad.currentInterestingBlock){var d=Blockscad.currentInterestingBlock.getField("STL_FILENAME");s=Blockscad.currentInterestingBlock.getField("STL_BUTTON");var u=Blockscad.currentInterestingBlock.getField("STL_CONTENTS");d.setText(t.name),d.setVisible(!0),s.setVisible(!1),u.setText(r),Blockscad.currentInterestingBlock.setCommentText(t.name+"\ncenter:("+n+")"),Blockscad.currentInterestingBlock=null}else{var h='<xml xmlns="https://www.blockscad3d.com"><block type="stl_import" id="1" x="0" y="0"><field name="STL_FILENAME">'+t.name+'</field><field name="STL_BUTTON">'+Blockscad.Msg.BROWSE+'</field><field name="STL_CONTENTS">'+r+"</field></block></xml>",p=Blockly.Xml.textToDom(h),f=Blockly.Xml.domToBlock(Blockscad.workspace,p.firstChild);f.moveBy(20+Blockscad.workspace.getMetrics().viewLeft/Blockscad.workspace.scale,20+Blockscad.workspace.getMetrics().viewTop/Blockscad.workspace.scale),(s=f.getField("STL_BUTTON")).setVisible(!1),f.setCommentText(t.name+"\ncenter:("+n+")"),f.render()}},o.readAsBinaryString(t),$("#importStl")[0].value="",$("#displayBlocks").click()}else alert("Failed to load file")},document.write('<script src="blockly/msg/js/'+BSUtils.LANG+'.js"><\/script>\n'),window.addEventListener("load",Blockscad.init),Blockscad.clearStlBlocks=function(){for(var e=Blockscad.workspace.getAllBlocks(),t=0;t<e.length;t++)if("stl_import"==e[t].type){var o=e[t].getField("STL_BUTTON");e[t].getField("STL_CONTENTS").setText(""),e[t].getField("STL_FILENAME").setText("");var a=e[t].getCommentText();a.match(/^RELOAD/)||(a="RELOAD: "+a),e[t].setCommentText(a),o.setText("Reload"),e[t].backlight();var n=e[t].collapsedParents();if(n)for(var s=0;s<n.length;s++)n[s].backlight();e[t].isCollapsed()||o.setVisible(!0);for(var l=e[t],r=null;l;)l.isCollapsed()&&(r=l),l=l.getSurroundParent();r&&r.setCollapsed(!0,!0),e[t].render(),$("#error-message").html(Blockscad.Msg.WARNING_RELOAD_STL)}},Blockscad.newProject=function(){return new Promise(function(e,t){$("#displayBlocks").click(),Blockscad.needToSave?promptForSave().then(function(t){"cancel"!=t?"nosave"==t?(Blockscad.setSaveNeeded(!1),Blockscad.offline||Blockscad.Auth.saveTimes(),Blockscad.createNewProject(),e()):"save"==t&&Blockscad.saveBlocks().then(function(){Blockscad.createNewProject(),e()}):e()}).catch(function(e){console.log("caught an error in new project.  result is:"+e)}):(Blockscad.offline||Blockscad.Auth.saveTimes(),Blockscad.createNewProject(),e())})},Blockscad.createNewProject=function(){Blockscad.clearProject(),Blockscad.workspace.clearUndo(),Blockscad.offline||Blockscad.Auth.unsetTeacherEdit(),setTimeout(Blockscad.setSaveNeeded,300),setTimeout(Blockscad.clearSessionHistory,1),$("#displayBlocks").click(),Blockscad.offline||$("#bigsavebutton").removeClass("hidden"),$("#projectPageLink").hide()},Blockscad.saveBlocks=function(e){return new Promise(function(e,t){!Blockscad.offline&&Blockscad.Auth.isLoggedIn?Blockscad.Auth.saveBlocksToAccount().then(function(t){e("saved")}):Blockscad.loginNag()})},Blockscad.loginNag=function(){bootbox.dialog({message:"<span style='font-size:0.86em'>"+Blockscad.Msg.LOGIN_NAG_SUBMESSAGE+"</span>",title:Blockscad.Msg.LOGIN_NAG_MESSAGE,backdrop:!0,onEscape:!0,className:"modal-375",buttons:{register:{label:Blockscad.Msg.REGISTER_BUTTON,className:"btn-default btn-lg pull-left padleft",callback:function(e){ga("send","event","Onboarding","Click","register from loginNag");var t=Blockscad.Auth.baseUrl+"account/register?from=editor";window.location.href=t}},login:{label:Blockscad.Msg.LOGIN_BUTTON,className:"btn-default btn-lg pull-left padleft",callback:function(e){ga("send","event","Onboarding","Click","login from loginNag");var t=Blockscad.Auth.baseUrl+"account/login?from=editor";window.location.href=t}}}})},Blockscad.autoLoginNag=function(){bootbox.dialog({message:Blockscad.Msg.LOGIN_NAG_MESSAGE,title:Blockscad.Msg.LOGIN_NAG_TITLE,backdrop:!0,onEscape:!0,className:"modal-375",buttons:{register:{label:Blockscad.Msg.REGISTER_BUTTON,className:"btn-default btn-lg pull-left padleft",callback:function(e){ga("send","event","Onboarding","Click","register from loginNag");var t=Blockscad.Auth.baseUrl+"account/register?from=editor";window.location.href=t}},login:{label:Blockscad.Msg.LOGIN_BUTTON,className:"btn-default btn-lg pull-left padleft",callback:function(e){ga("send","event","Onboarding","Click","login from loginNag");var t=Blockscad.Auth.baseUrl+"account/login?from=editor";window.location.href=t}}}})},Blockscad.showExample=function(e){if(Blockscad.standalone)var t="/examples/"+e.data.msg;else t="examples/"+e.data.msg;var o=e.data.msg.split(".")[0];Blockscad.needToSave?promptForSave().then(function(e){"cancel"!=e&&("nosave"==e?(Blockscad.setSaveNeeded(!1),Blockscad.offline||Blockscad.Auth.saveTimes(),Blockscad.getExample(t,o)):"save"==e&&Blockscad.saveBlocks().then(function(){Blockscad.getExample(t,o)}))}).catch(function(e){console.log("caught an error in show example 1.  result is:"+e)}):(Blockscad.offline||Blockscad.Auth.saveTimes(),Blockscad.getExample(t,o))},Blockscad.getExample=function(e,t){ga("send","event","Editor_Learn_Menu_Examples","Click",t),$.get(e,function(e){var o;Blockscad.clearProject(),o=Blockscad.standalone?e:window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e);var a=Blockly.Xml.textToDom(o);Blockly.Xml.domToWorkspace(a,Blockscad.workspace),Blockly.svgResize(Blockscad.workspace),$("#project-name").val(t+" example"),setTimeout(Blockscad.setSaveNeeded,300)})},Blockscad.setSaveNeeded=function(e){e?(Blockscad.needToSave=1,$("#save-indicator").html(Blockscad.Msg.NOT_SAVED),Blockscad.Auth.startAutosaveTimer()):(Blockscad.needToSave=0,$("#save-indicator").html(""),Blockscad.Auth.stopAutosaveTimer())},Blockscad.clearSessionHistory=function(){Blockscad.Auth.sessionHistory=[]},Blockscad.clearProject=function(){Blockscad.workspace.clear(),Blockscad.gProcessor.clearViewer(),Blockscad.offline||(console.log("calling saveTimes from Blockscad.clearProject"),Blockscad.Auth.saveTimes(),Blockscad.Auth.currentProject="",Blockscad.Auth.currentProjectKey="",Blockscad.Auth.projectId=0,Blockscad.Auth.projectParent=0,Blockscad.Auth.assignmentId=0,Blockscad.Auth.assignmentDueDateString=""),$("#project-name").val(Blockscad.Msg.PROJECT_NAME_DEFAULT),Blockscad.Auth.unsetAssignmentProps(),$("#projectView").addClass("hidden"),$("#editView").removeClass("hidden"),$("#bigsavebutton").removeClass("hidden"),window.dispatchEvent(new Event("resize"))},Blockscad.discard=function(){var e=Blockly.mainWorkspace.getAllBlocks().length;if(e<2)Blockly.mainWorkspace.clear(),window.location.hash="";else{var t=Blockscad.Msg.DISCARD_ALL.replace("%1",e);bootbox.confirm({size:"small",message:t,buttons:{confirm:{label:Blockscad.Msg.CONFIRM_DIALOG_YES,className:"btn-default confirm-yes"},cancel:{label:Blockscad.Msg.CONFIRM_DIALOG_NO,className:"btn-default confirm-yes"}},callback:function(e){e&&(Blockly.mainWorkspace.clear(),window.location.hash="")}})}},Blockscad.mixes2and3D=function(){var e=[];e=Blockly.mainWorkspace.getTopBlocks();for(var t=0,o=0,a=0,n=0,s=0;s<e.length;s++)if(Blockscad.stackIsShape(e[s])){n=1;var l,r=e[s].category;"PRIMITIVE_CSG"==r&&t++,"PRIMITIVE_CAG"==r&&o++,"TRANSFORM"!=r&&"SET_OP"!=r||(1==(l=e[s].getInput("A").connection.check_).length&&"CSG"==l[0]&&t++,1==l.length&&"CAG"==l[0]&&o++),"LOOP"==r&&(1==(l=e[s].getInput("DO").connection.check_).length&&"CSG"==l[0]&&t++,1==l.length&&"CAG"==l[0]&&o++),"COLOR"==r&&t++,"EXTRUDE"==r&&t++,"controls_if"==e[s].type&&a++}return!n||t+o+a||Blockscad.assignBlockTypes(Blockly.mainWorkspace.getTopBlocks()),[t&&o,n]},Blockscad.doRender=function(){var e=new Blockly.Events.Ui(null,"render",null,null);Blockscad.Auth.sessionHistory.push(e),$("#error-message").html(""),$("#error-message").removeClass("has-error"),$("#renderButton").prop("disabled",!0),window.setTimeout(function(){$("#renderButton").prop("disabled",!1)},2e3),Blockscad.gProcessor.clearViewer();var t=Blockscad.mixes2and3D();if(0===t[1])return $("#error-message").html(Blockscad.Msg.ERROR_MESSAGE+": "+Blockscad.Msg.RENDER_ERROR_EMPTY),$("#error-message").addClass("has-error"),void $("#renderButton").prop("disabled",!1);if(t[0])return $("#error-message").html(Blockscad.Msg.ERROR_MESSAGE+": "+Blockscad.Msg.RENDER_ERROR_MIXED),$("#error-message").addClass("has-error"),void $("#renderButton").prop("disabled",!1);Blockscad.missingFields=[],Blockscad.illegalValue=[],Blockscad.invalidTriangleSide=[],Blockscad.invalidTriangleAngle=[];var o,a,n=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),s=!1;if(Blockscad.missingFields.length>0)for(var l=0;l<Blockscad.missingFields.length;l++){if((a=Blockly.mainWorkspace.getBlockById(Blockscad.missingFields[l])).unselect(),a.backlight(),o=a.collapsedParents())for(var r=0;r<o.length;r++)o[r].unselect(),o[r].backlight();s=!0}if(Blockscad.illegalValue.length>0){for(l=0;l<Blockscad.illegalValue.length;l++)if((a=Blockly.mainWorkspace.getBlockById(Blockscad.illegalValue[l])).unselect(),a.backlight(),o=a.collapsedParents())for(r=0;r<o.length;r++)o[r].unselect(),o[r].backlight();s=!0}if(Blockscad.invalidTriangleSide.length>0)for(l=0;l<Blockscad.invalidTriangleSide.length;l++)if((a=Blockly.mainWorkspace.getBlockById(Blockscad.invalidTriangleSide[l])).unselect(),a.backlight(),o=a.collapsedParents())for(r=0;r<o.length;r++)o[r].unselect(),o[r].backlight();if(Blockscad.invalidTriangleAngle.length>0)for(l=0;l<Blockscad.invalidTriangleAngle.length;l++)if((a=Blockly.mainWorkspace.getBlockById(Blockscad.invalidTriangleAngle[l])).unselect(),a.backlight(),o=a.collapsedParents())for(r=0;r<o.length;r++)o[r].unselect(),o[r].backlight();if(s){var c="";return Blockscad.missingFields.length&&(c=("<br>"+Blockscad.Msg.ERROR_MESSAGE+": "+Blockscad.Msg.PARSING_ERROR_MISSING_FIELDS).replace("%1",Blockscad.missingFields.length+" ")),Blockscad.illegalValue.length&&(c+=("<br>"+Blockscad.Msg.ERROR_MESSAGE+": "+Blockscad.Msg.PARSING_ERROR_ILLEGAL_VALUE).replace("%1",Blockscad.illegalValue.length+" ")),Blockscad.invalidTriangleSide.length&&(c+=("<br>"+Blockscad.Msg.ERROR_MESSAGE+": "+Blockscad.Msg.PARSING_ERROR_INVALID_TRIANGLE_SIDE).replace("%1",Blockscad.invalidTriangleSide.length+" ")),Blockscad.invalidTriangleAngle.length&&(c+=("<br>"+Blockscad.Msg.ERROR_MESSAGE+": "+Blockscad.Msg.PARSING_ERROR_INVALID_TRIANGLE_ANGLE).replace("%1",Blockscad.invalidTriangleAngle.length+" ")),$("#error-message").html(c),$("#error-message").addClass("has-error"),void $("#renderButton").prop("disabled",!1)}if(Blockscad.resolution=$('input[name="resolution"]:checked').val(),Blockscad.loadTheseFonts=Blockscad.whichFonts(n),$("#renderButton").html('<span style="font-size:0.85em">'+Blockscad.Msg.LOADING_FONTS+"</span>"),Blockscad.loadTheseFonts.length>0){Blockscad.numloaded=0;for(l=0;l<Blockscad.loadTheseFonts.length;l++)Blockscad.loadFontThenRender(l,n)}else Blockscad.renderCode(n)},Blockscad.renderCode=function(e,t){Blockscad.gProcessor.setBlockscad(e)},Blockscad.getExtraRootBlock=function(e,t){var o=0;if(e.length>t.length)for(var a=0;a<e.length;a++){o=0;for(var n=0;n<t.length;n++)if(e[a].getAttribute("id")==t[n].id){o=1;break}if(!o)return a}else for(a=0;a<t.length;a++){o=0;for(n=0;n<e.length;n++)if(t[a].id==e[n].getAttribute("id")){o=1;break}if(!o)return a}return 0},Blockscad.getBlockFromId=function(e,t){for(var o,a=0;o=t[a];a++)if(o.id==e)return o;return null},Blockscad.aCallerBlock=function(e,t){for(var o=0;o<t.length;o++)if(e==t[o])return!0;return!1},Blockscad.findBlockType=function(e,t){for(var o=e.getRootBlock().getDescendants(),a=0,n=0,s=0;s<o.length;s++)if(!Blockscad.aCallerBlock(o[s],t)&&o[s].category){var l=o[s].category;if("PRIMITIVE_CSG"==l||"EXTRUDE"==l||"COLOR"==l){a=1;break}"PRIMITIVE_CAG"==l&&(n=1)}return a?Blockscad.hasExtrudeParent(e)?"CAG":"CSG":n?"CAG":"EITHER"},Blockscad.hasParentOfType=function(e,t){if(!e)return null;for(var o=e.getParent();o;){if(o.type==t)return o;o=o.getParent()}return null},Blockscad.doVariableHack=function(e){if(!e)return null;for(var t=e.getParent();t;){if("LOOP"==t.category||"TRANSFORM"==t.category||"EXTRUDE"==t.category||"SET_OP"==t.category||"COLOR"==t.category||"controls_if"==t.type)return!0;t=t.getParent()}return!1},Blockscad.stackIsShape=function(e){for(var t=e.getDescendants(),o=0;o<t.length;o++){var a=t[o];if(("PRIMITIVE_CSG"==a.category||"PRIMITIVE_CAG"==a.category)&&!a.hasDisabledParent())return!0}return!1},Blockscad.assignVarTypes=function(e,t){setTimeout(function(){if(e&&"variables_get"==e.type){for(var o=Blockly.Variables.getInstances(e.getFieldValue("VAR"),Blockscad.workspace),a=0,n=0;n<o.length;n++){if("variables_set"==o[n].type){e.outputConnection.setCheck(o[n].myType_),a=1;break}if("controls_for"==o[n].type||"controls_for_chainhull"==o[n].type){e.outputConnection.setCheck(null),a=1;break}}a||e.outputConnection.setCheck(null);var s=e.getParent();s&&"variables_set"==s.type&&Blockscad.assignVarTypes(s)}else if(e&&"variables_set"==e.type){var l=e.getChildren();if(0==l.length)e.setType(null);else{var r=0;for(n=0;n<l.length;n++)if(l[n].outputConnection){var c=l[n].outputConnection.check_;t&&(e.myType_="FALSE"),e.setType(c),r=1}0==r&&e.setType(null)}}},0)},Blockscad.handleWorkspaceEvents=function(e){if(Blockscad.recordHistory&&Blockscad.Auth.sessionHistory.push(e),e.type!=Blockly.Events.UI)if(e.type==Blockly.Events.CREATE||e.type==Blockly.Events.DELETE)Blockscad.setSaveNeeded(!0),(l=Blockscad.workspace.getBlockById(e.ids[0]))&&l.workspace&&!l.workspace.isFlyout&&("procedures_callnoreturn"!=l.type&&"procedures_callreturn"!=l.type||l.setType());else if(e.type==Blockly.Events.CHANGE){if(Blockscad.setSaveNeeded(!0),"field"==e.element&&"VAR"==e.name){var t=e.oldValue;if((l=Blockscad.workspace.getBlockById(e.blockId))&&"variables_set"==l.type){for(var o=Blockly.Variables.getInstances(t,Blockscad.workspace),a=0,n=0;o&&n<o.length;n++)"variables_set"==o[n].type&&Blockscad.assignVarTypes(o[n],!0),a=1;if(!a)for(n=0;o&&n<o.length;n++)"variables_get"==o[n].type&&Blockscad.assignVarTypes(o[n],!0)}Blockscad.assignVarTypes(l,!0)}if("field"==e.element&&"NUM"==e.name){var s=(l=Blockscad.workspace.getBlockById(e.blockId)).getParent();s&&"cylinder"==s.type&&s.updateRadii()}}else if(e.type==Blockly.Events.MOVE){if(e.oldParentId){var l=Blockscad.workspace.getBlockById(e.blockId),r=Blockscad.workspace.getBlockById(e.oldParentId);Blockscad.assignBlockTypes([l]),Blockscad.assignBlockTypes([r]),l&&"variables_set"==l.type?Blockscad.assignVarTypes(l):r&&"variables_set"==r.type&&Blockscad.assignVarTypes(r)}else if(e.newParentId){l=Blockscad.workspace.getBlockById(e.blockId);var c=Blockscad.workspace.getBlockById(e.newParentId);Blockscad.assignBlockTypes([l]),c&&"variables_set"==c.type&&Blockscad.assignVarTypes(c)}Blockscad.setSaveNeeded(!0)}},Blockscad.assignBlockTypes=function(e){goog.isArray(e)||(e=[e]),setTimeout(function(){for(var t=0;e&&e[t]&&t<e.length;t++){for(var o=e[t].getRootBlock().getDescendants(),a=0,n=0,s=0;s<o.length;s++)if(o[s].category){var l=o[s].category;if("PRIMITIVE_CSG"==l||"EXTRUDE"==l||"COLOR"==l){a=1;break}"PRIMITIVE_CAG"==l&&(n=1)}for(s=0;s<o.length;s++)if(o[s].category&&("TRANSFORM"==o[s].category||"SET_OP"==o[s].category||"PROCEDURE"==o[s].category||"LOOP"==o[s].category)){var r=!o[s].collapsedParents();a?Blockscad.hasExtrudeParent(o[s])?o[s].setType(["CAG"],r):o[s].setType(["CSG"],r):n?o[s].setType(["CAG"],r):o[s].setType(["CSG","CAG"],r)}}},0)},Blockscad.hasExtrudeParent=function(e){do{if("EXTRUDE"==e.category)return!0;e=e.parentBlock_}while(e);return!1},Blockscad.initLanguage=function(){var e=BSUtils.isRtl();document.head.parentElement.setAttribute("dir",e?"rtl":"ltr"),document.head.parentElement.setAttribute("lang",BSUtils.LANG);var t,o=[];for(t in BSUtils.LANGUAGE_NAME)o.push([BSUtils.LANGUAGE_NAME[t],t]);for(var a=[],n=0;n<o.length;n++)a.push('<li><a href="#" class="lang-option" data-lang="'+o[n][1]+'"</a>'+o[n][0]+"</li>");$("#languageMenu").append(a.join("")),$(".lang-option").on("click",BSUtils.changeLanguage)},Blockscad.saveBlocksLocal=function(){var e=Blockly.Xml.workspaceToDom(Blockly.getMainWorkspace()),t=Blockly.Xml.domToText(e),o=new Blob([t],{type:"text/plain;charset=utf-8"}),a=$("#project-name").val();a?(saveAs(o,a+".xml"),Blockscad.setSaveNeeded(!1)):alert(Blockscad.Msg.SAVE_FAILED+"\n"+Blockscad.Msg.SAVE_FAILED_PROJECT_NAME)},Blockscad.savePicLocal=function(e){var t=new Blob([e],{type:"img/jpeg"});saveAs(t,"tryThis.jpg")},Blockscad.saveOpenscadLocal=function(){var e=Blockly.OpenSCAD.workspaceToCode(Blockscad.workspace),t=Blockscad.processCodeForOutput(e),o=new Blob([t],{type:"text/plain;charset=utf-8"}),a=$("#project-name").val();a?saveAs(o,a+".scad"):alert(Blockscad.Msg.SAVE_FAILED+"\n"+Blockscad.Msg.SAVE_FAILED_PROJECT_NAME)},Blockscad.executeAfterDrag_=function(e,t){if(Blockscad.renderActions.push({action:e,thisArg:t}),1===Blockscad.renderActions.length)var o=window.setInterval(function(){if(!Blockly.dragMode_){for(;Blockscad.renderActions.length>0;){Blockscad.renderActions.shift().action.call(Blockscad.renderActions.thisArg)}window.clearInterval(o)}},10)},Blockscad.arraysEqual=function(e,t){if(null==e&&null==t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var o=e.length;o--;)if(e[o]!==t[o])return!1;return!0},Blockscad.processCodeForOutput=function(e){return e.replace(/( *)assign\((\$fn=.+)\){(.+)/g,"$1{\n$1  $2; $3").replace(/( *)assign\((.+)\){/gm,"$1$2;").replace(/(\w+ = .+),/g,"$1;  ").replace(/.+end assign\n/g,"").replace(/\n\s*\n\s*\n/g,"\n\n").replace(/group\(\)\{/g,"union(){")},Blockscad.saveSessionHistory=function(e){for(var t="",o=0;o<e.length;o++)t+=JSON.stringify(e[o].toJson()),t+="\n";return t},Blockly.OpenSCAD.returnIfVarCode=function(e){if("controls_if"==e.type){for(var t=[],o=0,a=0;a<e.inputList.length;a++)if(e.inputList[a].name.match(/DO./)||"ELSE"==e.inputList[a].name){var n=e.getInputTargetBlock(e.inputList[a].name);t[o]=[],n&&"variables_set"==n.type&&(t[o]=Blockly.OpenSCAD.getVariableCode(n)),o++}for(var s=[],l=[],r=0;r<t.length;r++){var c=t[r];if(s[r]="",l[r]="",c.length){s[r]+="  assign(";for(a=0;a<c.length;a++)s[r]+=c[a]+",";s[r]=s[r].slice(0,-1),s[r]+="){\n",l[r]="  }//end assign\n"}}return[s,l]}},(Blockscad=Blockscad||{}).fonts={},Blockscad.fontList=["editor/fonts/Roboto/Roboto-Bold.ttf","editor/fonts/liberation/LiberationSerif-Bold.ttf","editor/fonts/nimbus/nimbus-sans-l_bold.ttf","editor/fonts/AverageMono/AverageMonoSimp.ttf","editor/fonts/Open_Sans/OpenSans-ExtraBold.ttf","editor/fonts/stardos-stencil/StardosStencil-Bold.ttf","editor/fonts/Chewy/Chewy.ttf","editor/fonts/bangers/Bangers.ttf","editor/fonts/noto/NotoSansSC-Bold.otf"],Blockscad.standalone&&(Blockscad.fontList=["/fonts/Roboto/Roboto-Bold.ttf","/fonts/liberation/LiberationSerif-Bold.ttf","/fonts/nimbus/nimbus-sans-l_bold.ttf","/fonts/AverageMono/AverageMonoSimp.ttf","/fonts/Open_Sans/OpenSans-ExtraBold.ttf","/fonts/stardos-stencil/StardosStencil-Bold.ttf","/fonts/Chewy/Chewy.ttf","/fonts/bangers/Bangers.ttf","/fonts/noto/NotoSansSC-Bold.otf"]),Blockscad.fontName=["Roboto","Liberation Serif","Nimbus Sans","Average Mono","Open Sans","Stardos Stencil","Chewy","Bangers","简体中文"],Blockscad.loadFonts=function(){for(var e=0;e<Blockscad.fontList.length;e++)Blockscad.loadFont(e)},Blockscad.loadFont=function(e){opentype.load(Blockscad.fontList[e],function(t,o){if(!t)return Blockscad.fonts[Blockscad.fontName[e]]=o,o;console.log("Could not load font: ",o+":"+t)})},Blockscad.loadFontThenRender=function(e,t){try{Blockscad.fontName[Blockscad.loadTheseFonts[e]];var o=Blockscad.fontList[Blockscad.loadTheseFonts[e]],a=new XMLHttpRequest;a.open("get",o,!0),a.responseType="arraybuffer",a.onload=function(){if(200!==a.status)throw new Error("failed to load font in loadRawFont:"+o+a.statusText);Blockscad.fonts[Blockscad.fontName[Blockscad.loadTheseFonts[e]]]=a.response,Blockscad.numloaded++,Blockscad.numloaded==Blockscad.loadTheseFonts.length&&Blockscad.renderCode(t)},a.send()}catch(e){console.log("network error loading font in loadFontThenRender with: ",e)}},Blockscad.whichFonts=function(e){for(var t=[],o=0;o<Blockscad.fontList.length;o++)e.indexOf(Blockscad.fontName[o])>-1&&(Blockscad.fonts[Blockscad.fontName[o]]||t.push(o));return t},function(e){var t,o,a,n,s,l,r,c,i,d,u,h,p,f,m,g,b,k=null,v=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),B=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),M=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),w=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),x=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),y=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),S=function(){this.next=null,this.list=null},_=function(){this.e=0,this.b=0,this.n=0,this.t=null},E=function(e,t,o,a,n,s){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var l,r,c,i,d,u,h,p,f,m,g,b,k,v,B,M,w,x=new Array(this.BMAX+1),y=new Array(this.BMAX+1),E=new _,I=new Array(this.BMAX),T=new Array(this.N_MAX),A=new Array(this.BMAX+1);for(w=this.root=null,u=0;u<x.length;u++)x[u]=0;for(u=0;u<y.length;u++)y[u]=0;for(u=0;u<I.length;u++)I[u]=null;for(u=0;u<T.length;u++)T[u]=0;for(u=0;u<A.length;u++)A[u]=0;r=t>256?e[256]:this.BMAX,f=e,m=0,u=t;do{x[f[m]]++,m++}while(--u>0);if(x[0]==t)return this.root=null,this.m=0,void(this.status=0);for(h=1;h<=this.BMAX&&0==x[h];h++);for(p=h,s<h&&(s=h),u=this.BMAX;0!=u&&0==x[u];u--);for(i=u,s>u&&(s=u),v=1<<h;h<u;h++,v<<=1)if((v-=x[h])<0)return this.status=2,void(this.m=s);if((v-=x[u])<0)return this.status=2,void(this.m=s);for(x[u]+=v,A[1]=h=0,f=x,m=1,k=2;--u>0;)A[k++]=h+=f[m++];f=e,m=0,u=0;do{0!=(h=f[m++])&&(T[A[h]++]=u)}while(++u<t);for(t=A[i],A[0]=u=0,f=T,m=0,d=-1,b=y[0]=0,g=null,B=0;p<=i;p++)for(l=x[p];l-- >0;){for(;p>b+y[1+d];){if(b+=y[1+d],d++,B=(B=i-b)>s?s:B,(c=1<<(h=p-b))>l+1)for(c-=l+1,k=p;++h<B&&!((c<<=1)<=x[++k]);)c-=x[k];for(b+h>r&&b<r&&(h=r-b),B=1<<h,y[1+d]=h,g=new Array(B),M=0;M<B;M++)g[M]=new _;(w=null==w?this.root=new S:w.next=new S).next=null,w.list=g,I[d]=g,d>0&&(A[d]=u,E.b=y[d],E.e=16+h,E.t=g,h=(u&(1<<b)-1)>>b-y[d],I[d-1][h].e=E.e,I[d-1][h].b=E.b,I[d-1][h].n=E.n,I[d-1][h].t=E.t)}for(E.b=p-b,m>=t?E.e=99:f[m]<o?(E.e=f[m]<256?16:15,E.n=f[m++]):(E.e=n[f[m]-o],E.n=a[f[m++]-o]),c=1<<p-b,h=u>>b;h<B;h+=c)g[h].e=E.e,g[h].b=E.b,g[h].n=E.n,g[h].t=E.t;for(h=1<<p-1;0!=(u&h);h>>=1)u^=h;for(u^=h;(u&(1<<b)-1)!=A[d];)b-=y[d],d--}this.m=y[1],this.status=0!=v&&1!=i?1:0},I=function(e){for(;r<e;)l|=(g.length==b?-1:255&g.charCodeAt(b++))<<r,r+=8},T=function(e){return l&v[e]},A=function(e){l>>=e,r-=e},D=function(e,a,n){var s,l,r;if(0==n)return 0;for(r=0;;){for(I(f),s=(l=h.list[T(f)]).e;s>16;){if(99==s)return-1;A(l.b),I(s-=16),s=(l=l.t[T(s)]).e}if(A(l.b),16!=s){if(15==s)break;for(I(s),d=l.n+T(s),A(s),I(m),s=(l=p.list[T(m)]).e;s>16;){if(99==s)return-1;A(l.b),I(s-=16),s=(l=l.t[T(s)]).e}for(A(l.b),I(s),u=o-l.n-T(s),A(s);d>0&&r<n;)d--,u&=32767,o&=32767,e[a+r++]=t[o++]=t[u++];if(r==n)return n}else if(o&=32767,e[a+r++]=t[o++]=l.n,r==n)return n}return c=-1,r},O=function(e,a,n){var s;if(A(s=7&r),I(16),s=T(16),A(16),I(16),s!=(65535&~l))return-1;for(A(16),d=s,s=0;d>0&&s<n;)d--,o&=32767,I(8),e[a+s++]=t[o++]=T(8),A(8);return 0==d&&(c=-1),s},N=function(e,t,o){if(null==k){var l,r,c=new Array(288);for(l=0;l<144;l++)c[l]=8;for(;l<256;l++)c[l]=9;for(;l<280;l++)c[l]=7;for(;l<288;l++)c[l]=8;if(0!=(r=new E(c,288,257,B,M,n=7)).status)return alert("HufBuild error: "+r.status),-1;for(k=r.root,n=r.m,l=0;l<30;l++)c[l]=5;if((r=new E(c,30,0,w,x,s=5)).status>1)return k=null,alert("HufBuild error: "+r.status),-1;a=r.root,s=r.m}return h=k,p=a,f=n,m=s,D(e,t,o)},F=function(e,t,o){var a,n,s,l,r,c,i,d,u,g=new Array(316);for(a=0;a<g.length;a++)g[a]=0;if(I(5),i=257+T(5),A(5),I(5),d=1+T(5),A(5),I(4),c=4+T(4),A(4),i>286||d>30)return-1;for(n=0;n<c;n++)I(3),g[y[n]]=T(3),A(3);for(;n<19;n++)g[y[n]]=0;if(0!=(u=new E(g,19,19,null,null,f=7)).status)return-1;for(h=u.root,f=u.m,l=i+d,a=s=0;a<l;)if(I(f),n=(r=h.list[T(f)]).b,A(n),(n=r.n)<16)g[a++]=s=n;else if(16==n){if(I(2),n=3+T(2),A(2),a+n>l)return-1;for(;n-- >0;)g[a++]=s}else if(17==n){if(I(3),n=3+T(3),A(3),a+n>l)return-1;for(;n-- >0;)g[a++]=0;s=0}else{if(I(7),n=11+T(7),A(7),a+n>l)return-1;for(;n-- >0;)g[a++]=0;s=0}if(u=new E(g,i,257,B,M,f=9),0==f&&(u.status=1),0!=u.status&&1==u.status)return-1;for(h=u.root,f=u.m,a=0;a<d;a++)g[a]=g[a+i];return u=new E(g,d,0,w,x,m=6),p=u.root,0==(m=u.m)&&i>257?-1:0!=u.status?-1:D(e,t,o)},R=function(e,a,n){var s,l;for(s=0;s<n;){if(i&&-1==c)return s;if(d>0){if(0!=c)for(;d>0&&s<n;)d--,u&=32767,o&=32767,e[a+s++]=t[o++]=t[u++];else{for(;d>0&&s<n;)d--,o&=32767,I(8),e[a+s++]=t[o++]=T(8),A(8);0==d&&(c=-1)}if(s==n)return s}if(-1==c){if(i)break;I(1),0!=T(1)&&(i=!0),A(1),I(2),c=T(2),A(2),h=null,d=0}switch(c){case 0:l=O(e,a+s,n-s);break;case 1:l=null!=h?D(e,a+s,n-s):N(e,a+s,n-s);break;case 2:l=null!=h?D(e,a+s,n-s):F(e,a+s,n-s);break;default:l=-1}if(-1==l)return i?0:-1;s+=l}return s};e.RawDeflate||(e.RawDeflate={}),e.RawDeflate.inflate=function(e){var a,n;null==t&&(t=new Array(65536)),o=0,l=0,r=0,c=-1,i=!1,d=u=0,h=null,g=e,b=0;for(var s=new Array(1024),p=[];(a=R(s,0,s.length))>0;){var f=new Array(a);for(n=0;n<a;n++)f[n]=String.fromCharCode(s[n]);p[p.length]=f.join("")}return g=null,p.join("")}}(this),function(e){var t,o,a,n,s,l,r,c,i,d,u,h,p,f,m,g,b,k,v,B,M,w,x,y,S,_,E,I,T,A,D,O,N,F,R,L,C,P,U,z,$,j,V,G,H,X,Y,q,W,Z,J,K,Q,ee,te,oe=parseInt(5),ae=null,ne=function(){this.fc=0,this.dl=0},se=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},le=function(e,t,o,a){this.good_length=e,this.max_lazy=t,this.nice_length=o,this.max_chain=a},re=function(){this.next=null,this.len=0,this.ptr=new Array(8192),this.off=0},ce=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),ie=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),de=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),ue=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),he=new Array(new le(0,0,0,0),new le(4,4,8,4),new le(4,5,16,8),new le(4,6,32,32),new le(4,4,16,16),new le(8,16,32,32),new le(8,16,128,128),new le(8,32,128,256),new le(32,128,258,1024),new le(32,258,258,4096)),pe=function(e){e.next=t,t=e},fe=function(e){return u[32768+e]},me=function(e,t){return u[32768+e]=t},ge=function(e){ae[l+s++]=e,l+s==8192&&$e()},be=function(e){e&=65535,l+s<8190?(ae[l+s++]=255&e,ae[l+s++]=e>>>8):(ge(255&e),ge(e>>>8))},ke=function(){m=8191&(m<<oe^255&c[M+3-1]),g=fe(m),u[32767&M]=g,me(m,M)},ve=function(e,t){Pe(t[e].fc,t[e].dl)},Be=function(e){return 255&(e<256?V[e]:V[256+(e>>7)])},Me=function(e,t,o){return e[t].fc<e[o].fc||e[t].fc==e[o].fc&&$[t]<=$[o]},we=function(e,t,o){var a;for(a=0;a<o&&te<ee.length;a++)e[t+a]=255&ee.charCodeAt(te++);return a},xe=function(e){var t,o,a=S,n=M,s=B,l=M>32506?M-32506:0,r=M+258,i=c[n+s-1],d=c[n+s];B>=I&&(a>>=2);do{if(c[(t=e)+s]==d&&c[t+s-1]==i&&c[t]==c[n]&&c[++t]==c[n+1]){n+=2,t++;do{}while(c[++n]==c[++t]&&c[++n]==c[++t]&&c[++n]==c[++t]&&c[++n]==c[++t]&&c[++n]==c[++t]&&c[++n]==c[++t]&&c[++n]==c[++t]&&c[++n]==c[++t]&&n<r);if(o=258-(r-n),n=r-258,o>s){if(w=e,s=o,o>=258)break;i=c[n+s-1],d=c[n+s]}}}while((e=u[32767&e])>l&&0!=--a);return s},ye=function(){var e,t,o=65536-y-M;if(-1==o)o--;else if(M>=65274){for(e=0;e<32768;e++)c[e]=c[e+32768];for(w-=32768,M-=32768,f-=32768,e=0;e<8192;e++)t=fe(e),me(e,t>=32768?t-32768:0);for(e=0;e<32768;e++)t=u[e],u[e]=t>=32768?t-32768:0;o+=32768}x||((e=we(c,M+y,o))<=0?x=!0:y+=e)},Se=function(){x||(h=0,p=0,Ie(),function(){var e;for(e=0;e<8192;e++)u[32768+e]=0;if(_=he[E].max_lazy,I=he[E].good_length,S=he[E].max_chain,M=0,f=0,(y=we(c,0,65536))<=0)return x=!0,void(y=0);for(x=!1;y<262&&!x;)ye();for(m=0,e=0;e<2;e++)m=8191&(m<<oe^255&c[e])}(),o=null,s=0,l=0,k=0,E<=3?(B=2,v=0):(v=2,k=0,k=0),r=!1)},_e=function(e,t,a){var s;return n||(Se(),n=!0,0!=y)?(s=Ee(e,t,a))==a?a:r?s:(E<=3?function(){for(;0!=y&&null==o;){var e;if(ke(),0!=g&&M-g<=32506&&(v=xe(g))>y&&(v=y),v>=3)if(e=Le(M-w,v-3),y-=v,v<=_){v--;do{M++,ke()}while(0!=--v);M++}else M+=v,v=0,m=8191&((m=255&c[M])<<oe^255&c[M+1]);else e=Le(0,255&c[M]),y--,M++;for(e&&(Re(0),f=M);y<262&&!x;)ye()}}():function(){for(;0!=y&&null==o;){if(ke(),B=v,b=w,v=2,0!=g&&B<_&&M-g<=32506&&((v=xe(g))>y&&(v=y),3==v&&M-w>4096&&v--),B>=3&&v<=B){var e;e=Le(M-1-b,B-3),y-=B-1,B-=2;do{M++,ke()}while(0!=--B);k=0,v=2,M++,e&&(Re(0),f=M)}else 0!=k?(Le(0,255&c[M-1])&&(Re(0),f=M),M++,y--):(k=1,M++,y--);for(;y<262&&!x;)ye()}}(),0==y&&(0!=k&&Le(0,255&c[M-1]),Re(1),r=!0),s+Ee(e,s+t,a-s)):(r=!0,0)},Ee=function(e,t,a){var n,r,c;for(n=0;null!=o&&n<a;){for((r=a-n)>o.len&&(r=o.len),c=0;c<r;c++)e[t+n+c]=o.ptr[o.off+c];var i;if(o.off+=r,o.len-=r,n+=r,0==o.len)i=o,o=o.next,pe(i)}if(n==a)return n;if(l<s){for((r=a-n)>s-l&&(r=s-l),c=0;c<r;c++)e[t+n+c]=ae[l+c];n+=r,s==(l+=r)&&(s=l=0)}return n},Ie=function(){var e,t,o,a,n;if(0==O[0].dl){for(F.dyn_tree=T,F.static_tree=D,F.extra_bits=ce,F.extra_base=257,F.elems=286,F.max_length=15,F.max_code=0,R.dyn_tree=A,R.static_tree=O,R.extra_bits=ie,R.extra_base=0,R.elems=30,R.max_length=15,R.max_code=0,L.dyn_tree=N,L.static_tree=null,L.extra_bits=de,L.extra_base=0,L.elems=19,L.max_length=7,L.max_code=0,o=0,a=0;a<28;a++)for(G[a]=o,e=0;e<1<<ce[a];e++)j[o++]=a;for(j[o-1]=a,n=0,a=0;a<16;a++)for(H[a]=n,e=0;e<1<<ie[a];e++)V[n++]=a;for(n>>=7;a<30;a++)for(H[a]=n<<7,e=0;e<1<<ie[a]-7;e++)V[256+n++]=a;for(t=0;t<=15;t++)C[t]=0;for(e=0;e<=143;)D[e++].dl=8,C[8]++;for(;e<=255;)D[e++].dl=9,C[9]++;for(;e<=279;)D[e++].dl=7,C[7]++;for(;e<=287;)D[e++].dl=8,C[8]++;for(De(D,287),e=0;e<30;e++)O[e].dl=5,O[e].fc=Ue(e,5);Te()}},Te=function(){var e;for(e=0;e<286;e++)T[e].fc=0;for(e=0;e<30;e++)A[e].fc=0;for(e=0;e<19;e++)N[e].fc=0;T[256].fc=1,K=Q=0,Y=q=W=0,Z=0,J=1},Ae=function(e,t){for(var o=P[t],a=t<<1;a<=U&&(a<U&&Me(e,P[a+1],P[a])&&a++,!Me(e,o,P[a]));)P[t]=P[a],t=a,a<<=1;P[t]=o},De=function(e,t){var o,a,n=new Array(16),s=0;for(o=1;o<=15;o++)s=s+C[o-1]<<1,n[o]=s;for(a=0;a<=t;a++){var l=e[a].dl;0!=l&&(e[a].fc=Ue(n[l]++,l))}},Oe=function(e){var t,o,a=e.dyn_tree,n=e.static_tree,s=e.elems,l=-1,r=s;for(U=0,z=573,t=0;t<s;t++)0!=a[t].fc?(P[++U]=l=t,$[t]=0):a[t].dl=0;for(;U<2;){var c=P[++U]=l<2?++l:0;a[c].fc=1,$[c]=0,K--,null!=n&&(Q-=n[c].dl)}for(e.max_code=l,t=U>>1;t>=1;t--)Ae(a,t);do{t=P[1],P[1]=P[U--],Ae(a,1),o=P[1],P[--z]=t,P[--z]=o,a[r].fc=a[t].fc+a[o].fc,$[t]>$[o]+1?$[r]=$[t]:$[r]=$[o]+1,a[t].dl=a[o].dl=r,P[1]=r++,Ae(a,1)}while(U>=2);P[--z]=P[1],function(e){var t,o,a,n,s,l,r=e.dyn_tree,c=e.extra_bits,i=e.extra_base,d=e.max_code,u=e.max_length,h=e.static_tree,p=0;for(n=0;n<=15;n++)C[n]=0;for(r[P[z]].dl=0,t=z+1;t<573;t++)(n=r[r[o=P[t]].dl].dl+1)>u&&(n=u,p++),r[o].dl=n,o>d||(C[n]++,s=0,o>=i&&(s=c[o-i]),l=r[o].fc,K+=l*(n+s),null!=h&&(Q+=l*(h[o].dl+s)));if(0!=p){do{for(n=u-1;0==C[n];)n--;C[n]--,C[n+1]+=2,C[u]--,p-=2}while(p>0);for(n=u;0!=n;n--)for(o=C[n];0!=o;)(a=P[--t])>d||(r[a].dl!=n&&(K+=(n-r[a].dl)*r[a].fc,r[a].fc=n),o--)}}(e),De(a,l)},Ne=function(e,t){var o,a,n=-1,s=e[0].dl,l=0,r=7,c=4;for(0==s&&(r=138,c=3),e[t+1].dl=65535,o=0;o<=t;o++)a=s,s=e[o+1].dl,++l<r&&a==s||(l<c?N[a].fc+=l:0!=a?(a!=n&&N[a].fc++,N[16].fc++):l<=10?N[17].fc++:N[18].fc++,l=0,n=a,0==s?(r=138,c=3):a==s?(r=6,c=3):(r=7,c=4))},Fe=function(e,t){var o,a,n=-1,s=e[0].dl,l=0,r=7,c=4;for(0==s&&(r=138,c=3),o=0;o<=t;o++)if(a=s,s=e[o+1].dl,!(++l<r&&a==s)){if(l<c)do{ve(a,N)}while(0!=--l);else 0!=a?(a!=n&&(ve(a,N),l--),ve(16,N),Pe(l-3,2)):l<=10?(ve(17,N),Pe(l-3,3)):(ve(18,N),Pe(l-11,7));l=0,n=a,0==s?(r=138,c=3):a==s?(r=6,c=3):(r=7,c=4)}},Re=function(e){var t,o,a,n,s;if(n=M-f,X[W]=Z,Oe(F),Oe(R),a=function(){var e;for(Ne(T,F.max_code),Ne(A,R.max_code),Oe(L),e=18;e>=3&&0==N[ue[e]].dl;e--);return K+=3*(e+1)+5+5+4,e}(),(o=Q+3+7>>3)<=(t=K+3+7>>3)&&(t=o),n+4<=t&&f>=0)for(Pe(0+e,3),ze(),be(n),be(~n),s=0;s<n;s++)ge(c[f+s]);else o==t?(Pe(2+e,3),Ce(D,O)):(Pe(4+e,3),function(e,t,o){var a;for(Pe(e-257,5),Pe(t-1,5),Pe(o-4,4),a=0;a<o;a++)Pe(N[ue[a]].dl,3);Fe(T,e-1),Fe(A,t-1)}(F.max_code+1,R.max_code+1,a+1),Ce(T,A));Te(),0!=e&&ze()},Le=function(e,t){if(d[Y++]=t,0==e?T[t].fc++:(e--,T[j[t]+256+1].fc++,A[Be(e)].fc++,i[q++]=e,Z|=J),J<<=1,0==(7&Y)&&(X[W++]=Z,Z=0,J=1),E>2&&0==(4095&Y)){var o,a=8*Y,n=M-f;for(o=0;o<30;o++)a+=A[o].fc*(5+ie[o]);if(a>>=3,q<parseInt(Y/2)&&a<parseInt(n/2))return!0}return 8191==Y||8192==q},Ce=function(e,t){var o,a,n,s,l=0,r=0,c=0,u=0;if(0!=Y)do{0==(7&l)&&(u=X[c++]),a=255&d[l++],0==(1&u)?ve(a,e):(n=j[a],ve(n+256+1,e),0!=(s=ce[n])&&(a-=G[n],Pe(a,s)),o=i[r++],n=Be(o),ve(n,t),0!=(s=ie[n])&&(o-=H[n],Pe(o,s))),u>>=1}while(l<Y);ve(256,e)},Pe=function(e,t){p>16-t?(be(h|=e<<p),h=e>>16-p,p+=t-16):(h|=e<<p,p+=t)},Ue=function(e,t){var o=0;do{o|=1&e,e>>=1,o<<=1}while(--t>0);return o>>1},ze=function(){p>8?be(h):p>0&&ge(h),h=0,p=0},$e=function(){if(0!=s){var e,n;for(null!=t?(r=t,t=t.next):r=new re,r.next=null,r.len=r.off=0,e=r,null==o?o=a=e:a=a.next=e,e.len=s-l,n=0;n<e.len;n++)e.ptr[n]=ae[l+n];s=l=0}var r};e.RawDeflate||(e.RawDeflate={}),e.RawDeflate.deflate=function(e,s){var l,r;ee=e,te=0,void 0===s&&(s=6),function(e){var s;if(e?e<1?e=1:e>9&&(e=9):e=6,E=e,n=!1,x=!1,null==ae){for(t=o=a=null,ae=new Array(8192),c=new Array(65536),i=new Array(8192),d=new Array(32832),u=new Array(65536),T=new Array(573),s=0;s<573;s++)T[s]=new ne;for(A=new Array(61),s=0;s<61;s++)A[s]=new ne;for(D=new Array(288),s=0;s<288;s++)D[s]=new ne;for(O=new Array(30),s=0;s<30;s++)O[s]=new ne;for(N=new Array(39),s=0;s<39;s++)N[s]=new ne;F=new se,R=new se,L=new se,C=new Array(16),P=new Array(573),$=new Array(573),j=new Array(256),V=new Array(512),G=new Array(29),H=new Array(30),X=new Array(parseInt(1024))}}(s);for(var h=new Array(1024),p=[];(l=_e(h,0,h.length))>0;){var f=new Array(l);for(r=0;r<l;r++)f[r]=String.fromCharCode(h[r]);p[p.length]=f.join("")}return ee=null,p.join("")}}(this),function(e){"use strict";if(!e.Base64){var t;"undefined"!=typeof module&&module.exports&&(t=require("buffer").Buffer);var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=function(e){for(var t={},o=0,a=e.length;o<a;o++)t[e.charAt(o)]=o;return t}(o),n=String.fromCharCode,s=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?n(192|t>>>6)+n(128|63&t):n(224|t>>>12&15)+n(128|t>>>6&63)+n(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return n(240|t>>>18&7)+n(128|t>>>12&63)+n(128|t>>>6&63)+n(128|63&t)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,r=function(e){return e.replace(l,s)},c=function(e){var t=[0,2,1][e.length%3],a=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[o.charAt(a>>>18),o.charAt(a>>>12&63),t>=2?"=":o.charAt(a>>>6&63),t>=1?"=":o.charAt(63&a)].join("")},i=e.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,c)},d=t?function(e){return new t(e).toString("base64")}:function(e){return i(r(e))},u=function(e,t){return t?d(e).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):d(e)},h=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),p=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return n(55296+(t>>>10))+n(56320+(1023&t));case 3:return n((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return n((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},f=function(e){return e.replace(h,p)},m=function(e){var t=e.length,o=t%4,s=(t>0?a[e.charAt(0)]<<18:0)|(t>1?a[e.charAt(1)]<<12:0)|(t>2?a[e.charAt(2)]<<6:0)|(t>3?a[e.charAt(3)]:0),l=[n(s>>>16),n(s>>>8&255),n(255&s)];return l.length-=[0,0,2,1][o],l.join("")},g=e.atob||function(e){return e.replace(/[\s\S]{1,4}/g,m)},b=t?function(e){return new t(e,"base64").toString()}:function(e){return f(g(e))},k=function(e){return b(e.replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(e.Base64={VERSION:"2.1.1",atob:g,btoa:i,fromBase64:k,toBase64:u,utob:r,encode:u,encodeURI:function(e){return u(e,!0)},btou:f,decode:k},"function"==typeof Object.defineProperty){var v=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",v(function(){return k(this)})),Object.defineProperty(String.prototype,"toBase64",v(function(e){return u(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",v(function(){return u(this,!0)}))}}}}(this);var BinaryReader=function(e){this._buffer=e,this._pos=0};BinaryReader.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(e){this._checkSize(8*e);var t=this._buffer.substr(this._pos,e);return this._pos+=e,t},seek:function(e){this._pos=e,this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(e,t){var o=e+t+1,a=o>>3;this._checkSize(o);var n=Math.pow(2,t-1)-1,s=this._readBits(e+t,1,a),l=this._readBits(e,t,a),r=0,c=2,i=0;do{for(var d=this._readByte(++i,a),u=e%8||8,h=1<<u;h>>=1;)d&h&&(r+=1/c),c*=2}while(e-=u);return this._pos+=a,l==1+(n<<1)?r?NaN:s?-1/0:1/0:(1+-2*s)*(l||r?l?Math.pow(2,l-n)*(1+r):Math.pow(2,1-n)*r:0)},_decodeInt:function(e,t){var o=this._readBits(0,e,e/8),a=Math.pow(2,e),n=t&&o>=a/2?o-a:o;return this._pos+=e/8,n},_shl:function(e,t){for(++t;--t;e=1073741824==(1073741824&(e%=2147483648))?2*e:2*(e-1073741824)+2147483647+1);return e},_readByte:function(e,t){return 255&this._buffer.charCodeAt(this._pos+t-e-1)},_readBits:function(e,t,o){var a=(e+t)%8,n=e%8,s=o-(e>>3)-1,l=o+(-(e+t)>>3),r=s-l,c=this._readByte(s,o)>>n&(1<<(r?8-n:t))-1;for(r&&a&&(c+=(this._readByte(l++,o)&(1<<a)-1)<<(r--<<3)-n);r;)c+=this._shl(this._readByte(l++,o),(r--<<3)-n);return c},_checkSize:function(e){}},window.downloadFile=function(e){if(/(iP)/g.test(navigator.userAgent))return alert("Your device does not support files downloading. Please try again in desktop browser."),!1;if(window.downloadFile.isChrome||window.downloadFile.isSafari){var t=document.createElement("a");if(t.href=e,void 0!==t.download){var o=e.substring(e.lastIndexOf("/")+1,e.length);t.download=o}if(document.createEvent){var a=document.createEvent("MouseEvents");return a.initEvent("click",!0,!0),t.dispatchEvent(a),!0}}return-1===e.indexOf("?")&&(e+="?download"),window.open(e,"_self"),!0},window.downloadFile.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,window.downloadFile.isSafari=navigator.userAgent.toLowerCase().indexOf("safari")>-1,function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var a in o)("object"==typeof exports?exports:e)[a]=o[a]}}(this,function(){return function(e){function t(a){if(o[a])return o[a].exports;var n=o[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){t.glMatrix=o(1),t.mat2=o(2),t.mat2d=o(3),t.mat3=o(4),t.mat4=o(5),t.quat=o(6),t.vec2=o(9),t.vec3=o(7),t.vec4=o(8)},function(e,t){var o={EPSILON:1e-6};o.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,o.RANDOM=Math.random,o.ENABLE_SIMD=!1,o.SIMD_AVAILABLE=o.ARRAY_TYPE===Float32Array&&"SIMD"in this,o.USE_SIMD=o.ENABLE_SIMD&&o.SIMD_AVAILABLE,o.setMatrixArrayType=function(e){o.ARRAY_TYPE=e};var a=Math.PI/180;o.toRadian=function(e){return e*a},o.equals=function(e,t){return Math.abs(e-t)<=o.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},e.exports=o},function(e,t,o){var a=o(1),n={create:function(){var e=new a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},clone:function(e){var t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,o,n){var s=new a.ARRAY_TYPE(4);return s[0]=e,s[1]=t,s[2]=o,s[3]=n,s},set:function(e,t,o,a,n){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e},transpose:function(e,t){if(e===t){var o=t[1];e[1]=t[2],e[2]=o}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=o*s-n*a;return l?(l=1/l,e[0]=s*l,e[1]=-a*l,e[2]=-n*l,e[3]=o*l,e):null},adjoint:function(e,t){var o=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=o,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=o[0],c=o[1],i=o[2],d=o[3];return e[0]=a*r+s*c,e[1]=n*r+l*c,e[2]=a*i+s*d,e[3]=n*i+l*d,e}};n.mul=n.multiply,n.rotate=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=Math.sin(o),c=Math.cos(o);return e[0]=a*c+s*r,e[1]=n*c+l*r,e[2]=a*-r+s*c,e[3]=n*-r+l*c,e},n.scale=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=o[0],c=o[1];return e[0]=a*r,e[1]=n*r,e[2]=s*c,e[3]=l*c,e},n.fromRotation=function(e,t){var o=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=o,e[2]=-o,e[3]=a,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},n.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},n.LDU=function(e,t,o,a){return e[2]=a[2]/a[0],o[0]=a[0],o[1]=a[1],o[3]=a[3]-e[2]*o[1],[e,t,o]},n.add=function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e},n.subtract=function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e},n.sub=n.subtract,n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equals=function(e,t){var o=e[0],n=e[1],s=e[2],l=e[3],r=t[0],c=t[1],i=t[2],d=t[3];return Math.abs(o-r)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(r))&&Math.abs(n-c)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-i)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(l-d)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(d))},n.multiplyScalar=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e},n.multiplyScalarAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e[2]=t[2]+o[2]*a,e[3]=t[3]+o[3]*a,e},e.exports=n},function(e,t,o){var a=o(1),n={create:function(){var e=new a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},clone:function(e){var t=new a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,o,n,s,l){var r=new a.ARRAY_TYPE(6);return r[0]=e,r[1]=t,r[2]=o,r[3]=n,r[4]=s,r[5]=l,r},set:function(e,t,o,a,n,s,l){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e[4]=s,e[5]=l,e},invert:function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],r=t[5],c=o*s-a*n;return c?(c=1/c,e[0]=s*c,e[1]=-a*c,e[2]=-n*c,e[3]=o*c,e[4]=(n*r-s*l)*c,e[5]=(a*l-o*r)*c,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=o[0],d=o[1],u=o[2],h=o[3],p=o[4],f=o[5];return e[0]=a*i+s*d,e[1]=n*i+l*d,e[2]=a*u+s*h,e[3]=n*u+l*h,e[4]=a*p+s*f+r,e[5]=n*p+l*f+c,e}};n.mul=n.multiply,n.rotate=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=Math.sin(o),d=Math.cos(o);return e[0]=a*d+s*i,e[1]=n*d+l*i,e[2]=a*-i+s*d,e[3]=n*-i+l*d,e[4]=r,e[5]=c,e},n.scale=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=o[0],d=o[1];return e[0]=a*i,e[1]=n*i,e[2]=s*d,e[3]=l*d,e[4]=r,e[5]=c,e},n.translate=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=o[0],d=o[1];return e[0]=a,e[1]=n,e[2]=s,e[3]=l,e[4]=a*i+s*d+r,e[5]=n*i+l*d+c,e},n.fromRotation=function(e,t){var o=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=o,e[2]=-o,e[3]=a,e[4]=0,e[5]=0,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},n.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},n.add=function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e},n.subtract=function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e},n.multiplyScalarAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e[2]=t[2]+o[2]*a,e[3]=t[3]+o[3]*a,e[4]=t[4]+o[4]*a,e[5]=t[5]+o[5]*a,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},n.equals=function(e,t){var o=e[0],n=e[1],s=e[2],l=e[3],r=e[4],c=e[5],i=t[0],d=t[1],u=t[2],h=t[3],p=t[4],f=t[5];return Math.abs(o-i)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(i))&&Math.abs(n-d)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-u)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(l-h)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))&&Math.abs(r-p)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(c-f)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))},e.exports=n},function(e,t,o){var a=o(1),n={create:function(){var e=new a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,o,n,s,l,r,c,i){var d=new a.ARRAY_TYPE(9);return d[0]=e,d[1]=t,d[2]=o,d[3]=n,d[4]=s,d[5]=l,d[6]=r,d[7]=c,d[8]=i,d},set:function(e,t,o,a,n,s,l,r,c,i){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e[4]=s,e[5]=l,e[6]=r,e[7]=c,e[8]=i,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var o=t[1],a=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=o,e[5]=t[7],e[6]=a,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],r=t[5],c=t[6],i=t[7],d=t[8],u=d*l-r*i,h=-d*s+r*c,p=i*s-l*c,f=o*u+a*h+n*p;return f?(f=1/f,e[0]=u*f,e[1]=(-d*a+n*i)*f,e[2]=(r*a-n*l)*f,e[3]=h*f,e[4]=(d*o-n*c)*f,e[5]=(-r*o+n*s)*f,e[6]=p*f,e[7]=(-i*o+a*c)*f,e[8]=(l*o-a*s)*f,e):null},adjoint:function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],r=t[5],c=t[6],i=t[7],d=t[8];return e[0]=l*d-r*i,e[1]=n*i-a*d,e[2]=a*r-n*l,e[3]=r*c-s*d,e[4]=o*d-n*c,e[5]=n*s-o*r,e[6]=s*i-l*c,e[7]=a*c-o*i,e[8]=o*l-a*s,e},determinant:function(e){var t=e[0],o=e[1],a=e[2],n=e[3],s=e[4],l=e[5],r=e[6],c=e[7],i=e[8];return t*(i*s-l*c)+o*(-i*n+l*r)+a*(c*n-s*r)},multiply:function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=t[6],d=t[7],u=t[8],h=o[0],p=o[1],f=o[2],m=o[3],g=o[4],b=o[5],k=o[6],v=o[7],B=o[8];return e[0]=h*a+p*l+f*i,e[1]=h*n+p*r+f*d,e[2]=h*s+p*c+f*u,e[3]=m*a+g*l+b*i,e[4]=m*n+g*r+b*d,e[5]=m*s+g*c+b*u,e[6]=k*a+v*l+B*i,e[7]=k*n+v*r+B*d,e[8]=k*s+v*c+B*u,e}};n.mul=n.multiply,n.translate=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=t[6],d=t[7],u=t[8],h=o[0],p=o[1];return e[0]=a,e[1]=n,e[2]=s,e[3]=l,e[4]=r,e[5]=c,e[6]=h*a+p*l+i,e[7]=h*n+p*r+d,e[8]=h*s+p*c+u,e},n.rotate=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=t[6],d=t[7],u=t[8],h=Math.sin(o),p=Math.cos(o);return e[0]=p*a+h*l,e[1]=p*n+h*r,e[2]=p*s+h*c,e[3]=p*l-h*a,e[4]=p*r-h*n,e[5]=p*c-h*s,e[6]=i,e[7]=d,e[8]=u,e},n.scale=function(e,t,o){var a=o[0],n=o[1];return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},n.fromRotation=function(e,t){var o=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=o,e[2]=0,e[3]=-o,e[4]=a,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},n.fromQuat=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=o+o,r=a+a,c=n+n,i=o*l,d=a*l,u=a*r,h=n*l,p=n*r,f=n*c,m=s*l,g=s*r,b=s*c;return e[0]=1-u-f,e[3]=d-b,e[6]=h+g,e[1]=d+b,e[4]=1-i-f,e[7]=p-m,e[2]=h-g,e[5]=p+m,e[8]=1-i-u,e},n.normalFromMat4=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],r=t[5],c=t[6],i=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],m=t[13],g=t[14],b=t[15],k=o*r-a*l,v=o*c-n*l,B=o*i-s*l,M=a*c-n*r,w=a*i-s*r,x=n*i-s*c,y=d*m-u*f,S=d*g-h*f,_=d*b-p*f,E=u*g-h*m,I=u*b-p*m,T=h*b-p*g,A=k*T-v*I+B*E+M*_-w*S+x*y;return A?(A=1/A,e[0]=(r*T-c*I+i*E)*A,e[1]=(c*_-l*T-i*S)*A,e[2]=(l*I-r*_+i*y)*A,e[3]=(n*I-a*T-s*E)*A,e[4]=(o*T-n*_+s*S)*A,e[5]=(a*_-o*I-s*y)*A,e[6]=(m*x-g*w+b*M)*A,e[7]=(g*B-f*x-b*v)*A,e[8]=(f*w-m*B+b*k)*A,e):null},n.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},n.add=function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e[6]=t[6]+o[6],e[7]=t[7]+o[7],e[8]=t[8]+o[8],e},n.subtract=function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e[6]=t[6]-o[6],e[7]=t[7]-o[7],e[8]=t[8]-o[8],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*o,e},n.multiplyScalarAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e[2]=t[2]+o[2]*a,e[3]=t[3]+o[3]*a,e[4]=t[4]+o[4]*a,e[5]=t[5]+o[5]*a,e[6]=t[6]+o[6]*a,e[7]=t[7]+o[7]*a,e[8]=t[8]+o[8]*a,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},n.equals=function(e,t){var o=e[0],n=e[1],s=e[2],l=e[3],r=e[4],c=e[5],i=e[6],d=e[7],u=e[8],h=t[0],p=t[1],f=t[2],m=t[3],g=t[4],b=t[5],k=e[6],v=t[7],B=t[8];return Math.abs(o-h)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(n-p)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-f)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-m)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(r-g)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(c-b)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(i-k)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(k))&&Math.abs(d-v)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))&&Math.abs(u-B)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(B))},e.exports=n},function(e,t,o){var a=o(1),n={scalar:{},SIMD:{},create:function(){var e=new a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,o,n,s,l,r,c,i,d,u,h,p,f,m,g){var b=new a.ARRAY_TYPE(16);return b[0]=e,b[1]=t,b[2]=o,b[3]=n,b[4]=s,b[5]=l,b[6]=r,b[7]=c,b[8]=i,b[9]=d,b[10]=u,b[11]=h,b[12]=p,b[13]=f,b[14]=m,b[15]=g,b},set:function(e,t,o,a,n,s,l,r,c,i,d,u,h,p,f,m,g){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e[4]=s,e[5]=l,e[6]=r,e[7]=c,e[8]=i,e[9]=d,e[10]=u,e[11]=h,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}};n.scalar.transpose=function(e,t){if(e===t){var o=t[1],a=t[2],n=t[3],s=t[6],l=t[7],r=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=o,e[6]=t[9],e[7]=t[13],e[8]=a,e[9]=s,e[11]=t[14],e[12]=n,e[13]=l,e[14]=r}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},n.SIMD.transpose=function(e,t){var o,a,n,s,l,r,c,i,d,u;return o=SIMD.Float32x4.load(t,0),a=SIMD.Float32x4.load(t,4),n=SIMD.Float32x4.load(t,8),s=SIMD.Float32x4.load(t,12),l=SIMD.Float32x4.shuffle(o,a,0,1,4,5),r=SIMD.Float32x4.shuffle(n,s,0,1,4,5),c=SIMD.Float32x4.shuffle(l,r,0,2,4,6),i=SIMD.Float32x4.shuffle(l,r,1,3,5,7),SIMD.Float32x4.store(e,0,c),SIMD.Float32x4.store(e,4,i),l=SIMD.Float32x4.shuffle(o,a,2,3,6,7),r=SIMD.Float32x4.shuffle(n,s,2,3,6,7),d=SIMD.Float32x4.shuffle(l,r,0,2,4,6),u=SIMD.Float32x4.shuffle(l,r,1,3,5,7),SIMD.Float32x4.store(e,8,d),SIMD.Float32x4.store(e,12,u),e},n.transpose=a.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],r=t[5],c=t[6],i=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],m=t[13],g=t[14],b=t[15],k=o*r-a*l,v=o*c-n*l,B=o*i-s*l,M=a*c-n*r,w=a*i-s*r,x=n*i-s*c,y=d*m-u*f,S=d*g-h*f,_=d*b-p*f,E=u*g-h*m,I=u*b-p*m,T=h*b-p*g,A=k*T-v*I+B*E+M*_-w*S+x*y;return A?(A=1/A,e[0]=(r*T-c*I+i*E)*A,e[1]=(n*I-a*T-s*E)*A,e[2]=(m*x-g*w+b*M)*A,e[3]=(h*w-u*x-p*M)*A,e[4]=(c*_-l*T-i*S)*A,e[5]=(o*T-n*_+s*S)*A,e[6]=(g*B-f*x-b*v)*A,e[7]=(d*x-h*B+p*v)*A,e[8]=(l*I-r*_+i*y)*A,e[9]=(a*_-o*I-s*y)*A,e[10]=(f*w-m*B+b*k)*A,e[11]=(u*B-d*w-p*k)*A,e[12]=(r*S-l*E-c*y)*A,e[13]=(o*E-a*S+n*y)*A,e[14]=(m*v-f*M-g*k)*A,e[15]=(d*M-u*v+h*k)*A,e):null},n.SIMD.invert=function(e,t){var o,a,n,s,l,r,c,i,d,u,h=SIMD.Float32x4.load(t,0),p=SIMD.Float32x4.load(t,4),f=SIMD.Float32x4.load(t,8),m=SIMD.Float32x4.load(t,12);return l=SIMD.Float32x4.shuffle(h,p,0,1,4,5),a=SIMD.Float32x4.shuffle(f,m,0,1,4,5),o=SIMD.Float32x4.shuffle(l,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,l,1,3,5,7),l=SIMD.Float32x4.shuffle(h,p,2,3,6,7),s=SIMD.Float32x4.shuffle(f,m,2,3,6,7),n=SIMD.Float32x4.shuffle(l,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,l,1,3,5,7),l=SIMD.Float32x4.mul(n,s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),r=SIMD.Float32x4.mul(a,l),c=SIMD.Float32x4.mul(o,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,l),r),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.mul(a,n),l=SIMD.Float32x4.swizzle(l,1,0,3,2),r=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),r),d=SIMD.Float32x4.mul(o,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(s,l)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),l=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,3,0,1),s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),r=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,l),r),i=SIMD.Float32x4.mul(o,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(n,l)),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.mul(o,a),l=SIMD.Float32x4.swizzle(l,1,0,3,2),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),i),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,l),d),l=SIMD.Float32x4.swizzle(l,2,3,0,1),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,l),i),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(n,l)),l=SIMD.Float32x4.mul(o,s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,l)),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,l),i),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,l),c),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(a,l)),l=SIMD.Float32x4.mul(o,n),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),c),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(a,l)),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(s,l)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,l),d),u=SIMD.Float32x4.mul(o,r),u=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(u,2,3,0,1),u),u=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(u,1,0,3,2),u),l=SIMD.Float32x4.reciprocalApproximation(u),u=SIMD.Float32x4.sub(SIMD.Float32x4.add(l,l),SIMD.Float32x4.mul(u,SIMD.Float32x4.mul(l,l))),(u=SIMD.Float32x4.swizzle(u,0,0,0,0))?(SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(u,r)),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(u,c)),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(u,i)),SIMD.Float32x4.store(e,12,SIMD.Float32x4.mul(u,d)),e):null},n.invert=a.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=t[4],r=t[5],c=t[6],i=t[7],d=t[8],u=t[9],h=t[10],p=t[11],f=t[12],m=t[13],g=t[14],b=t[15];return e[0]=r*(h*b-p*g)-u*(c*b-i*g)+m*(c*p-i*h),e[1]=-(a*(h*b-p*g)-u*(n*b-s*g)+m*(n*p-s*h)),e[2]=a*(c*b-i*g)-r*(n*b-s*g)+m*(n*i-s*c),e[3]=-(a*(c*p-i*h)-r*(n*p-s*h)+u*(n*i-s*c)),e[4]=-(l*(h*b-p*g)-d*(c*b-i*g)+f*(c*p-i*h)),e[5]=o*(h*b-p*g)-d*(n*b-s*g)+f*(n*p-s*h),e[6]=-(o*(c*b-i*g)-l*(n*b-s*g)+f*(n*i-s*c)),e[7]=o*(c*p-i*h)-l*(n*p-s*h)+d*(n*i-s*c),e[8]=l*(u*b-p*m)-d*(r*b-i*m)+f*(r*p-i*u),e[9]=-(o*(u*b-p*m)-d*(a*b-s*m)+f*(a*p-s*u)),e[10]=o*(r*b-i*m)-l*(a*b-s*m)+f*(a*i-s*r),e[11]=-(o*(r*p-i*u)-l*(a*p-s*u)+d*(a*i-s*r)),e[12]=-(l*(u*g-h*m)-d*(r*g-c*m)+f*(r*h-c*u)),e[13]=o*(u*g-h*m)-d*(a*g-n*m)+f*(a*h-n*u),e[14]=-(o*(r*g-c*m)-l*(a*g-n*m)+f*(a*c-n*r)),e[15]=o*(r*h-c*u)-l*(a*h-n*u)+d*(a*c-n*r),e},n.SIMD.adjoint=function(e,t){var o,a,n,s,l,r,c,i,d,u=SIMD.Float32x4.load(t,0),h=SIMD.Float32x4.load(t,4),p=SIMD.Float32x4.load(t,8),f=SIMD.Float32x4.load(t,12);return l=SIMD.Float32x4.shuffle(u,h,0,1,4,5),a=SIMD.Float32x4.shuffle(p,f,0,1,4,5),o=SIMD.Float32x4.shuffle(l,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,l,1,3,5,7),l=SIMD.Float32x4.shuffle(u,h,2,3,6,7),s=SIMD.Float32x4.shuffle(p,f,2,3,6,7),n=SIMD.Float32x4.shuffle(l,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,l,1,3,5,7),l=SIMD.Float32x4.mul(n,s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),r=SIMD.Float32x4.mul(a,l),c=SIMD.Float32x4.mul(o,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,l),r),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.mul(a,n),l=SIMD.Float32x4.swizzle(l,1,0,3,2),r=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),r),d=SIMD.Float32x4.mul(o,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(s,l)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),l=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,3,0,1),s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),r=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,l),r),i=SIMD.Float32x4.mul(o,l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(n,l)),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,l),i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.mul(o,a),l=SIMD.Float32x4.swizzle(l,1,0,3,2),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),i),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,l),d),l=SIMD.Float32x4.swizzle(l,2,3,0,1),i=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,l),i),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(n,l)),l=SIMD.Float32x4.mul(o,s),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,l)),i=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,l),i),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,l),c),i=SIMD.Float32x4.sub(i,SIMD.Float32x4.mul(a,l)),l=SIMD.Float32x4.mul(o,n),l=SIMD.Float32x4.swizzle(l,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,l),c),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(a,l)),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(s,l)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,l),d),SIMD.Float32x4.store(e,0,r),SIMD.Float32x4.store(e,4,c),SIMD.Float32x4.store(e,8,i),SIMD.Float32x4.store(e,12,d),e},n.adjoint=a.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(e){var t=e[0],o=e[1],a=e[2],n=e[3],s=e[4],l=e[5],r=e[6],c=e[7],i=e[8],d=e[9],u=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*l-o*s)*(u*g-h*m)-(t*r-a*s)*(d*g-h*f)+(t*c-n*s)*(d*m-u*f)+(o*r-a*l)*(i*g-h*p)-(o*c-n*l)*(i*m-u*p)+(a*c-n*r)*(i*f-d*p)},n.SIMD.multiply=function(e,t,o){var a=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),s=SIMD.Float32x4.load(t,8),l=SIMD.Float32x4.load(t,12),r=SIMD.Float32x4.load(o,0),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,2,2,2),s),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,3,3,3,3),l))));SIMD.Float32x4.store(e,0,c);var i=SIMD.Float32x4.load(o,4),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,2,2,2),s),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,3,3,3,3),l))));SIMD.Float32x4.store(e,4,d);var u=SIMD.Float32x4.load(o,8),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),s),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),l))));SIMD.Float32x4.store(e,8,h);var p=SIMD.Float32x4.load(o,12),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,2,2,2,2),s),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,3,3,3,3),l))));return SIMD.Float32x4.store(e,12,f),e},n.scalar.multiply=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=t[6],d=t[7],u=t[8],h=t[9],p=t[10],f=t[11],m=t[12],g=t[13],b=t[14],k=t[15],v=o[0],B=o[1],M=o[2],w=o[3];return e[0]=v*a+B*r+M*u+w*m,e[1]=v*n+B*c+M*h+w*g,e[2]=v*s+B*i+M*p+w*b,e[3]=v*l+B*d+M*f+w*k,v=o[4],B=o[5],M=o[6],w=o[7],e[4]=v*a+B*r+M*u+w*m,e[5]=v*n+B*c+M*h+w*g,e[6]=v*s+B*i+M*p+w*b,e[7]=v*l+B*d+M*f+w*k,v=o[8],B=o[9],M=o[10],w=o[11],e[8]=v*a+B*r+M*u+w*m,e[9]=v*n+B*c+M*h+w*g,e[10]=v*s+B*i+M*p+w*b,e[11]=v*l+B*d+M*f+w*k,v=o[12],B=o[13],M=o[14],w=o[15],e[12]=v*a+B*r+M*u+w*m,e[13]=v*n+B*c+M*h+w*g,e[14]=v*s+B*i+M*p+w*b,e[15]=v*l+B*d+M*f+w*k,e},n.multiply=a.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(e,t,o){var a,n,s,l,r,c,i,d,u,h,p,f,m=o[0],g=o[1],b=o[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*b+t[12],e[13]=t[1]*m+t[5]*g+t[9]*b+t[13],e[14]=t[2]*m+t[6]*g+t[10]*b+t[14],e[15]=t[3]*m+t[7]*g+t[11]*b+t[15]):(a=t[0],n=t[1],s=t[2],l=t[3],r=t[4],c=t[5],i=t[6],d=t[7],u=t[8],h=t[9],p=t[10],f=t[11],e[0]=a,e[1]=n,e[2]=s,e[3]=l,e[4]=r,e[5]=c,e[6]=i,e[7]=d,e[8]=u,e[9]=h,e[10]=p,e[11]=f,e[12]=a*m+r*g+u*b+t[12],e[13]=n*m+c*g+h*b+t[13],e[14]=s*m+i*g+p*b+t[14],e[15]=l*m+d*g+f*b+t[15]),e},n.SIMD.translate=function(e,t,o){var a=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),s=SIMD.Float32x4.load(t,8),l=SIMD.Float32x4.load(t,12),r=SIMD.Float32x4(o[0],o[1],o[2],0);t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(r,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(r,1,1,1,1)),s=SIMD.Float32x4.mul(s,SIMD.Float32x4.swizzle(r,2,2,2,2));var c=SIMD.Float32x4.add(a,SIMD.Float32x4.add(n,SIMD.Float32x4.add(s,l)));return SIMD.Float32x4.store(e,12,c),e},n.translate=a.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(e,t,o){var a=o[0],n=o[1],s=o[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.SIMD.scale=function(e,t,o){var a,n,s,l=SIMD.Float32x4(o[0],o[1],o[2],0);return a=SIMD.Float32x4.load(t,0),SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(l,0,0,0,0))),n=SIMD.Float32x4.load(t,4),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(l,1,1,1,1))),s=SIMD.Float32x4.load(t,8),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(s,SIMD.Float32x4.swizzle(l,2,2,2,2))),e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.scale=a.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(e,t,o,n){var s,l,r,c,i,d,u,h,p,f,m,g,b,k,v,B,M,w,x,y,S,_,E,I,T=n[0],A=n[1],D=n[2],O=Math.sqrt(T*T+A*A+D*D);return Math.abs(O)<a.EPSILON?null:(T*=O=1/O,A*=O,D*=O,s=Math.sin(o),r=1-(l=Math.cos(o)),c=t[0],i=t[1],d=t[2],u=t[3],h=t[4],p=t[5],f=t[6],m=t[7],g=t[8],b=t[9],k=t[10],v=t[11],B=T*T*r+l,M=A*T*r+D*s,w=D*T*r-A*s,x=T*A*r-D*s,y=A*A*r+l,S=D*A*r+T*s,_=T*D*r+A*s,E=A*D*r-T*s,I=D*D*r+l,e[0]=c*B+h*M+g*w,e[1]=i*B+p*M+b*w,e[2]=d*B+f*M+k*w,e[3]=u*B+m*M+v*w,e[4]=c*x+h*y+g*S,e[5]=i*x+p*y+b*S,e[6]=d*x+f*y+k*S,e[7]=u*x+m*y+v*S,e[8]=c*_+h*E+g*I,e[9]=i*_+p*E+b*I,e[10]=d*_+f*E+k*I,e[11]=u*_+m*E+v*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},n.scalar.rotateX=function(e,t,o){var a=Math.sin(o),n=Math.cos(o),s=t[4],l=t[5],r=t[6],c=t[7],i=t[8],d=t[9],u=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+i*a,e[5]=l*n+d*a,e[6]=r*n+u*a,e[7]=c*n+h*a,e[8]=i*n-s*a,e[9]=d*n-l*a,e[10]=u*n-r*a,e[11]=h*n-c*a,e},n.SIMD.rotateX=function(e,t,o){var a=SIMD.Float32x4.splat(Math.sin(o)),n=SIMD.Float32x4.splat(Math.cos(o));t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var s=SIMD.Float32x4.load(t,4),l=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(l,a))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,n),SIMD.Float32x4.mul(s,a))),e},n.rotateX=a.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(e,t,o){var a=Math.sin(o),n=Math.cos(o),s=t[0],l=t[1],r=t[2],c=t[3],i=t[8],d=t[9],u=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-i*a,e[1]=l*n-d*a,e[2]=r*n-u*a,e[3]=c*n-h*a,e[8]=s*a+i*n,e[9]=l*a+d*n,e[10]=r*a+u*n,e[11]=c*a+h*n,e},n.SIMD.rotateY=function(e,t,o){var a=SIMD.Float32x4.splat(Math.sin(o)),n=SIMD.Float32x4.splat(Math.cos(o));t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var s=SIMD.Float32x4.load(t,0),l=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(l,a))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(s,a),SIMD.Float32x4.mul(l,n))),e},n.rotateY=a.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(e,t,o){var a=Math.sin(o),n=Math.cos(o),s=t[0],l=t[1],r=t[2],c=t[3],i=t[4],d=t[5],u=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+i*a,e[1]=l*n+d*a,e[2]=r*n+u*a,e[3]=c*n+h*a,e[4]=i*n-s*a,e[5]=d*n-l*a,e[6]=u*n-r*a,e[7]=h*n-c*a,e},n.SIMD.rotateZ=function(e,t,o){var a=SIMD.Float32x4.splat(Math.sin(o)),n=SIMD.Float32x4.splat(Math.cos(o));t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var s=SIMD.Float32x4.load(t,0),l=SIMD.Float32x4.load(t,4);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(l,a))),SIMD.Float32x4.store(e,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,n),SIMD.Float32x4.mul(s,a))),e},n.rotateZ=a.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromRotation=function(e,t,o){var n,s,l,r=o[0],c=o[1],i=o[2],d=Math.sqrt(r*r+c*c+i*i);return Math.abs(d)<a.EPSILON?null:(r*=d=1/d,c*=d,i*=d,n=Math.sin(t),l=1-(s=Math.cos(t)),e[0]=r*r*l+s,e[1]=c*r*l+i*n,e[2]=i*r*l-c*n,e[3]=0,e[4]=r*c*l-i*n,e[5]=c*c*l+s,e[6]=i*c*l+r*n,e[7]=0,e[8]=r*i*l+c*n,e[9]=c*i*l-r*n,e[10]=i*i*l+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},n.fromXRotation=function(e,t){var o=Math.sin(t),a=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=o,e[7]=0,e[8]=0,e[9]=-o,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromYRotation=function(e,t){var o=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=0,e[2]=-o,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=o,e[9]=0,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromZRotation=function(e,t){var o=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=o,e[2]=0,e[3]=0,e[4]=-o,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromRotationTranslation=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=a+a,c=n+n,i=s+s,d=a*r,u=a*c,h=a*i,p=n*c,f=n*i,m=s*i,g=l*r,b=l*c,k=l*i;return e[0]=1-(p+m),e[1]=u+k,e[2]=h-b,e[3]=0,e[4]=u-k,e[5]=1-(d+m),e[6]=f+g,e[7]=0,e[8]=h+b,e[9]=f-g,e[10]=1-(d+p),e[11]=0,e[12]=o[0],e[13]=o[1],e[14]=o[2],e[15]=1,e},n.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},n.getRotation=function(e,t){var o=t[0]+t[5]+t[10],a=0;return o>0?(a=2*Math.sqrt(o+1),e[3]=.25*a,e[0]=(t[6]-t[9])/a,e[1]=(t[8]-t[2])/a,e[2]=(t[1]-t[4])/a):t[0]>t[5]&t[0]>t[10]?(a=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/a,e[0]=.25*a,e[1]=(t[1]+t[4])/a,e[2]=(t[8]+t[2])/a):t[5]>t[10]?(a=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/a,e[0]=(t[1]+t[4])/a,e[1]=.25*a,e[2]=(t[6]+t[9])/a):(a=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/a,e[0]=(t[8]+t[2])/a,e[1]=(t[6]+t[9])/a,e[2]=.25*a),e},n.fromRotationTranslationScale=function(e,t,o,a){var n=t[0],s=t[1],l=t[2],r=t[3],c=n+n,i=s+s,d=l+l,u=n*c,h=n*i,p=n*d,f=s*i,m=s*d,g=l*d,b=r*c,k=r*i,v=r*d,B=a[0],M=a[1],w=a[2];return e[0]=(1-(f+g))*B,e[1]=(h+v)*B,e[2]=(p-k)*B,e[3]=0,e[4]=(h-v)*M,e[5]=(1-(u+g))*M,e[6]=(m+b)*M,e[7]=0,e[8]=(p+k)*w,e[9]=(m-b)*w,e[10]=(1-(u+f))*w,e[11]=0,e[12]=o[0],e[13]=o[1],e[14]=o[2],e[15]=1,e},n.fromRotationTranslationScaleOrigin=function(e,t,o,a,n){var s=t[0],l=t[1],r=t[2],c=t[3],i=s+s,d=l+l,u=r+r,h=s*i,p=s*d,f=s*u,m=l*d,g=l*u,b=r*u,k=c*i,v=c*d,B=c*u,M=a[0],w=a[1],x=a[2],y=n[0],S=n[1],_=n[2];return e[0]=(1-(m+b))*M,e[1]=(p+B)*M,e[2]=(f-v)*M,e[3]=0,e[4]=(p-B)*w,e[5]=(1-(h+b))*w,e[6]=(g+k)*w,e[7]=0,e[8]=(f+v)*x,e[9]=(g-k)*x,e[10]=(1-(h+m))*x,e[11]=0,e[12]=o[0]+y-(e[0]*y+e[4]*S+e[8]*_),e[13]=o[1]+S-(e[1]*y+e[5]*S+e[9]*_),e[14]=o[2]+_-(e[2]*y+e[6]*S+e[10]*_),e[15]=1,e},n.fromQuat=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=o+o,r=a+a,c=n+n,i=o*l,d=a*l,u=a*r,h=n*l,p=n*r,f=n*c,m=s*l,g=s*r,b=s*c;return e[0]=1-u-f,e[1]=d+b,e[2]=h-g,e[3]=0,e[4]=d-b,e[5]=1-i-f,e[6]=p+m,e[7]=0,e[8]=h+g,e[9]=p-m,e[10]=1-i-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.frustum=function(e,t,o,a,n,s,l){var r=1/(o-t),c=1/(n-a),i=1/(s-l);return e[0]=2*s*r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*c,e[6]=0,e[7]=0,e[8]=(o+t)*r,e[9]=(n+a)*c,e[10]=(l+s)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=l*s*2*i,e[15]=0,e},n.perspective=function(e,t,o,a,n){var s=1/Math.tan(t/2),l=1/(a-n);return e[0]=s/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*a*l,e[15]=0,e},n.perspectiveFromFieldOfView=function(e,t,o,a){var n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),l=Math.tan(t.leftDegrees*Math.PI/180),r=Math.tan(t.rightDegrees*Math.PI/180),c=2/(l+r),i=2/(n+s);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=-(l-r)*c*.5,e[9]=(n-s)*i*.5,e[10]=a/(o-a),e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o/(o-a),e[15]=0,e},n.ortho=function(e,t,o,a,n,s,l){var r=1/(t-o),c=1/(a-n),i=1/(s-l);return e[0]=-2*r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*i,e[11]=0,e[12]=(t+o)*r,e[13]=(n+a)*c,e[14]=(l+s)*i,e[15]=1,e},n.lookAt=function(e,t,o,s){var l,r,c,i,d,u,h,p,f,m,g=t[0],b=t[1],k=t[2],v=s[0],B=s[1],M=s[2],w=o[0],x=o[1],y=o[2];return Math.abs(g-w)<a.EPSILON&&Math.abs(b-x)<a.EPSILON&&Math.abs(k-y)<a.EPSILON?n.identity(e):(h=g-w,p=b-x,f=k-y,l=B*(f*=m=1/Math.sqrt(h*h+p*p+f*f))-M*(p*=m),r=M*(h*=m)-v*f,c=v*p-B*h,(m=Math.sqrt(l*l+r*r+c*c))?(l*=m=1/m,r*=m,c*=m):(l=0,r=0,c=0),i=p*c-f*r,d=f*l-h*c,u=h*r-p*l,(m=Math.sqrt(i*i+d*d+u*u))?(i*=m=1/m,d*=m,u*=m):(i=0,d=0,u=0),e[0]=l,e[1]=i,e[2]=h,e[3]=0,e[4]=r,e[5]=d,e[6]=p,e[7]=0,e[8]=c,e[9]=u,e[10]=f,e[11]=0,e[12]=-(l*g+r*b+c*k),e[13]=-(i*g+d*b+u*k),e[14]=-(h*g+p*b+f*k),e[15]=1,e)},n.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},n.add=function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e[6]=t[6]+o[6],e[7]=t[7]+o[7],e[8]=t[8]+o[8],e[9]=t[9]+o[9],e[10]=t[10]+o[10],e[11]=t[11]+o[11],e[12]=t[12]+o[12],e[13]=t[13]+o[13],e[14]=t[14]+o[14],e[15]=t[15]+o[15],e},n.subtract=function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e[6]=t[6]-o[6],e[7]=t[7]-o[7],e[8]=t[8]-o[8],e[9]=t[9]-o[9],e[10]=t[10]-o[10],e[11]=t[11]-o[11],e[12]=t[12]-o[12],e[13]=t[13]-o[13],e[14]=t[14]-o[14],e[15]=t[15]-o[15],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12]*o,e[13]=t[13]*o,e[14]=t[14]*o,e[15]=t[15]*o,e},n.multiplyScalarAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e[2]=t[2]+o[2]*a,e[3]=t[3]+o[3]*a,e[4]=t[4]+o[4]*a,e[5]=t[5]+o[5]*a,e[6]=t[6]+o[6]*a,e[7]=t[7]+o[7]*a,e[8]=t[8]+o[8]*a,e[9]=t[9]+o[9]*a,e[10]=t[10]+o[10]*a,e[11]=t[11]+o[11]*a,e[12]=t[12]+o[12]*a,e[13]=t[13]+o[13]*a,e[14]=t[14]+o[14]*a,e[15]=t[15]+o[15]*a,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},n.equals=function(e,t){var o=e[0],n=e[1],s=e[2],l=e[3],r=e[4],c=e[5],i=e[6],d=e[7],u=e[8],h=e[9],p=e[10],f=e[11],m=e[12],g=e[13],b=e[14],k=e[15],v=t[0],B=t[1],M=t[2],w=t[3],x=t[4],y=t[5],S=t[6],_=t[7],E=t[8],I=t[9],T=t[10],A=t[11],D=t[12],O=t[13],N=t[14],F=t[15];return Math.abs(o-v)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(n-B)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(B))&&Math.abs(s-M)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(l-w)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(r-x)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(c-y)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(i-S)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(d-_)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(u-E)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-I)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(p-T)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(f-A)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(m-D)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(g-O)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(b-N)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(N))&&Math.abs(k-F)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(F))},e.exports=n},function(e,t,o){var a=o(1),n=o(4),s=o(7),l=o(8),r={create:function(){var e=new a.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}};r.rotationTo=function(){var e=s.create(),t=s.fromValues(1,0,0),o=s.fromValues(0,1,0);return function(a,n,l){var c=s.dot(n,l);return-.999999>c?(s.cross(e,t,n),s.length(e)<1e-6&&s.cross(e,o,n),s.normalize(e,e),r.setAxisAngle(a,e,Math.PI),a):c>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(s.cross(e,n,l),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=1+c,r.normalize(a,a))}}(),r.setAxes=function(){var e=n.create();return function(t,o,a,n){return e[0]=a[0],e[3]=a[1],e[6]=a[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-o[0],e[5]=-o[1],e[8]=-o[2],r.normalize(t,r.fromMat3(t,e))}}(),r.clone=l.clone,r.fromValues=l.fromValues,r.copy=l.copy,r.set=l.set,r.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},r.setAxisAngle=function(e,t,o){o*=.5;var a=Math.sin(o);return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=Math.cos(o),e},r.getAxisAngle=function(e,t){var o=2*Math.acos(t[3]),a=Math.sin(o/2);return 0!=a?(e[0]=t[0]/a,e[1]=t[1]/a,e[2]=t[2]/a):(e[0]=1,e[1]=0,e[2]=0),o},r.add=l.add,r.multiply=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3],r=o[0],c=o[1],i=o[2],d=o[3];return e[0]=a*d+l*r+n*i-s*c,e[1]=n*d+l*c+s*r-a*i,e[2]=s*d+l*i+a*c-n*r,e[3]=l*d-a*r-n*c-s*i,e},r.mul=r.multiply,r.scale=l.scale,r.rotateX=function(e,t,o){o*=.5;var a=t[0],n=t[1],s=t[2],l=t[3],r=Math.sin(o),c=Math.cos(o);return e[0]=a*c+l*r,e[1]=n*c+s*r,e[2]=s*c-n*r,e[3]=l*c-a*r,e},r.rotateY=function(e,t,o){o*=.5;var a=t[0],n=t[1],s=t[2],l=t[3],r=Math.sin(o),c=Math.cos(o);return e[0]=a*c-s*r,e[1]=n*c+l*r,e[2]=s*c+a*r,e[3]=l*c-n*r,e},r.rotateZ=function(e,t,o){o*=.5;var a=t[0],n=t[1],s=t[2],l=t[3],r=Math.sin(o),c=Math.cos(o);return e[0]=a*c+n*r,e[1]=n*c-a*r,e[2]=s*c+l*r,e[3]=l*c-s*r,e},r.calculateW=function(e,t){var o=t[0],a=t[1],n=t[2];return e[0]=o,e[1]=a,e[2]=n,e[3]=Math.sqrt(Math.abs(1-o*o-a*a-n*n)),e},r.dot=l.dot,r.lerp=l.lerp,r.slerp=function(e,t,o,a){var n,s,l,r,c,i=t[0],d=t[1],u=t[2],h=t[3],p=o[0],f=o[1],m=o[2],g=o[3];return 0>(s=i*p+d*f+u*m+h*g)&&(s=-s,p=-p,f=-f,m=-m,g=-g),1-s>1e-6?(n=Math.acos(s),l=Math.sin(n),r=Math.sin((1-a)*n)/l,c=Math.sin(a*n)/l):(r=1-a,c=a),e[0]=r*i+c*p,e[1]=r*d+c*f,e[2]=r*u+c*m,e[3]=r*h+c*g,e},r.sqlerp=function(){var e=r.create(),t=r.create();return function(o,a,n,s,l,c){return r.slerp(e,a,l,c),r.slerp(t,n,s,c),r.slerp(o,e,t,2*c*(1-c)),o}}(),r.invert=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=o*o+a*a+n*n+s*s,r=l?1/l:0;return e[0]=-o*r,e[1]=-a*r,e[2]=-n*r,e[3]=s*r,e},r.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},r.length=l.length,r.len=r.length,r.squaredLength=l.squaredLength,r.sqrLen=r.squaredLength,r.normalize=l.normalize,r.fromMat3=function(e,t){var o,a=t[0]+t[4]+t[8];if(a>0)o=Math.sqrt(a+1),e[3]=.5*o,o=.5/o,e[0]=(t[5]-t[7])*o,e[1]=(t[6]-t[2])*o,e[2]=(t[1]-t[3])*o;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var s=(n+1)%3,l=(n+2)%3;o=Math.sqrt(t[3*n+n]-t[3*s+s]-t[3*l+l]+1),e[n]=.5*o,o=.5/o,e[3]=(t[3*s+l]-t[3*l+s])*o,e[s]=(t[3*s+n]+t[3*n+s])*o,e[l]=(t[3*l+n]+t[3*n+l])*o}return e},r.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},r.exactEquals=l.exactEquals,r.equals=l.equals,e.exports=r},function(e,t,o){var a=o(1),n={create:function(){var e=new a.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},clone:function(e){var t=new a.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:function(e,t,o){var n=new a.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=o,n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,o,a){return e[0]=t,e[1]=o,e[2]=a,e},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e},subtract:function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e}};n.sub=n.subtract,n.multiply=function(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e[2]=t[2]*o[2],e},n.mul=n.multiply,n.divide=function(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e[2]=t[2]/o[2],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},n.min=function(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e[2]=Math.min(t[2],o[2]),e},n.max=function(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e[2]=Math.max(t[2],o[2]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},n.scale=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},n.scaleAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e[2]=t[2]+o[2]*a,e},n.distance=function(e,t){var o=t[0]-e[0],a=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(o*o+a*a+n*n)},n.dist=n.distance,n.squaredDistance=function(e,t){var o=t[0]-e[0],a=t[1]-e[1],n=t[2]-e[2];return o*o+a*a+n*n},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],o=e[1],a=e[2];return Math.sqrt(t*t+o*o+a*a)},n.len=n.length,n.squaredLength=function(e){var t=e[0],o=e[1],a=e[2];return t*t+o*o+a*a},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},n.normalize=function(e,t){var o=t[0],a=t[1],n=t[2],s=o*o+a*a+n*n;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},n.cross=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=o[0],r=o[1],c=o[2];return e[0]=n*c-s*r,e[1]=s*l-a*c,e[2]=a*r-n*l,e},n.lerp=function(e,t,o,a){var n=t[0],s=t[1],l=t[2];return e[0]=n+a*(o[0]-n),e[1]=s+a*(o[1]-s),e[2]=l+a*(o[2]-l),e},n.hermite=function(e,t,o,a,n,s){var l=s*s,r=l*(2*s-3)+1,c=l*(s-2)+s,i=l*(s-1),d=l*(3-2*s);return e[0]=t[0]*r+o[0]*c+a[0]*i+n[0]*d,e[1]=t[1]*r+o[1]*c+a[1]*i+n[1]*d,e[2]=t[2]*r+o[2]*c+a[2]*i+n[2]*d,e},n.bezier=function(e,t,o,a,n,s){var l=1-s,r=l*l,c=s*s,i=r*l,d=3*s*r,u=3*c*l,h=c*s;return e[0]=t[0]*i+o[0]*d+a[0]*u+n[0]*h,e[1]=t[1]*i+o[1]*d+a[1]*u+n[1]*h,e[2]=t[2]*i+o[2]*d+a[2]*u+n[2]*h,e},n.random=function(e,t){t=t||1;var o=2*a.RANDOM()*Math.PI,n=2*a.RANDOM()-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(o)*s,e[1]=Math.sin(o)*s,e[2]=n*t,e},n.transformMat4=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=o[3]*a+o[7]*n+o[11]*s+o[15];return l=l||1,e[0]=(o[0]*a+o[4]*n+o[8]*s+o[12])/l,e[1]=(o[1]*a+o[5]*n+o[9]*s+o[13])/l,e[2]=(o[2]*a+o[6]*n+o[10]*s+o[14])/l,e},n.transformMat3=function(e,t,o){var a=t[0],n=t[1],s=t[2];return e[0]=a*o[0]+n*o[3]+s*o[6],e[1]=a*o[1]+n*o[4]+s*o[7],e[2]=a*o[2]+n*o[5]+s*o[8],e},n.transformQuat=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=o[0],r=o[1],c=o[2],i=o[3],d=i*a+r*s-c*n,u=i*n+c*a-l*s,h=i*s+l*n-r*a,p=-l*a-r*n-c*s;return e[0]=d*i+p*-l+u*-c-h*-r,e[1]=u*i+p*-r+h*-l-d*-c,e[2]=h*i+p*-c+d*-r-u*-l,e},n.rotateX=function(e,t,o,a){var n=[],s=[];return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],s[0]=n[0],s[1]=n[1]*Math.cos(a)-n[2]*Math.sin(a),s[2]=n[1]*Math.sin(a)+n[2]*Math.cos(a),e[0]=s[0]+o[0],e[1]=s[1]+o[1],e[2]=s[2]+o[2],e},n.rotateY=function(e,t,o,a){var n=[],s=[];return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],s[0]=n[2]*Math.sin(a)+n[0]*Math.cos(a),s[1]=n[1],s[2]=n[2]*Math.cos(a)-n[0]*Math.sin(a),e[0]=s[0]+o[0],e[1]=s[1]+o[1],e[2]=s[2]+o[2],e},n.rotateZ=function(e,t,o,a){var n=[],s=[];return n[0]=t[0]-o[0],n[1]=t[1]-o[1],n[2]=t[2]-o[2],s[0]=n[0]*Math.cos(a)-n[1]*Math.sin(a),s[1]=n[0]*Math.sin(a)+n[1]*Math.cos(a),s[2]=n[2],e[0]=s[0]+o[0],e[1]=s[1]+o[1],e[2]=s[2]+o[2],e},n.forEach=function(){var e=n.create();return function(t,o,a,n,s,l){var r,c;for(o||(o=3),a||(a=0),c=n?Math.min(n*o+a,t.length):t.length,r=a;c>r;r+=o)e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],s(e,e,l),t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2];return t}}(),n.angle=function(e,t){var o=n.fromValues(e[0],e[1],e[2]),a=n.fromValues(t[0],t[1],t[2]);n.normalize(o,o),n.normalize(a,a);var s=n.dot(o,a);return s>1?0:Math.acos(s)},n.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},n.equals=function(e,t){var o=e[0],n=e[1],s=e[2],l=t[0],r=t[1],c=t[2];return Math.abs(o-l)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(n-r)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(s-c)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},e.exports=n},function(e,t,o){var a=o(1),n={create:function(){var e=new a.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},clone:function(e){var t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:function(e,t,o,n){var s=new a.ARRAY_TYPE(4);return s[0]=e,s[1]=t,s[2]=o,s[3]=n,s},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,o,a,n){return e[0]=t,e[1]=o,e[2]=a,e[3]=n,e},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e},subtract:function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e}};n.sub=n.subtract,n.multiply=function(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e[2]=t[2]*o[2],e[3]=t[3]*o[3],e},n.mul=n.multiply,n.divide=function(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e[2]=t[2]/o[2],e[3]=t[3]/o[3],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},n.min=function(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e[2]=Math.min(t[2],o[2]),e[3]=Math.min(t[3],o[3]),e},n.max=function(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e[2]=Math.max(t[2],o[2]),e[3]=Math.max(t[3],o[3]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},n.scale=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e},n.scaleAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e[2]=t[2]+o[2]*a,e[3]=t[3]+o[3]*a,e},n.distance=function(e,t){var o=t[0]-e[0],a=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(o*o+a*a+n*n+s*s)},n.dist=n.distance,n.squaredDistance=function(e,t){var o=t[0]-e[0],a=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return o*o+a*a+n*n+s*s},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],o=e[1],a=e[2],n=e[3];return Math.sqrt(t*t+o*o+a*a+n*n)},n.len=n.length,n.squaredLength=function(e){var t=e[0],o=e[1],a=e[2],n=e[3];return t*t+o*o+a*a+n*n},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},n.normalize=function(e,t){var o=t[0],a=t[1],n=t[2],s=t[3],l=o*o+a*a+n*n+s*s;return l>0&&(l=1/Math.sqrt(l),e[0]=o*l,e[1]=a*l,e[2]=n*l,e[3]=s*l),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},n.lerp=function(e,t,o,a){var n=t[0],s=t[1],l=t[2],r=t[3];return e[0]=n+a*(o[0]-n),e[1]=s+a*(o[1]-s),e[2]=l+a*(o[2]-l),e[3]=r+a*(o[3]-r),e},n.random=function(e,t){return t=t||1,e[0]=a.RANDOM(),e[1]=a.RANDOM(),e[2]=a.RANDOM(),e[3]=a.RANDOM(),n.normalize(e,e),n.scale(e,e,t),e},n.transformMat4=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=t[3];return e[0]=o[0]*a+o[4]*n+o[8]*s+o[12]*l,e[1]=o[1]*a+o[5]*n+o[9]*s+o[13]*l,e[2]=o[2]*a+o[6]*n+o[10]*s+o[14]*l,e[3]=o[3]*a+o[7]*n+o[11]*s+o[15]*l,e},n.transformQuat=function(e,t,o){var a=t[0],n=t[1],s=t[2],l=o[0],r=o[1],c=o[2],i=o[3],d=i*a+r*s-c*n,u=i*n+c*a-l*s,h=i*s+l*n-r*a,p=-l*a-r*n-c*s;return e[0]=d*i+p*-l+u*-c-h*-r,e[1]=u*i+p*-r+h*-l-d*-c,e[2]=h*i+p*-c+d*-r-u*-l,e[3]=t[3],e},n.forEach=function(){var e=n.create();return function(t,o,a,n,s,l){var r,c;for(o||(o=4),a||(a=0),c=n?Math.min(n*o+a,t.length):t.length,r=a;c>r;r+=o)e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],s(e,e,l),t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3];return t}}(),n.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equals=function(e,t){var o=e[0],n=e[1],s=e[2],l=e[3],r=t[0],c=t[1],i=t[2],d=t[3];return Math.abs(o-r)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(r))&&Math.abs(n-c)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-i)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(l-d)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(d))},e.exports=n},function(e,t,o){var a=o(1),n={create:function(){var e=new a.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},clone:function(e){var t=new a.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var o=new a.ARRAY_TYPE(2);return o[0]=e,o[1]=t,o},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,o){return e[0]=t,e[1]=o,e},add:function(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e},subtract:function(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e}};n.sub=n.subtract,n.multiply=function(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e},n.mul=n.multiply,n.divide=function(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},n.min=function(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e},n.max=function(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},n.scale=function(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e},n.scaleAndAdd=function(e,t,o,a){return e[0]=t[0]+o[0]*a,e[1]=t[1]+o[1]*a,e},n.distance=function(e,t){var o=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(o*o+a*a)},n.dist=n.distance,n.squaredDistance=function(e,t){var o=t[0]-e[0],a=t[1]-e[1];return o*o+a*a},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],o=e[1];return Math.sqrt(t*t+o*o)},n.len=n.length,n.squaredLength=function(e){var t=e[0],o=e[1];return t*t+o*o},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},n.normalize=function(e,t){var o=t[0],a=t[1],n=o*o+a*a;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},n.cross=function(e,t,o){var a=t[0]*o[1]-t[1]*o[0];return e[0]=e[1]=0,e[2]=a,e},n.lerp=function(e,t,o,a){var n=t[0],s=t[1];return e[0]=n+a*(o[0]-n),e[1]=s+a*(o[1]-s),e},n.random=function(e,t){t=t||1;var o=2*a.RANDOM()*Math.PI;return e[0]=Math.cos(o)*t,e[1]=Math.sin(o)*t,e},n.transformMat2=function(e,t,o){var a=t[0],n=t[1];return e[0]=o[0]*a+o[2]*n,e[1]=o[1]*a+o[3]*n,e},n.transformMat2d=function(e,t,o){var a=t[0],n=t[1];return e[0]=o[0]*a+o[2]*n+o[4],e[1]=o[1]*a+o[3]*n+o[5],e},n.transformMat3=function(e,t,o){var a=t[0],n=t[1];return e[0]=o[0]*a+o[3]*n+o[6],e[1]=o[1]*a+o[4]*n+o[7],e},n.transformMat4=function(e,t,o){var a=t[0],n=t[1];return e[0]=o[0]*a+o[4]*n+o[12],e[1]=o[1]*a+o[5]*n+o[13],e},n.forEach=function(){var e=n.create();return function(t,o,a,n,s,l){var r,c;for(o||(o=2),a||(a=0),c=n?Math.min(n*o+a,t.length):t.length,r=a;c>r;r+=o)e[0]=t[r],e[1]=t[r+1],s(e,e,l),t[r]=e[0],t[r+1]=e[1];return t}}(),n.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},n.equals=function(e,t){var o=e[0],n=e[1],s=t[0],l=t[1];return Math.abs(o-s)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(n-l)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))},e.exports=n}])}),THREE.TrackballControls=function(e,t,o){var a=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var s=new THREE.Vector3,l=n.NONE,r=n.NONE,c=new THREE.Vector3,i=new THREE.Vector2,d=new THREE.Vector2,u=new THREE.Vector3,h=0,p=new THREE.Vector2,f=new THREE.Vector2,m=0,g=0,b=new THREE.Vector2,k=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.viewerScale0=this.object.viewerScale;var v={type:"change"},B={type:"start"},M={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var w,x,y,S,_,E,I,T,A,D,O,N=(w=new THREE.Vector2,function(e,t){return w.set((e-a.screen.left)/a.screen.width,(t-a.screen.top)/a.screen.height),w}),F=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(a.screen.height+2*(a.screen.top-o))/a.screen.width),e}}();function R(e){!1!==a.enabled&&(window.removeEventListener("keydown",R),r=l,l===n.NONE&&(e.keyCode!==a.keys[n.ROTATE]||a.noRotate?e.keyCode!==a.keys[n.ZOOM]||a.noZoom?e.keyCode!==a.keys[n.PAN]||a.noPan||(l=n.PAN):l=n.ZOOM:l=n.ROTATE))}function L(e){!1!==a.enabled&&(l=r,window.addEventListener("keydown",R,!1))}function C(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),l===n.NONE&&(l=e.button),l!==n.ROTATE||a.noRotate?l!==n.ZOOM||a.noZoom?l!==n.PAN||a.noPan||(b.copy(N(e.pageX,e.pageY)),k.copy(b)):(p.copy(N(e.pageX,e.pageY)),f.copy(p)):(d.copy(F(e.pageX,e.pageY)),i.copy(d)),document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",U,!1),a.dispatchEvent(B))}function P(e){!1!==a.enabled&&(Blockscad.gProcessor.viewer&&Blockscad.gProcessor.viewer.zSession&&Blockscad.gProcessor.viewer.zSession.effect.draggingObject||(e.preventDefault(),e.stopPropagation(),l!==n.ROTATE||a.noRotate?l!==n.ZOOM||a.noZoom?l!==n.PAN||a.noPan||k.copy(N(e.pageX,e.pageY)):f.copy(N(e.pageX,e.pageY)):(i.copy(d),d.copy(F(e.pageX,e.pageY))),a.update()))}function U(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),l=n.NONE,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",U),a.dispatchEvent(M))}function z(e){if(!1!==a.enabled&&!0!==a.noZoom&&!(Blockscad.gProcessor.viewer&&Blockscad.gProcessor.viewer.zSession&&Blockscad.gProcessor.viewer.zSession.effect.draggingObject)){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:p.y-=.025*e.deltaY;break;case 1:p.y-=.01*e.deltaY;break;default:p.y-=25e-5*e.deltaY}a.dispatchEvent(B),a.dispatchEvent(M),a.update()}}function $(e){if(!1!==a.enabled){switch(e.touches.length){case 1:l=n.TOUCH_ROTATE,d.copy(F(e.touches[0].pageX,e.touches[0].pageY)),i.copy(d);break;default:l=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=m=Math.sqrt(t*t+o*o);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(N(s,r)),k.copy(b)}a.dispatchEvent(B)}}function j(e){if(!1!==a.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:i.copy(d),d.copy(F(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;k.copy(N(n,s))}a.update()}}function V(e){if(!1!==a.enabled){switch(e.touches.length){case 0:l=n.NONE;break;case 1:l=n.TOUCH_ROTATE,d.copy(F(e.touches[0].pageX,e.touches[0].pageY)),i.copy(d)}a.dispatchEvent(M)}}function G(e){!1!==a.enabled&&e.preventDefault()}this.rotateCamera=(y=new THREE.Vector3,S=new THREE.Quaternion,_=new THREE.Vector3,E=new THREE.Vector3,I=new THREE.Vector3,T=new THREE.Vector3,function(){T.set(d.x-i.x,d.y-i.y,0),o&&T.set(d.x-i.x,-1*(d.y-i.y),0),(x=T.length())?(c.copy(a.object.position).sub(a.target),_.copy(c).normalize(),E.copy(a.object.up).normalize(),I.crossVectors(E,_).normalize(),E.setLength(d.y-i.y),I.setLength(d.x-i.x),T.copy(E.add(I)),y.crossVectors(T,c).normalize(),x*=a.rotateSpeed,S.setFromAxisAngle(y,x),c.applyQuaternion(S),a.object.up.applyQuaternion(S),u.copy(y),h=x):!a.staticMoving&&h&&(h*=Math.sqrt(1-a.dynamicDampingFactor),c.copy(a.object.position).sub(a.target),S.setFromAxisAngle(u,h),c.applyQuaternion(S),a.object.up.applyQuaternion(S)),i.copy(d)}),this.zoomCameraKey=function(e){if(e)var t=.9;else t=1.1;o?(a.object.viewerScale*=t,a.dispatchEvent(v)):(c.multiplyScalar(t),a.object.position.addVectors(a.target,c),a.checkDistances(),a.object.lookAt(a.target),s.distanceToSquared(a.object.position)>1e-6&&(a.dispatchEvent(v),s.copy(a.object.position)))},this.zoomCamera=function(){var e;l===n.TOUCH_ZOOM_PAN?(e=m/g,m=g,o?a.object.viewerScale*=e:c.multiplyScalar(e)):(1!==(e=1+(f.y-p.y)*a.zoomSpeed)&&e>0&&(o?a.object.viewerScale*=e:c.multiplyScalar(e)),a.staticMoving?p.copy(f):p.y+=(f.y-p.y)*this.dynamicDampingFactor)},this.panCamera=(A=new THREE.Vector2,D=new THREE.Vector3,O=new THREE.Vector3,function(){if(A.copy(k).sub(b),A.lengthSq()){A.multiplyScalar(c.length()*a.panSpeed);var e=A.x;O.copy(c).cross(a.object.up).setLength(e),O.add(D.copy(a.object.up).setLength(A.y)),a.object.position.add(O),a.target.add(O),a.staticMoving?b.copy(k):b.add(A.subVectors(k,b).multiplyScalar(a.dynamicDampingFactor))}}),this.checkDistances=function(){a.noZoom&&a.noPan||(c.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,c.setLength(a.maxDistance)),p.copy(f)),c.lengthSq()<a.minDistance*a.minDistance&&(a.object.position.addVectors(a.target,c.setLength(a.minDistance)),p.copy(f)))},this.update=function(){c.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,c),a.checkDistances(),a.object.lookAt(a.target),o?a.dispatchEvent(v):s.distanceToSquared(a.object.position)>1e-6&&(a.dispatchEvent(v),s.copy(a.object.position))},this.reset=function(e,t){if(l=n.NONE,r=n.NONE,e?a.object.position.set(e[0],e[1],e[2]):a.object.position.copy(a.position0),a.target.copy(a.target0),a.object.up.copy(a.up0),c.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(v),s.copy(a.object.position),t&&(t.position.set(0,0,0),t.children.length)){var o=t.children[0];o.position.set(0,0,0),o.quaternion.set(0,0,0,0),o.rotation.set(0,0,0)}a.object.viewerScale=a.viewerScale0},this.dispose=function(){this.domElement.removeEventListener("contextmenu",G,!1),this.domElement.removeEventListener("mousedown",C,!1),this.domElement.removeEventListener("wheel",z,!1),this.domElement.removeEventListener("touchstart",$,!1),this.domElement.removeEventListener("touchend",V,!1),this.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",R,!1),window.removeEventListener("keyup",L,!1)},this.domElement.addEventListener("contextmenu",G,!1),this.domElement.addEventListener("mousedown",C,!1),this.domElement.addEventListener("wheel",z,!1),this.domElement.addEventListener("touchstart",$,!1),this.domElement.addEventListener("touchend",V,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",R,!1),window.addEventListener("keyup",L,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;
